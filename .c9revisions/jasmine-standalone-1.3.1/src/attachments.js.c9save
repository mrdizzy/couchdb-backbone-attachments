{"ts":1361361362355,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"Backbone.Model.Attachment = Backbone.Model.extend({})\n\nBackbone.Collection.Attachments = Backbone.Collection.extend({\n    model: Backbone.Model.Attachment\n})\n\nBackbone.Model.CouchDB = Backbone.Model.extend({\n    defaults: {\n        \"_attachments\": new Backbone.Collection.Attachments,\n        \"attachments_order\": []\n    },\n    parse: function(resp) {\n        var parsed_attachments = _.map(resp._attachments, function(value, key, list) {\n            return {\n                id: key,\n                content_type: list[key].content_type,\n                length: list[key].length,\n            }\n        }, this)\n        if (this.get(\"_attachments\") instanceof Backbone.Collection.Attachments) {\n            resp._attachments = this.get(\"_attachments\").reset(parsed_attachments)\n        }\n        else {\n            resp._attachments = new Backbone.Collection.Attachments(parsed_attachments)\n        }\n        resp._attachments.url = this.url() + \"/attachments\"\n        return resp;\n    },\n    updateAttachmentsOrder: function(new_order) {\n        this.save({\n            \"attachments_order\": new_order\n        }, {\n            patch: true\n        });\n    },\n    idAttribute: \"_id\"\n});\n\n\nfunction makeDroppable(el,model) {\n    // We need this to prevent the browser using its standard default when you drag over\n    el.addEventListener('dragover', function(e) {\n        e.preventDefault();\n    });\n\n    el.addEventListener('drop', function(e) {\n        e.preventDefault();\n\n       \n            var file =  e.dataTransfer.files[0];\n            var reader = new FileReader();\n            reader.onload = function() {\n                model.set(\"binary\", this.result);\n                model.save();\n               // $('img').remove()\n                //$('<img>').attr('title', file.name).attr('src', this.result).css('width', '50px').appendTo(el);\n            };\n            reader.readAsBinaryString(file);\n        \n    });\n\n}\n// VIEW \n// Attachments\n\nBackbone.View.Attachments = Backbone.View.extend({\n    initialize: function() {\n        this.model.get(\"_attachments\").on(\"add\", this.addAttachment, this)\n    },\n    // addAttachment is called whenever the addAttachment() method from the \n    // parent view class (below) is called. \n    addAttachment: function(model) {\n        var v = new this.options.view({\n            attributes: {\n                id: model.cid\n            },\n            model: model\n        });\n        v.listenTo(model, 'destroy', v.remove)\n        this.$el.append(v.render().el)\n    },\n    render: function() {\n        var that = this;\n        this.$el.empty();\n\n        this.model.get(\"attachments_order\").forEach(function(key) {\n            var subview = new that.options.view({\n                attributes: {\n                    id: key\n                },\n                model: that.model.get(\"_attachments\").get(key)\n            }).render()\n            makeDroppable(subview.el, that.model.get(\"_attachments\").get(key))\n            that.$el.append(subview.el);\n        })\n        return this;\n    }\n})\n\n// VIEW \n// CouchDB Model\n//\n\n\nBackbone.View.CouchDB = Backbone.View.extend({\n    // \n    addAttachment: function() {\n        this.model.get(\"_attachments\").add({})\n    },\n\n    // Extend this view and then call buildAttachments(view) from within the \n    // extended view's render() method, passing it an extended Backbone view\n    // to render each individual attachment. b\n    buildAttachments: function(view) {\n        var that = this;\n        var rendered_view = new Backbone.View.Attachments({\n            model: this.model,\n            view: view\n        })\n        var element = rendered_view.render().$el\n        element.sortable({\n            update: function(event, ui) {\n                that.model.updateAttachmentsOrder($(this).sortable(\"toArray\"));\n            }\n        })\n\n        return rendered_view.render().el\n    }\n})\n"]],"start1":0,"start2":0,"length1":0,"length2":3870}]],"length":3870}
{"contributors":[],"silentsave":false,"ts":1361361370851,"patch":[[{"diffs":[[0,"nd({"],[-1,"})\n\nBackbone.Collection.Attachments = Backbone.Collection.extend({\n    model: Backbone.Model.Attachment\n})\n\nBackbone.Model.CouchDB = Backbone.Model.extend({\n    defaults: {\n        \"_attachments\": new Backbone.Collection.Attachments,\n        \"attachments_order\": []\n    },\n    parse: function(resp) {\n        var parsed_attachments = _.map(resp._attachments, function(value, key, list) {\n            return {\n                id: key,\n                content_type: list[key].content_type,\n                length: list[key].length,\n            }\n        }, this)\n        if (this.get(\"_attachments\") instanceof Backbone.Collection.Attachments) {\n            resp._attachments = this.get(\"_attachments\").reset(parsed_attachments)\n        }\n        else {\n            resp._attachments = new Backbone.Collection.Attachments(parsed_attachments)\n        }\n        resp._attachments.url = this.url() + \"/attachments\"\n        return resp;\n    },\n    updateAttachmentsOrder: function(new_order) {\n        this.save({\n            \"attachments_order\": new_order\n        }, {\n            patch: true\n        });\n    },\n    idAttribute: \"_id\"\n});\n\n\nfunction makeDroppable(el,model) {\n    // We need this to prevent the browser using its standard default when you drag over\n    el.addEventListener('dragover', function(e) {\n        e.preventDefault();\n    });\n\n    el.addEventListener('drop', function(e) {\n        e.preventDefault();\n\n       \n            var file =  e.dataTransfer.files[0];\n            var reader = new FileReader();\n            reader.onload = function() {\n                model.set(\"binary\", this.result);\n                model.save();\n               // $('img').remove()\n                //$('<img>').attr('title', file.name).attr('src', this.result).css('width', '50px').appendTo(el);\n            };\n            reader.readAsBinaryString(file);\n        \n    });\n\n}\n// VIEW \n// Attachments\n\nBackbone.View.Attachments = Backbone.View.extend({\n    initialize: function() {\n        this.model.get(\"_attachments\").on(\"add\", this.addAttachment, this)\n    },\n    // addAttachment is called whenever the addAttachment() method from the \n    // parent view class (below) is called. \n    addAttachment: function(model) {\n        var v = new this.options.view({\n            attributes: {\n                id: model.cid\n            },\n            model: model\n        });\n        v.listenTo(model, 'destroy', v.remove)\n        this.$el.append(v.render().el)\n    },\n    render: function() {\n        var that = this;\n        this.$el.empty();\n\n        this.model.get(\"attachments_order\").forEach(function(key) {\n            var subview = new that.options.view({\n                attributes: {\n                    id: key\n                },\n                model: that.model.get(\"_attachments\").get(key)\n            }).render()\n            makeDroppable(subview.el, that.model.get(\"_attachments\").get(key))\n            that.$el.append(subview.el);\n        })\n        return this;\n    }\n})\n\n// VIEW \n// CouchDB Model\n//\n\n\nBackbone.View.CouchDB = Backbone.View.extend({\n    // \n    addAttachment: function() {\n        this.model.get(\"_attachments\").add({})\n    },\n\n    // Extend this view and then call buildAttachments(view) from within the \n    // extended view's render() method, passing it an extended Backbone view\n    // to render each individual attachment. b\n    buildAttachments: function(view) {\n        var that = this;\n        var rendered_view = new Backbone.View.Attachments({\n            model: this.model,\n            view: view\n        })\n        var element = rendered_view.render().$el\n        element.sortable({\n            update: function(event, ui) {\n                that.model.updateAttachmentsOrder($(this).sortable(\"toArray\"));\n            }\n        })\n\n        return rendered_view.render().el\n    }\n})"],[1,"\r\n    url: function() {\r\n        return this.collection.url + \"/\" + this.id + \"/\" + this.rev;\r\n    },\r\n    // Overwrite the Backbone.sync method for CREATE and UPDATE calls\r\n    // as we want to send just the binary data of the attachment\r\n    // We shouldn't concern ourselves with GETting the attachment as \r\n    // attachments should always be created via the parent collection\r\n    //\r\n    // options is created by the Backbone.Model.save() method and \r\n    // it contains the success callback for the low-level jQuery $.ajax\r\n    // method. We augment it with our own options.\r\n    /* sync: function(method, model, options) {\r\n        options.processData = false; \r\n        options.data = this.get(\"binary\");\r\n        options.url = this.url();\r\n        options.type = \"PUT\";\r\n        options.contentType = this.get(\"content_type\");\r\n        var success = options.success;\r\n        options.success = function(resp) {\r\n            if(success) success(model,resp,options);\r\n            model.trigger('sync',model.resp,options);\r\n        }\r\n        if (method === \"update\") {\r\n            $.ajax(options);\r\n        }\r\n    }*/\r\n})\r\n\r\nBackbone.Collection.Attachments = Backbone.Collection.extend({\r\n    model: Backbone.Model.Attachment\r\n})\r\n\r\nBackbone.Model.CouchDB = Backbone.Model.extend({\r\n    defaults: {\r\n        \"_attachments\": new Backbone.Collection.Attachments,\r\n        \"attachments_order\": []\r\n    },\r\n\r\n    // We overwrite the parse function as when attachments come down the \r\n    // wire we need to parse them out into a separate Backbone collection\r\n    // and make each attachment a Backbone model\r\n    parse: function(resp) {\r\n        var result = {};\r\n        _.each(resp._attachments, function(value, key, list) {\r\n            var type_number = key.split(\"-\");\r\n            var number = type_number[1];\r\n            var type = type_number[0];\r\n            result[number] = result[number] || {}\r\n            result[number][type] = {\r\n                content_type: list[key].content_type,\r\n                length: list[key].length\r\n            }\r\n        })\r\n        var parsed_attachments = _.map(resp._attachments, function(value, key, list) {\r\n            return {\r\n                id: key,\r\n                content_type: list[key].content_type,\r\n                length: list[key].length,\r\n            }\r\n        }, this)\r\n        if (this.get(\"_attachments\") instanceof Backbone.Collection.Attachments) {\r\n            resp._attachments = this.get(\"_attachments\").reset(parsed_attachments)\r\n        }\r\n        else {\r\n            resp._attachments = new Backbone.Collection.Attachments(parsed_attachments)\r\n        }\r\n        resp._attachments.url = this.url() + \"/\" + resp._id + \"/attachments\"\r\n        return resp;\r\n    },\r\n\r\n    // We call this to save the order of attachments to the server\r\n    updateAttachmentsOrder: function(new_order) {\r\n        this.save({\r\n            \"attachments_order\": new_order\r\n        }, {\r\n            patch: true\r\n        });\r\n    },\r\n    sync: function() {\r\n       var args = arguments;\r\n       var xhr;\r\n       \r\n       // Because the FileReader API is asynchronous we have to use a callback\r\n       // style to call Backbone.sync when the files have been read\r\n       this.toJSON(function(attrs) {\r\n           args[2].attrs = attrs; // args[2] is the options object from arguments\r\n           xhr = Backbone.sync.apply(this, args);\r\n       })\r\n      return xhr;\r\n    },\r\n    // We override the toJSON function as this is what Backbone.sync uses to \r\n    // save our model to the server.\r\n    toJSON: function(callback) {\r\n        var json = _.clone(this.attributes);\r\n        json._attachments = {};\r\n        var attachments = this.get(\"_attachments\").filter(function(attachment) {\r\n            return attachment.get(\"binary\");\r\n        });\r\n \r\n        // We need to use a counter as loading of the files is asynchronous\r\n        // and we do not want to return until they are all loaded\r\n        var counter = 0;\r\n        _.each(attachments, function(attachment) {\r\n\r\n            var fReader = new FileReader();\r\n            fReader.onload = function(event) {\r\n                counter++;\r\n                var data = event.target.result.split(\",\")[1];\r\n                json._attachments[attachment.id] = {\r\n                    content_type: attachment.get(\"content_type\"),\r\n                    data: data\r\n                }\r\n                if (counter == attachments.length) {\r\n                   console.log(json)\r\n                    callback(json);\r\n                }\r\n            }\r\n            fReader.readAsDataURL(attachment.get(\"binary\"))\r\n        })\r\n    },\r\n    idAttribute: \"_id\"\r\n});\r\n\r\n\r\nfunction makeDroppable(el, model) {\r\n    // We need this to prevent the browser using its standard default when you drag over\r\n    el.addEventListener('dragover', function(e) {\r\n        e.preventDefault();\r\n    });\r\n\r\n    // Listen for a file to be dropped on the element\r\n    // and then get the file, set the binary data of the attachment\r\n    // and save it\r\n    el.addEventListener('drop', function(e) {\r\n        e.preventDefault();\r\n        var file = e.dataTransfer.files[0];\r\n\r\n        model.set(\"binary\", file);\r\n        // model.save();\r\n        $('img').remove()\r\n        $('<img>').attr('title', file.name).attr('src', this.result).css('width', '50px').appendTo(el);\r\n    });\r\n}\r\n// VIEWS \r\n// Attachments\r\n\r\nBackbone.View.Attachments = Backbone.View.extend({\r\n    initialize: function() {\r\n        this.model.get(\"_attachments\").on(\"add\", this.addAttachment, this)\r\n    },\r\n    // addAttachment is called whenever the addAttachment() method from the \r\n    // parent view class (below) is called. \r\n    addAttachment: function(model) {\r\n        var v = new this.options.view({\r\n            attributes: {\r\n                id: model.cid\r\n            },\r\n            model: model\r\n        });\r\n        v.listenTo(model, 'destroy', v.remove)\r\n        this.$el.append(v.render().el)\r\n    },\r\n    render: function() {\r\n        var that = this;\r\n        this.$el.empty();\r\n\r\n        this.model.get(\"attachments_order\").forEach(function(key) {\r\n            var subview = new that.options.view({\r\n                attributes: {\r\n                    id: key\r\n                },\r\n                model: that.model.get(\"_attachments\").get(key)\r\n            }).render()\r\n            makeDroppable(subview.el, that.model.get(\"_attachments\").get(key))\r\n            that.$el.append(subview.el);\r\n        })\r\n        return this;\r\n    }\r\n})\r\n\r\n// VIEW \r\n// CouchDB Model\r\n//\r\n\r\nBackbone.View.CouchDB = Backbone.View.extend({\r\n    // \r\n    addAttachment: function() {\r\n        this.model.get(\"_attachments\").add({})\r\n    },\r\n\r\n    // Extend this view and then call buildAttachments(view) from within the \r\n    // extended view's render() method, passing it an extended Backbone view\r\n    // to render each individual attachment. \r\n    buildAttachments: function(view) {\r\n        var that = this;\r\n        var rendered_view = new Backbone.View.Attachments({\r\n            model: this.model,\r\n            view: view\r\n        })\r\n        var element = rendered_view.render().$el\r\n        element.sortable({\r\n            update: function(event, ui) {\r\n                that.model.updateAttachmentsOrder($(this).sortable(\"toArray\"));\r\n            }\r\n        })\r\n\r\n        return rendered_view.render().el\r\n    }\r\n})\r"],[0,"\n"]],"start1":47,"start2":47,"length1":3823,"length2":7367}]],"length":7414,"saved":false}
{"contributors":[],"silentsave":false,"ts":1361363963570,"patch":[[{"diffs":[[0,"({\r\n"],[-1,"    url: function() {\r\n        return this.collection.url + \"/\" + this.id + \"/\" + this.rev;\r\n    },"],[0,"\r\n  "]],"start1":49,"start2":49,"length1":107,"length2":8}]],"length":7315,"saved":false}
{"contributors":[],"silentsave":false,"ts":1361364665519,"patch":[[{"diffs":[[0,"     var"],[1," xhr,"],[0," args = "]],"start1":2969,"start2":2969,"length1":16,"length2":21},{"diffs":[[0,"s;\r\n"],[-1,"       var xhr;\r\n"],[0,"    "]],"start1":2998,"start2":2998,"length1":25,"length2":8},{"diffs":[[0,"    })\r\n"],[-1,"\r\n"],[0,"        "]],"start1":7240,"start2":7240,"length1":18,"length2":16},{"diffs":[[0,"().el\r\n    }\r\n})"],[-1,"\r\n"]],"start1":7283,"start2":7283,"length1":18,"length2":16}]],"length":7299,"saved":false}
{"ts":1361364681790,"patch":[[{"diffs":[[0,"  }, this)\r\n"],[1,"        console.log(parsed_attachments)\r\n"],[0,"        if ("]],"start1":2282,"start2":2282,"length1":24,"length2":65}]],"length":7340,"saved":false}
{"ts":1361364738461,"patch":[[{"diffs":[[0,"s)\r\n"],[-1,"        console.log(parsed_attachments)\r\n"],[0,"    "]],"start1":2290,"start2":2290,"length1":49,"length2":8},{"diffs":[[0,"d_attachments)\r\n"],[1,"            console.log(resp._attachments)\r\n"],[0,"        }\r\n     "]],"start1":2562,"start2":2562,"length1":32,"length2":76}]],"length":7343,"saved":false}
{"ts":1361364776778,"patch":[[{"diffs":[[0,"    "],[-1,"console.log(resp._attachments)"],[0,"\r\n  "]],"start1":2586,"start2":2586,"length1":38,"length2":8}]],"length":7313,"saved":false}
{"ts":1361365636682,"patch":[[{"diffs":[[0,"   \r\n        }\r\n"],[1,"        console.log(resp._attachments)\r\n"],[0,"        resp._at"]],"start1":2587,"start2":2587,"length1":32,"length2":72}]],"length":7353,"saved":false}
{"ts":1361365792940,"patch":[[{"diffs":[[0," }\r\n        })\r\n"],[1,"        console.log(resp._attachments)\r\n"],[0,"        var pars"]],"start1":2011,"start2":2011,"length1":32,"length2":72}]],"length":7393,"saved":false}
{"ts":1361365865248,"patch":[[{"diffs":[[0," }\r\n"],[-1,"        console.log(resp._attachments)\r\n"],[0,"    "]],"start1":2639,"start2":2639,"length1":48,"length2":8}]],"length":7353,"saved":false}
{"ts":1361365953544,"patch":[[{"diffs":[[0,"nction(resp) {\r\n"],[1,"        var resp = _.clone(resp)\r\n"],[0,"        var resu"]],"start1":1579,"start2":1579,"length1":32,"length2":66}]],"length":7387,"saved":false}
{"contributors":[],"silentsave":false,"ts":1361368994719,"patch":[[{"diffs":[[0,"nction() {\r\n"],[1,"        console.log(\"Sent\")\r\n"],[0,"       var x"]],"start1":3043,"start2":3043,"length1":24,"length2":53}]],"length":7416,"saved":false}
{"ts":1361369501561,"patch":[[{"diffs":[[0," {\r\n"],[-1,"        console.log(\"Sent\")\r\n"],[0,"    "]],"start1":3051,"start2":3051,"length1":37,"length2":8},{"diffs":[[0,"is, args);\r\n"],[1,"           \r\n        console.log(\"Sent\")\r\n"],[0,"       })\r\n "]],"start1":3408,"start2":3408,"length1":24,"length2":66}]],"length":7429,"saved":false}
{"ts":1361369582459,"patch":[[{"diffs":[[0,"    "],[-1," console.log(\"Sent\")"],[0,"\r\n  "]],"start1":3436,"start2":3436,"length1":28,"length2":8},{"diffs":[[0,"  });\r\n "],[1,"       console.log(attachments)"],[0,"\r\n      "]],"start1":3844,"start2":3844,"length1":16,"length2":47}]],"length":7440,"saved":false}
{"ts":1361369596785,"patch":[[{"diffs":[[0,".log(attachments"],[1,".length == 0"],[0,")\r\n        // We"]],"start1":3866,"start2":3866,"length1":32,"length2":44}]],"length":7452,"saved":false}
{"ts":1361369605129,"patch":[[{"diffs":[[0,"ength =="],[1,"="],[0," 0)\r\n   "]],"start1":3884,"start2":3884,"length1":16,"length2":17}]],"length":7453,"saved":false}
{"ts":1361369638717,"patch":[[{"diffs":[[0,"       c"],[-1,"onsole.log"],[1,"allback(json) if "],[0,"(attachm"]],"start1":3852,"start2":3852,"length1":26,"length2":33}]],"length":7460,"saved":false}
{"ts":1361369649536,"patch":[[{"diffs":[[0,"\n       "],[-1," callback(json)"],[0," if (att"]],"start1":3850,"start2":3850,"length1":31,"length2":16},{"diffs":[[0,"h === 0)"],[1," {\r\n            callback(json) \r\n            return;\r\n        }"],[0,"\r\n      "]],"start1":3880,"start2":3880,"length1":16,"length2":79}]],"length":7508,"saved":false}
{"contributors":[],"silentsave":false,"ts":1361398557350,"patch":[[{"diffs":[[0,"h === 0) {\r\n"],[1,"            delete json._attachments\r\n"],[0,"            "]],"start1":3880,"start2":3880,"length1":24,"length2":62}]],"length":7546,"saved":false}
{"ts":1361398559462,"patch":[[{"diffs":[[0,"_attachments"],[1,";"],[0,"\r\n          "]],"start1":3916,"start2":3916,"length1":24,"length2":25}]],"length":7547,"saved":false}
{"ts":1361398573214,"patch":[[{"diffs":[[0,"es);"],[-1,"\r\n"],[0,"        "],[-1,"json._attachments = {};"],[0,"\r\n  "]],"start1":3671,"start2":3671,"length1":41,"length2":16},{"diffs":[[0," {\r\n"],[-1,"            delete json._attachments;\r\n"],[0,"    "]],"start1":3863,"start2":3863,"length1":47,"length2":8},{"diffs":[[0,"rn;\r\n        }\r\n"],[1,"        json._attachments = {};\r\n"],[0,"        // We ne"]],"start1":3912,"start2":3912,"length1":32,"length2":65}]],"length":7516,"saved":false}
{"ts":1361398620597,"patch":[[{"diffs":[[0,"tes);   "],[1,"\r\n"],[0,"     "],[1,"   \r\n        json._attachments = {};"],[0,"\r\n      "]],"start1":3670,"start2":3670,"length1":21,"length2":59},{"diffs":[[0," }\r\n"],[-1,"        json._attachments = {};\r\n"],[0,"    "]],"start1":3962,"start2":3962,"length1":41,"length2":8}]],"length":7521,"saved":false}
{"ts":1361398626077,"patch":[[{"diffs":[[0,"s);   \r\n"],[-1,"        \r\n"],[0,"        "]],"start1":3672,"start2":3672,"length1":26,"length2":16}]],"length":7511,"saved":false}
{"ts":1361398711515,"patch":[[{"diffs":[[0,"   this."],[-1,"toJSON"],[1,"saveForCouchDB"],[0,"(functio"]],"start1":3252,"start2":3252,"length1":22,"length2":30},{"diffs":[[0,"r.\r\n    "],[-1,"toJSON"],[1,"saveForCouchDB"],[0,": functi"]],"start1":3601,"start2":3601,"length1":22,"length2":30}]],"length":7527,"saved":false}
{"ts":1361399178582,"patch":[[{"diffs":[[0,";\r\n        });\r\n"],[1,"        \r\n        // If no files have been added to the model then we return straight away\r\n"],[0,"        if (atta"]],"start1":3854,"start2":3854,"length1":32,"length2":124}]],"length":7619,"saved":false}
{"ts":1361399230983,"patch":[[{"diffs":[[0,");\r\n"],[-1,"           \r\n       \r\n"],[0,"    "]],"start1":3424,"start2":3424,"length1":30,"length2":8}]],"length":7597,"saved":false}
{"ts":1361400676445,"patch":[[{"diffs":[[0,"(attachment) {\r\n"],[1,"            console.log(attachment.get(\"binary\"))\r\n"],[0,"            retu"]],"start1":3773,"start2":3773,"length1":32,"length2":83}]],"length":7648,"saved":false}
{"ts":1361400743895,"patch":[[{"diffs":[[0,"    "],[-1,"console.log(attachment.get(\"binary\"))"],[0,"\r\n  "]],"start1":3797,"start2":3797,"length1":45,"length2":8},{"diffs":[[0,"   });\r\n        "],[1,"console.log(attachments)"],[0,"\r\n        // If "]],"start1":3854,"start2":3854,"length1":32,"length2":56}]],"length":7635,"saved":false}
{"ts":1361400982520,"patch":[[{"diffs":[[0,"   }*/\r\n})\r\n"],[1,"spyOn(FileReader)"],[0,"\r\nBackbone.C"]],"start1":1072,"start2":1072,"length1":24,"length2":41},{"diffs":[[0,");\r\n"],[-1,"        console.log(attachments)\r\n"],[0,"    "]],"start1":3875,"start2":3875,"length1":42,"length2":8}]],"length":7618,"saved":false}
{"ts":1361401007074,"patch":[[{"diffs":[[0,"eReader)"],[1,";\r\n"],[0,"\r\nBackbo"]],"start1":1093,"start2":1093,"length1":16,"length2":19}]],"length":7621,"saved":false}
{"ts":1361401036979,"patch":[[{"diffs":[[0,"\n})\r"],[-1,"\nspyOn(FileReader);\r"],[0,"\n\r\nB"]],"start1":1079,"start2":1079,"length1":28,"length2":8}]],"length":7601,"saved":false}
{"contributors":[],"silentsave":false,"ts":1361444165167,"patch":[[{"diffs":[[0,"tend({\r\n"],[1,"    updateBinary: function(file) {\r\n        \r\n    }"],[0,"\r\n    //"]],"start1":45,"start2":45,"length1":16,"length2":67}]],"length":7652,"saved":false}
{"ts":1361444186225,"patch":[[{"diffs":[[0," {\r\n        "],[1,"this.set(\"binary\", file)"],[0,"\r\n    }\r\n   "]],"start1":85,"start2":85,"length1":24,"length2":48}]],"length":7676,"saved":false}
{"ts":1361444372646,"patch":[[{"diffs":[[0,"ry\", file)\r\n"],[1,"        this.set(\"content_type\", file.type)\r\n"],[0,"    }\r\n    /"]],"start1":111,"start2":111,"length1":24,"length2":69}]],"length":7721,"saved":false}
{"ts":1361446350256,"patch":[[{"diffs":[[0,"ent) {\r\n"],[-1,"            \r\n"],[0,"        "]],"start1":3901,"start2":3901,"length1":30,"length2":16},{"diffs":[[0,";\r\n        });\r\n"],[1,"        console.log(attachments.length)\r\n"],[0,"        // If no"]],"start1":3952,"start2":3952,"length1":32,"length2":73}]],"length":7748,"saved":false}
{"ts":1361446362392,"patch":[[{"diffs":[[0,");\r\n"],[-1,"        console.log(attachments.length)\r\n"],[0,"    "]],"start1":3964,"start2":3964,"length1":49,"length2":8}]],"length":7707,"saved":false}
{"ts":1361447092841,"patch":[[{"diffs":[[0,"})\r\n"],[-1,"        console.log(resp._attachments)\r\n"],[0,"    "]],"start1":2177,"start2":2177,"length1":48,"length2":8},{"diffs":[[0,"ction(event) {\r\n"],[1,"                console.log(attachment)\r\n"],[0,"                "]],"start1":4413,"start2":4413,"length1":32,"length2":73},{"diffs":[[0,"    "],[-1,"  console.log(json)"],[0,"\r\n  "]],"start1":4800,"start2":4800,"length1":27,"length2":8}]],"length":7689,"saved":false}
{"ts":1361447840444,"patch":[[{"diffs":[[0,"r = 0;\r\n"],[1,"        console.log(attachments);\r\n"],[0,"        "]],"start1":4274,"start2":4274,"length1":16,"length2":51}]],"length":7724,"saved":false}
{"ts":1361447843756,"patch":[[{"diffs":[[0,"            "],[1,"//"],[0," console.log"]],"start1":4467,"start2":4467,"length1":24,"length2":26}]],"length":7726,"saved":false}
{"ts":1361447871486,"patch":[[{"diffs":[[0,"    "],[-1,"// console.log(attachment)"],[0,"\r\n  "]],"start1":4475,"start2":4475,"length1":34,"length2":8}]],"length":7700,"saved":false}
{"ts":1361448199099,"patch":[[{"diffs":[[0,"eReader();\r\n"],[1,"            console.log(fReader)\r\n"],[0,"            "]],"start1":4404,"start2":4404,"length1":24,"length2":58}]],"length":7734,"saved":false}
{"contributors":[],"silentsave":false,"ts":1361476240675,"patch":[[{"diffs":[[0,"del.extend({"],[-1,"\r"],[0,"\n    updateB"]],"start1":39,"start2":39,"length1":25,"length2":24},{"diffs":[[0,"tion(file) {"],[-1,"\r"],[0,"\n        thi"]],"start1":74,"start2":74,"length1":25,"length2":24},{"diffs":[[0,"\", file)"],[-1,"\r"],[0,"\n       "]],"start1":111,"start2":111,"length1":17,"length2":16},{"diffs":[[0,"le.type)"],[-1,"\r"],[0,"\n    }"],[-1,"\r"],[0,"\n    // "]],"start1":155,"start2":155,"length1":24,"length2":22},{"diffs":[[0,"TE calls"],[-1,"\r"],[0,"\n    // "]],"start1":231,"start2":231,"length1":17,"length2":16},{"diffs":[[0,"f the attachment"],[-1,"\r"],[0,"\n    // We shoul"]],"start1":288,"start2":288,"length1":33,"length2":32},{"diffs":[[0,"ment as "],[-1,"\r"],[0,"\n    // "]],"start1":366,"start2":366,"length1":17,"length2":16},{"diffs":[[0,"tion"],[-1,"\r"],[0,"\n    //"],[-1,"\r"],[0,"\n   "]],"start1":440,"start2":440,"length1":17,"length2":15},{"diffs":[[0,"hod and "],[-1,"\r"],[0,"\n    // "]],"start1":510,"start2":510,"length1":17,"length2":16},{"diffs":[[0,"y $.ajax"],[-1,"\r"],[0,"\n    // "]],"start1":582,"start2":582,"length1":17,"length2":16},{"diffs":[[0,"options."],[-1,"\r"],[0,"\n    /* "]],"start1":633,"start2":633,"length1":17,"length2":16},{"diffs":[[0,", options) {"],[-1,"\r"],[0,"\n        opt"]],"start1":677,"start2":677,"length1":25,"length2":24},{"diffs":[[0," false; "],[-1,"\r"],[0,"\n       "]],"start1":719,"start2":719,"length1":17,"length2":16},{"diffs":[[0,"s.get(\"binary\");"],[-1,"\r"],[0,"\n        options"]],"start1":754,"start2":754,"length1":33,"length2":32},{"diffs":[[0,"s.url();"],[-1,"\r"],[0,"\n       "]],"start1":796,"start2":796,"length1":17,"length2":16},{"diffs":[[0,"= \"PUT\";"],[-1,"\r"],[0,"\n       "]],"start1":826,"start2":826,"length1":17,"length2":16},{"diffs":[[0,"_type\");"],[-1,"\r"],[0,"\n       "]],"start1":882,"start2":882,"length1":17,"length2":16},{"diffs":[[0,"success;"],[-1,"\r"],[0,"\n       "]],"start1":921,"start2":921,"length1":17,"length2":16},{"diffs":[[0,"function(resp) {"],[-1,"\r"],[0,"\n            if("]],"start1":956,"start2":956,"length1":33,"length2":32},{"diffs":[[0,"l,resp,options);"],[-1,"\r"],[0,"\n            mod"]],"start1":1009,"start2":1009,"length1":33,"length2":32},{"diffs":[[0,"l.resp,options);"],[-1,"\r"],[0,"\n        }\r\n    "]],"start1":1063,"start2":1063,"length1":33,"length2":32},{"diffs":[[0,"ions);\n        }"],[-1,"\r"],[0,"\n        if (met"]],"start1":1073,"start2":1073,"length1":33,"length2":32},{"diffs":[[0,"date\") {"],[-1,"\r"],[0,"\n       "]],"start1":1116,"start2":1116,"length1":17,"length2":16},{"diffs":[[0,"ptions);"],[-1,"\r"],[0,"\n       "]],"start1":1145,"start2":1145,"length1":17,"length2":16},{"diffs":[[0,"   }"],[-1,"\r"],[0,"\n    }*/"],[-1,"\r"],[0,"\n})"],[-1,"\r\n\r"],[1,"\n"],[0,"\nBac"]],"start1":1159,"start2":1159,"length1":24,"length2":20},{"diffs":[[0,"ion.extend({"],[-1,"\r"],[0,"\n    model: "]],"start1":1226,"start2":1226,"length1":25,"length2":24},{"diffs":[[0,"tachment"],[-1,"\r"],[0,"\n})"],[-1,"\r\n\r"],[1,"\n"],[0,"\nBackbon"]],"start1":1267,"start2":1267,"length1":23,"length2":20},{"diffs":[[0,"del.extend({"],[-1,"\r"],[0,"\n    default"]],"start1":1316,"start2":1316,"length1":25,"length2":24},{"diffs":[[0," defaults: {"],[-1,"\r"],[0,"\n        \"_a"]],"start1":1332,"start2":1332,"length1":25,"length2":24},{"diffs":[[0,"chments,"],[-1,"\r"],[0,"\n       "]],"start1":1397,"start2":1397,"length1":17,"length2":16},{"diffs":[[0,"der\": []"],[-1,"\r"],[0,"\n    },"],[-1,"\r\n\r"],[0,"\n    // "]],"start1":1429,"start2":1429,"length1":27,"length2":23},{"diffs":[[0,"me down the "],[-1,"\r"],[0,"\n    // wire"]],"start1":1506,"start2":1506,"length1":25,"length2":24},{"diffs":[[0,"llection"],[-1,"\r"],[0,"\n    // "]],"start1":1584,"start2":1584,"length1":17,"length2":16},{"diffs":[[0,"ckbone model"],[-1,"\r"],[0,"\n    parse: "]],"start1":1629,"start2":1629,"length1":25,"length2":24},{"diffs":[[0,"(resp) {"],[-1,"\r"],[0,"\n       "]],"start1":1661,"start2":1661,"length1":17,"length2":16},{"diffs":[[0,"ne(resp)"],[-1,"\r"],[0,"\n       "]],"start1":1694,"start2":1694,"length1":17,"length2":16},{"diffs":[[0,"result = {};"],[-1,"\r"],[0,"\n        _.e"]],"start1":1715,"start2":1715,"length1":25,"length2":24},{"diffs":[[0,"ue, key, list) {"],[-1,"\r"],[0,"\n            var"]],"start1":1774,"start2":1774,"length1":33,"length2":32},{"diffs":[[0,"it(\"-\");"],[-1,"\r"],[0,"\n       "]],"start1":1828,"start2":1828,"length1":17,"length2":16},{"diffs":[[0,"e_number[1];"],[-1,"\r"],[0,"\n           "]],"start1":1865,"start2":1865,"length1":25,"length2":24},{"diffs":[[0,"mber[0];"],[-1,"\r"],[0,"\n       "]],"start1":1908,"start2":1908,"length1":17,"length2":16},{"diffs":[[0,"r] || {}"],[-1,"\r"],[0,"\n       "]],"start1":1958,"start2":1958,"length1":17,"length2":16},{"diffs":[[0,"r][type] = {"],[-1,"\r"],[0,"\n           "]],"start1":1991,"start2":1991,"length1":25,"length2":24},{"diffs":[[0,"y].content_type,"],[-1,"\r"],[0,"\n               "]],"start1":2041,"start2":2041,"length1":33,"length2":32},{"diffs":[[0,"].length"],[-1,"\r"],[0,"\n       "]],"start1":2090,"start2":2090,"length1":17,"length2":16},{"diffs":[[0,"th\n            }"],[-1,"\r"],[0,"\n        })\r\n   "]],"start1":2096,"start2":2096,"length1":33,"length2":32},{"diffs":[[0,"    }\n        })"],[-1,"\r"],[0,"\n        var par"]],"start1":2107,"start2":2107,"length1":33,"length2":32},{"diffs":[[0,"key, list) {"],[-1,"\r"],[0,"\n           "]],"start1":2198,"start2":2198,"length1":25,"length2":24},{"diffs":[[0,"return {"],[-1,"\r"],[0,"\n       "]],"start1":2223,"start2":2223,"length1":17,"length2":16},{"diffs":[[0,"id: key,"],[-1,"\r"],[0,"\n       "]],"start1":2248,"start2":2248,"length1":17,"length2":16},{"diffs":[[0,"nt_type,"],[-1,"\r"],[0,"\n       "]],"start1":2302,"start2":2302,"length1":17,"length2":16},{"diffs":[[0,".length,"],[-1,"\r"],[0,"\n       "]],"start1":2344,"start2":2344,"length1":17,"length2":16},{"diffs":[[0,"h,\n            }"],[-1,"\r"],[0,"\n        }, this"]],"start1":2350,"start2":2350,"length1":33,"length2":32},{"diffs":[[0,"    }, this)"],[-1,"\r"],[0,"\n        if "]],"start1":2371,"start2":2371,"length1":25,"length2":24},{"diffs":[[0,"tachments) {"],[-1,"\r"],[0,"\n           "]],"start1":2454,"start2":2454,"length1":25,"length2":24},{"diffs":[[0,"sed_attachments)"],[-1,"\r"],[0,"\n        }\r\n    "]],"start1":2533,"start2":2533,"length1":33,"length2":32},{"diffs":[[0,"ments)\n        }"],[-1,"\r"],[0,"\n        else {\r"]],"start1":2543,"start2":2543,"length1":33,"length2":32},{"diffs":[[0,"  else {"],[-1,"\r"],[0,"\n       "]],"start1":2566,"start2":2566,"length1":17,"length2":16},{"diffs":[[0,"nts)"],[-1,"\r\n            \r"],[1,"\n"],[0,"\n   "]],"start1":2658,"start2":2658,"length1":23,"length2":9},{"diffs":[[0,"ents)\n\n        }"],[-1,"\r"],[0,"\n        resp._a"]],"start1":2657,"start2":2657,"length1":33,"length2":32},{"diffs":[[0,"chments\""],[-1,"\r"],[0,"\n       "]],"start1":2742,"start2":2742,"length1":17,"length2":16},{"diffs":[[0,"rn resp;"],[-1,"\r"],[0,"\n    },"],[-1,"\r\n\r"],[1,"\n"],[0,"\n    // "]],"start1":2763,"start2":2763,"length1":27,"length2":24},{"diffs":[[0,"e server"],[-1,"\r"],[0,"\n    upd"]],"start1":2838,"start2":2838,"length1":17,"length2":16},{"diffs":[[0,"order) {"],[-1,"\r"],[0,"\n       "]],"start1":2888,"start2":2888,"length1":17,"length2":16},{"diffs":[[0,"s.save({"],[-1,"\r"],[0,"\n       "]],"start1":2908,"start2":2908,"length1":17,"length2":16},{"diffs":[[0,"ew_order"],[-1,"\r"],[0,"\n       "]],"start1":2951,"start2":2951,"length1":17,"length2":16},{"diffs":[[0,"    }, {"],[-1,"\r"],[0,"\n       "]],"start1":2964,"start2":2964,"length1":17,"length2":16},{"diffs":[[0,"ch: true"],[-1,"\r"],[0,"\n       "]],"start1":2988,"start2":2988,"length1":17,"length2":16},{"diffs":[[0,"     });"],[-1,"\r"],[0,"\n    },"],[-1,"\r"],[0,"\n    syn"]],"start1":3000,"start2":3000,"length1":25,"length2":23},{"diffs":[[0,"function() {"],[-1,"\r"],[0,"\n"],[1," "],[0,"       var x"]],"start1":3026,"start2":3026,"length1":26,"length2":26},{"diffs":[[0,"nts;"],[-1,"\r\n       \r\n"],[1,"\n\n "],[0,"    "]],"start1":3069,"start2":3069,"length1":19,"length2":11},{"diffs":[[0,"callback"],[-1,"\r"],[0,"\n"],[1," "],[0,"       /"]],"start1":3146,"start2":3146,"length1":18,"length2":18},{"diffs":[[0,"een read"],[-1,"\r"],[0,"\n"],[1," "],[0,"       t"]],"start1":3215,"start2":3215,"length1":18,"length2":18},{"diffs":[[0,"attrs) {"],[-1,"\r"],[0,"\n       "]],"start1":3261,"start2":3261,"length1":17,"length2":16},{"diffs":[[0,"        "],[1," "],[0,"args[2]."]],"start1":3273,"start2":3273,"length1":16,"length2":17},{"diffs":[[0,"rguments"],[-1,"\r"],[0,"\n"],[1," "],[0,"        "]],"start1":3344,"start2":3344,"length1":18,"length2":18},{"diffs":[[0,", args);"],[-1,"\r"],[0,"\n"],[1," "],[0,"       }"]],"start1":3395,"start2":3395,"length1":18,"length2":18},{"diffs":[[0,"      })"],[-1,"\r"],[0,"\n"],[1," "],[0,"      "],[1," "],[0,"return x"]],"start1":3406,"start2":3406,"length1":24,"length2":25},{"diffs":[[0,"urn xhr;"],[-1,"\r"],[0,"\n    },"],[-1,"\r"],[0,"\n    // "]],"start1":3426,"start2":3426,"length1":25,"length2":23},{"diffs":[[0,"uses to "],[-1,"\r"],[0,"\n    // "]],"start1":3511,"start2":3511,"length1":17,"length2":16},{"diffs":[[0," server."],[-1,"\r"],[0,"\n    sav"]],"start1":3548,"start2":3548,"length1":17,"length2":16},{"diffs":[[0,"lback) {"],[-1,"\r"],[0,"\n       "]],"start1":3589,"start2":3589,"length1":17,"length2":16},{"diffs":[[0,"ibutes);"],[-1,"   \r"],[0,"\n       "]],"start1":3634,"start2":3634,"length1":20,"length2":16},{"diffs":[[0,"ts = {};"],[-1,"\r"],[0,"\n       "]],"start1":3666,"start2":3666,"length1":17,"length2":16},{"diffs":[[0,"ttachment) {"],[-1,"\r"],[0,"\n           "]],"start1":3743,"start2":3743,"length1":25,"length2":24},{"diffs":[[0,"inary\");"],[-1,"\r"],[0,"\n       "]],"start1":3792,"start2":3792,"length1":17,"length2":16},{"diffs":[[0,"y\");\n        });"],[-1,"\r"],[0,"\n        // If n"]],"start1":3796,"start2":3796,"length1":33,"length2":32},{"diffs":[[0,"ght away"],[-1,"\r"],[0,"\n       "]],"start1":3885,"start2":3885,"length1":17,"length2":16},{"diffs":[[0,"=== 0) {"],[-1,"\r"],[0,"\n       "]],"start1":3925,"start2":3925,"length1":17,"length2":16},{"diffs":[[0,"ck(json)"],[-1," \r"],[0,"\n       "]],"start1":3952,"start2":3952,"length1":18,"length2":16},{"diffs":[[0," return;"],[-1,"\r"],[0,"\n       "]],"start1":3972,"start2":3972,"length1":17,"length2":16},{"diffs":[[0,"eturn;\n        }"],[-1,"\r"],[0,"\n        // We n"]],"start1":3974,"start2":3974,"length1":33,"length2":32},{"diffs":[[0,"chronous"],[-1,"\r"],[0,"\n       "]],"start1":4058,"start2":4058,"length1":17,"length2":16},{"diffs":[[0,"l loaded"],[-1,"\r"],[0,"\n       "]],"start1":4124,"start2":4124,"length1":17,"length2":16},{"diffs":[[0,"= 0;"],[-1,"\r\n        console.log(attachments);\r"],[0,"\n   "]],"start1":4153,"start2":4153,"length1":44,"length2":8},{"diffs":[[0,"hment) {"],[-1,"\r\n\r"],[1,"\n"],[0,"\n       "]],"start1":4200,"start2":4200,"length1":19,"length2":17},{"diffs":[[0,"r();"],[-1,"\r\n            console.log(fReader)\r"],[0,"\n   "]],"start1":4249,"start2":4249,"length1":43,"length2":8},{"diffs":[[0,"t) {"],[-1,"\r\n               \r"],[1,"\n"],[0,"\n   "]],"start1":4296,"start2":4296,"length1":26,"length2":9},{"diffs":[[0,"unter++;"],[-1,"\r"],[0,"\n       "]],"start1":4320,"start2":4320,"length1":17,"length2":16},{"diffs":[[0,"\",\")[1];"],[-1,"\r"],[0,"\n       "]],"start1":4382,"start2":4382,"length1":17,"length2":16},{"diffs":[[0,".id] = {"],[-1,"\r"],[0,"\n       "]],"start1":4435,"start2":4435,"length1":17,"length2":16},{"diffs":[[0,"_type\"),"],[-1,"\r"],[0,"\n       "]],"start1":4501,"start2":4501,"length1":17,"length2":16},{"diffs":[[0,"ta: data"],[-1,"\r"],[0,"\n       "]],"start1":4532,"start2":4532,"length1":17,"length2":16},{"diffs":[[0,"               }"],[-1,"\r"],[0,"\n               "]],"start1":4542,"start2":4542,"length1":33,"length2":32},{"diffs":[[0,"ength) {"],[-1,"\r"],[0,"\n       "]],"start1":4603,"start2":4603,"length1":17,"length2":16},{"diffs":[[0,"        "],[-1,"\r\n            "],[-1,"     "],[0,"   callb"]],"start1":4621,"start2":4621,"length1":35,"length2":16},{"diffs":[[0,"k(json);"],[-1,"\r"],[0,"\n       "]],"start1":4639,"start2":4639,"length1":17,"length2":16},{"diffs":[[0,"               }"],[-1,"\r"],[0,"\n            }\r\n"]],"start1":4649,"start2":4649,"length1":33,"length2":32},{"diffs":[[0," }\n            }"],[-1,"\r"],[0,"\n            fRe"]],"start1":4663,"start2":4663,"length1":33,"length2":32},{"diffs":[[0,"inary\"))"],[-1,"\r"],[0,"\n       "]],"start1":4731,"start2":4731,"length1":17,"length2":16},{"diffs":[[0,"      })"],[-1,"\r"],[0,"\n    },"],[-1,"\r"],[0,"\n    idA"]],"start1":4742,"start2":4742,"length1":25,"length2":23},{"diffs":[[0,"_id\""],[-1,"\r"],[0,"\n});"],[-1,"\r\n\r\n\r"],[1,"\n\n"],[0,"\nfun"]],"start1":4776,"start2":4776,"length1":18,"length2":14},{"diffs":[[0,"el, model) {"],[-1,"\r"],[0,"\n    // We n"]],"start1":4810,"start2":4810,"length1":25,"length2":24},{"diffs":[[0,"rag over"],[-1,"\r"],[0,"\n    el."]],"start1":4903,"start2":4903,"length1":17,"length2":16},{"diffs":[[0,"', function(e) {"],[-1,"\r"],[0,"\n        e.preve"]],"start1":4945,"start2":4945,"length1":33,"length2":32},{"diffs":[[0,"t();"],[-1,"\r"],[0,"\n    });"],[-1,"\r\n\r"],[1,"\n"],[0,"\n   "]],"start1":4985,"start2":4985,"length1":20,"length2":17},{"diffs":[[0," the element"],[-1,"\r"],[0,"\n    // and "]],"start1":5040,"start2":5040,"length1":25,"length2":24},{"diffs":[[0,"tachment"],[-1,"\r"],[0,"\n    // "]],"start1":5112,"start2":5112,"length1":17,"length2":16},{"diffs":[[0," save it"],[-1,"\r"],[0,"\n    el."]],"start1":5131,"start2":5131,"length1":17,"length2":16},{"diffs":[[0,"ion(e) {"],[-1,"\r"],[1,"\n        console.log(\"DROPPED\")"],[0,"\n       "]],"start1":5177,"start2":5177,"length1":17,"length2":47},{"diffs":[[0,"fault();"],[-1,"\r"],[0,"\n       "]],"start1":5236,"start2":5236,"length1":17,"length2":16},{"diffs":[[0,"iles[0];"],[-1,"\r\n\r"],[1,"\n"],[0,"\n       "]],"start1":5280,"start2":5280,"length1":19,"length2":17},{"diffs":[[0,", file);"],[-1,"\r"],[0,"\n       "]],"start1":5316,"start2":5316,"length1":17,"length2":16},{"diffs":[[0,".save();"],[-1,"\r"],[0,"\n       "]],"start1":5341,"start2":5341,"length1":17,"length2":16},{"diffs":[[0,"remove()"],[-1,"\r"],[0,"\n       "]],"start1":5367,"start2":5367,"length1":17,"length2":16},{"diffs":[[0,"el);"],[-1,"\r"],[0,"\n    });"],[-1,"\r"],[0,"\n}"],[-1,"\r"],[0,"\n// "]],"start1":5475,"start2":5475,"length1":21,"length2":18},{"diffs":[[0,"/ VIEWS "],[-1,"\r"],[0,"\n// Atta"]],"start1":5491,"start2":5491,"length1":17,"length2":16},{"diffs":[[0,"achments"],[-1,"\r\n\r"],[1,"\n"],[0,"\nBackbon"]],"start1":5506,"start2":5506,"length1":19,"length2":17},{"diffs":[[0,"iew.extend({"],[-1,"\r"],[0,"\n    initial"]],"start1":5554,"start2":5554,"length1":25,"length2":24},{"diffs":[[0,"ze: function() {"],[-1,"\r"],[0,"\n        this.mo"]],"start1":5579,"start2":5579,"length1":33,"length2":32},{"diffs":[[0,"t, this)"],[-1,"\r"],[0,"\n    },"],[-1,"\r"],[0,"\n    // "]],"start1":5662,"start2":5662,"length1":25,"length2":23},{"diffs":[[0,"od from the "],[-1,"\r"],[0,"\n    // pare"]],"start1":5742,"start2":5742,"length1":25,"length2":24},{"diffs":[[0,"called. "],[-1,"\r"],[0,"\n    add"]],"start1":5791,"start2":5791,"length1":17,"length2":16},{"diffs":[[0,"model) {"],[-1,"\r"],[0,"\n       "]],"start1":5828,"start2":5828,"length1":17,"length2":16},{"diffs":[[0,"s.options.view({"],[-1,"\r"],[0,"\n            att"]],"start1":5860,"start2":5860,"length1":33,"length2":32},{"diffs":[[0,"   attributes: {"],[-1,"\r"],[0,"\n               "]],"start1":5886,"start2":5886,"length1":33,"length2":32},{"diffs":[[0,"odel.cid"],[-1,"\r"],[0,"\n       "]],"start1":5924,"start2":5924,"length1":17,"length2":16},{"diffs":[[0,"d\n            },"],[-1,"\r"],[0,"\n            mod"]],"start1":5931,"start2":5931,"length1":33,"length2":32},{"diffs":[[0,"l: model"],[-1,"\r"],[0,"\n       "]],"start1":5964,"start2":5964,"length1":17,"length2":16},{"diffs":[[0,"     });"],[-1,"\r"],[1,"\n        makeDroppable(v.el, model)"],[0,"\n       "]],"start1":5976,"start2":5976,"length1":17,"length2":51},{"diffs":[[0,".remove)"],[-1,"\r"],[0,"\n       "]],"start1":6058,"start2":6058,"length1":17,"length2":16},{"diffs":[[0,"er().el)"],[-1,"\r"],[0,"\n    },"],[-1,"\r"],[0,"\n    ren"]],"start1":6097,"start2":6097,"length1":25,"length2":23},{"diffs":[[0,"er: function() {"],[-1,"\r"],[0,"\n        var tha"]],"start1":6121,"start2":6121,"length1":33,"length2":32},{"diffs":[[0,"var that = this;"],[-1,"\r"],[0,"\n        this.$e"]],"start1":6146,"start2":6146,"length1":33,"length2":32},{"diffs":[[0,"empty();"],[-1,"\r\n\r"],[1,"\n"],[0,"\n       "]],"start1":6180,"start2":6180,"length1":19,"length2":17},{"diffs":[[0,"n(key) {"],[-1,"\r"],[0,"\n       "]],"start1":6249,"start2":6249,"length1":17,"length2":16},{"diffs":[[0,"s.view({"],[-1,"\r"],[0,"\n       "]],"start1":6299,"start2":6299,"length1":17,"length2":16},{"diffs":[[0,"butes: {"],[-1,"\r"],[0,"\n       "]],"start1":6329,"start2":6329,"length1":17,"length2":16},{"diffs":[[0," id: key"],[-1,"\r"],[0,"\n       "]],"start1":6357,"start2":6357,"length1":17,"length2":16},{"diffs":[[0,"      },"],[-1,"\r"],[0,"\n       "]],"start1":6376,"start2":6376,"length1":17,"length2":16},{"diffs":[[0,"get(key)"],[-1,"\r"],[0,"\n       "]],"start1":6439,"start2":6439,"length1":17,"length2":16},{"diffs":[[0,"render()"],[-1,"\r"],[0,"\n       "]],"start1":6463,"start2":6463,"length1":17,"length2":16},{"diffs":[[0,"et(key))"],[-1,"\r"],[0,"\n       "]],"start1":6542,"start2":6542,"length1":17,"length2":16},{"diffs":[[0,"iew.el);"],[-1,"\r"],[0,"\n       "]],"start1":6583,"start2":6583,"length1":17,"length2":16},{"diffs":[[0,".el);\n        })"],[-1,"\r"],[0,"\n        return "]],"start1":6586,"start2":6586,"length1":33,"length2":32},{"diffs":[[0,"his;"],[-1,"\r"],[0,"\n    }"],[-1,"\r"],[0,"\n})"],[-1,"\r\n\r"],[1,"\n"],[0,"\n// "]],"start1":6619,"start2":6619,"length1":22,"length2":18},{"diffs":[[0,"// VIEW "],[-1,"\r"],[0,"\n// Couc"]],"start1":6634,"start2":6634,"length1":17,"length2":16},{"diffs":[[0,"odel"],[-1,"\r\n//\r\n\r"],[1,"\n"],[0,"\nBac"]],"start1":6655,"start2":6655,"length1":15,"length2":9},{"diffs":[[0,"nd({"],[-1,"\r"],[0,"\n    // "],[-1,"\r"],[0,"\n   "]],"start1":6703,"start2":6703,"length1":18,"length2":16},{"diffs":[[0,"tion() {"],[-1,"\r"],[0,"\n       "]],"start1":6739,"start2":6739,"length1":17,"length2":16},{"diffs":[[0,"({})"],[-1,"\r"],[0,"\n    },"],[-1,"\r\n\r"],[1,"\n"],[0,"\n   "]],"start1":6790,"start2":6790,"length1":19,"length2":16},{"diffs":[[0,"hin the "],[-1,"\r"],[0,"\n    // "]],"start1":6872,"start2":6872,"length1":17,"length2":16},{"diffs":[[0,"ackbone view"],[-1,"\r"],[0,"\n    // to r"]],"start1":6945,"start2":6945,"length1":25,"length2":24},{"diffs":[[0,"chment. "],[-1,"\r"],[0,"\n    bui"]],"start1":6995,"start2":6995,"length1":17,"length2":16},{"diffs":[[0,"ion("],[-1,"view"],[0,") {"],[-1,"\r"],[0,"\n   "]],"start1":7031,"start2":7031,"length1":16,"length2":11},{"diffs":[[0," = this;"],[-1,"\r"],[0,"\n       "]],"start1":7055,"start2":7055,"length1":17,"length2":16},{"diffs":[[0,"hments({"],[-1,"\r"],[0,"\n       "]],"start1":7115,"start2":7115,"length1":17,"length2":16},{"diffs":[[0,"s.model,"],[-1,"\r"],[0,"\n       "]],"start1":7146,"start2":7146,"length1":17,"length2":16},{"diffs":[[0,"ew: "],[-1,"v"],[1,"that.options.attachmentV"],[0,"iew"],[-1,"\r"],[0,"\n   "]],"start1":7169,"start2":7169,"length1":13,"length2":35},{"diffs":[[0,"tView\n        })"],[-1,"\r"],[0,"\n        var ele"]],"start1":7195,"start2":7195,"length1":33,"length2":32},{"diffs":[[0,"er().$el"],[-1,"\r"],[0,"\n       "]],"start1":7252,"start2":7252,"length1":17,"length2":16},{"diffs":[[0,"rtable({"],[-1,"\r"],[0,"\n       "]],"start1":7279,"start2":7279,"length1":17,"length2":16},{"diffs":[[0,"t, ui) {"],[-1,"\r"],[0,"\n       "]],"start1":7321,"start2":7321,"length1":17,"length2":16},{"diffs":[[0,"rray\"));"],[-1,"\r"],[0,"\n       "]],"start1":7401,"start2":7401,"length1":17,"length2":16},{"diffs":[[0,"       }"],[-1,"\r"],[0,"\n       "]],"start1":7415,"start2":7415,"length1":17,"length2":16},{"diffs":[[0,"      })"],[-1,"\r"],[0,"\n       "]],"start1":7426,"start2":7426,"length1":17,"length2":16},{"diffs":[[0,").el"],[-1,"\r"],[0,"\n    }"],[-1,"\r"],[0,"\n})"]],"start1":7471,"start2":7471,"length1":15,"length2":13}]],"length":7484,"saved":false}
{"contributors":[],"silentsave":false,"ts":1361482542149,"patch":[[{"diffs":[[0,"d\"\n});\n\n"],[1,"// Takes the Attachment View and makes it into a droppable element\n// and provides a callback to be executed when a file is dropped\n// on that element"],[0,"\nfunctio"]],"start1":4778,"start2":4778,"length1":16,"length2":166},{"diffs":[[0,"DROPPED\""],[1,", e"],[0,")\n      "]],"start1":5357,"start2":5357,"length1":16,"length2":19},{"diffs":[[0,"del.set("],[-1,"\""],[1,"{"],[0,"binary"],[-1,"\", file"],[1,": file, content_type: file.type, id: file.name}"],[0,");\n     "]],"start1":5453,"start2":5453,"length1":30,"length2":70}]],"length":7677,"saved":false}
{"ts":1361483454365,"patch":[[{"diffs":[[0,"ile.name});\n"],[1,"        console.log(model.collection)\n"],[0,"        // m"]],"start1":5506,"start2":5506,"length1":24,"length2":62}]],"length":7715,"saved":false}
{"ts":1361484377925,"patch":[[{"diffs":[[0,"hments)\n"],[1,"            resp._attachments.belongs_to = this;"],[0,"\n       "]],"start1":2655,"start2":2655,"length1":16,"length2":64}]],"length":7763,"saved":false}
{"ts":1361484426923,"patch":[[{"diffs":[[0,"ts)\n"],[-1,"            resp._attachments.belongs_to = this;\n"],[0,"    "]],"start1":2659,"start2":2659,"length1":57,"length2":8}]],"length":7714,"saved":false}
{"ts":1361485011769,"patch":[[{"diffs":[[0,"pable(v.el, "],[1,"model, this."],[0,"model)\n     "]],"start1":6231,"start2":6231,"length1":24,"length2":36},{"diffs":[[0,"get(key)"],[1,", that.model"],[0,")\n      "]],"start1":6783,"start2":6783,"length1":16,"length2":28}]],"length":7738,"saved":false}
{"contributors":[],"silentsave":false,"ts":1361527032575,"patch":[[{"diffs":[[0,".type)\n    }"],[-1,""],[0,""],[1,",\n    parent: function() { console.log(this.options); return this.belongs_to }"],[0,"\n    // Over"]],"start1":157,"start2":157,"length1":24,"length2":102},{"diffs":[[0,"achments"],[-1,""],[0,""],[1,"(null)"],[0,",\n      "]],"start1":1474,"start2":1474,"length1":16,"length2":22},{"diffs":[[0,"sed_attachments)"],[1,"           "],[0,"\n        }\n     "]],"start1":2617,"start2":2617,"length1":32,"length2":43},{"diffs":[[0,"achments"],[-1,")"],[1,", {belongs_to: this})           "],[0,"\n       "]],"start1":2748,"start2":2748,"length1":17,"length2":48},{"diffs":[[0,"ble(el, "],[-1,"model"],[1,"attachment, parent"],[0,") {\n    "]],"start1":5081,"start2":5081,"length1":21,"length2":34},{"diffs":[[0,"        "],[-1,"model"],[1,"attachment"],[0,".set({bi"]],"start1":5581,"start2":5581,"length1":21,"length2":26},{"diffs":[[0,"    "],[-1," console.log(model.collection"],[1,"// parent.set(\"attachments_order\", parent.get(\"attachments_order\".push()))\n        console.log(\"here\", attachment.parent()"],[0,")\n  "]],"start1":5664,"start2":5664,"length1":37,"length2":130}]],"length":7975,"saved":false}
{"ts":1361527198558,"patch":[[{"diffs":[[0,"d({\n"],[-1,"    defaults: {\n        \"_attachments\": new Backbone.Collection.Attachments(null),\n        \"attachments_order\": []\n    },"],[0,"\n   "]],"start1":1403,"start2":1403,"length1":129,"length2":8},{"diffs":[[0,"hments\"\n"],[1,"        resp.attachments_order = resp.attachments_order || []\n"],[0,"        "]],"start1":2747,"start2":2747,"length1":16,"length2":78}]],"length":7916,"saved":false}
{"contributors":[],"silentsave":false,"ts":1361645435340,"patch":[[{"diffs":[[0,"xtend({\n"],[1,"    constructor: function(attributes, options) {\n        this.set(\"_attachments\", new Backbone.Collection.Attachments)\n        Backbone.Model.apply(this,arguments)\n    },\n    addNewAttachment: function() {\n      this.get(\"_attachments\").add({})\n    },"],[0,"\n"],[-1,""],[0,"    // W"]],"start1":1399,"start2":1399,"length1":17,"length2":268},{"diffs":[[0,"is)\n"],[-1,"        if (this.get(\"_attachments\") instanceof Backbone.Collection.Attachments) {\n"],[0,"    "]],"start1":2594,"start2":2594,"length1":91,"length2":8},{"diffs":[[0,"    "],[-1,"}\n        else {\n            resp._attachments = new Backbone.Collection.Attachments(parsed_attachments, {belongs_to: this})           \n        }"],[0,"\n   "]],"start1":2696,"start2":2696,"length1":153,"length2":8},{"diffs":[[0,"ttributes);\n"],[1,"        if(this.get(\"_attachments\")) {\n"],[0,"        json"]],"start1":3720,"start2":3720,"length1":24,"length2":63},{"diffs":[[0,"\n        })\n"],[1,"        }\n        else { callback(json) }\n"],[0,"    },\n    i"]],"start1":4867,"start2":4867,"length1":24,"length2":66},{"diffs":[[0,"e: function() {\n"],[1,"\n"],[0,"        this.mod"]],"start1":6092,"start2":6092,"length1":32,"length2":33},{"diffs":[[0,"     this.model."],[-1,"get(\"_a"],[1,"addNewA"],[0,"ttachments\").add"]],"start1":7288,"start2":7288,"length1":39,"length2":39},{"diffs":[[0,"ewAttachment"],[-1,"s\").add({}"],[1,"("],[0,")\n    },\n\n  "]],"start1":7308,"start2":7308,"length1":34,"length2":25}]],"length":8012,"saved":false}
{"ts":1361648549206,"patch":[[{"diffs":[[0,") {\n"],[-1,"        this.set(\"_attachments\", new Backbone.Collection.Attachments)\n"],[0,"    "]],"start1":1452,"start2":1452,"length1":78,"length2":8}]],"length":7942,"saved":false}
{"ts":1361648551329,"patch":[[{"diffs":[[0,"tes, options) {\n"],[1,"        //this.set(\"_attachments\", new Backbone.Collection.Attachments)\n"],[0,"        Backbone"]],"start1":1440,"start2":1440,"length1":32,"length2":104}]],"length":8014,"saved":false}
{"ts":1361648565118,"patch":[[{"diffs":[[0,"        "],[-1,"//"],[0,"this.set"]],"start1":1456,"start2":1456,"length1":18,"length2":16}]],"length":8012,"saved":false}
{"ts":1361648775947,"patch":[[{"diffs":[[0,"is.set(\""],[-1,"_attachments"],[1,"boo"],[0,"\", new B"]],"start1":1466,"start2":1466,"length1":28,"length2":19}]],"length":8003,"saved":false}
{"ts":1361648849485,"patch":[[{"diffs":[[0,"his."],[-1,"set(\"boo\","],[1,"_attachments ="],[0," new"]],"start1":1465,"start2":1465,"length1":18,"length2":22}]],"length":8007,"saved":false}
{"ts":1361648853723,"patch":[[{"diffs":[[0,".Attachments"],[-1,")"],[1,";"],[0,"\n        Bac"]],"start1":1507,"start2":1507,"length1":25,"length2":25}]],"length":8007,"saved":false}
{"ts":1361648918259,"patch":[[{"diffs":[[0,"\n      this."],[-1,"get(\""],[0,"_attachments"]],"start1":1607,"start2":1607,"length1":29,"length2":24},{"diffs":[[0,"achments"],[-1,"\")"],[0,".add({})"]],"start1":1623,"start2":1623,"length1":18,"length2":16},{"diffs":[[0,"    "],[-1,"resp._attachments = this.get(\""],[1,"this."],[0,"_att"]],"start1":2594,"start2":2594,"length1":38,"length2":13},{"diffs":[[0,"achments"],[-1,"\")"],[0,".reset(p"]],"start1":2607,"start2":2607,"length1":18,"length2":16},{"diffs":[[0,"        "],[-1,"resp"],[1,"this"],[0,"._attach"]],"start1":2662,"start2":2662,"length1":20,"length2":20}]],"length":7973,"saved":false}
{"ts":1361648944652,"patch":[[{"diffs":[[0,"    if(this."],[-1,"get(\""],[0,"_attachments"]],"start1":3697,"start2":3697,"length1":29,"length2":24},{"diffs":[[0,"achments"],[-1,"\")"],[1,".length > 0"],[0,") {\n    "]],"start1":3713,"start2":3713,"length1":18,"length2":27}]],"length":7977,"saved":false}
{"ts":1361649115633,"patch":[[{"diffs":[[0," = this."],[-1,"get(\""],[0,"_attachm"]],"start1":3791,"start2":3791,"length1":21,"length2":16},{"diffs":[[0,"achments"],[-1,"\")"],[0,".filter("]],"start1":3803,"start2":3803,"length1":18,"length2":16},{"diffs":[[0,"unction() {\n"],[-1,"\n"],[0,"        this"]],"start1":6054,"start2":6054,"length1":25,"length2":24},{"diffs":[[0," this.model."],[-1,"get(\""],[0,"_attachments"]],"start1":6073,"start2":6073,"length1":29,"length2":24},{"diffs":[[0,"achments"],[-1,"\")"],[0,".on(\"add"]],"start1":6089,"start2":6089,"length1":18,"length2":16}]],"length":7962,"saved":false}
{"ts":1361649322410,"patch":[[{"diffs":[[0,"s.model."],[-1,"get(\""],[0,"attachme"]],"start1":6676,"start2":6676,"length1":21,"length2":16},{"diffs":[[0,"ts_order"],[-1,"\")"],[0,".forEach"]],"start1":6693,"start2":6693,"length1":18,"length2":16}]],"length":7955,"saved":false}
{"ts":1361649329927,"patch":[[{"diffs":[[0,".el, that.model."],[-1,"get(\""],[0,"_attachments\").g"]],"start1":6973,"start2":6973,"length1":37,"length2":32},{"diffs":[[0,"del._attachments"],[-1,"\")"],[0,".get(key), that."]],"start1":6985,"start2":6985,"length1":34,"length2":32}]],"length":7948,"saved":false}
{"ts":1361649363062,"patch":[[{"diffs":[[0,"s.model."],[1,"get(\""],[0,"attachme"]],"start1":6676,"start2":6676,"length1":16,"length2":21},{"diffs":[[0,"ts_order"],[1,"\")"],[0,".forEach"]],"start1":6698,"start2":6698,"length1":16,"length2":18},{"diffs":[[0,"t.model."],[-1,"get(\""],[0,"_attachm"]],"start1":6886,"start2":6886,"length1":21,"length2":16},{"diffs":[[0,"achments"],[-1,"\")"],[0,".get(key"]],"start1":6898,"start2":6898,"length1":18,"length2":16}]],"length":7948,"saved":false}
