{"ts":1361361362355,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"Backbone.Model.Attachment = Backbone.Model.extend({})\n\nBackbone.Collection.Attachments = Backbone.Collection.extend({\n    model: Backbone.Model.Attachment\n})\n\nBackbone.Model.CouchDB = Backbone.Model.extend({\n    defaults: {\n        \"_attachments\": new Backbone.Collection.Attachments,\n        \"attachments_order\": []\n    },\n    parse: function(resp) {\n        var parsed_attachments = _.map(resp._attachments, function(value, key, list) {\n            return {\n                id: key,\n                content_type: list[key].content_type,\n                length: list[key].length,\n            }\n        }, this)\n        if (this.get(\"_attachments\") instanceof Backbone.Collection.Attachments) {\n            resp._attachments = this.get(\"_attachments\").reset(parsed_attachments)\n        }\n        else {\n            resp._attachments = new Backbone.Collection.Attachments(parsed_attachments)\n        }\n        resp._attachments.url = this.url() + \"/attachments\"\n        return resp;\n    },\n    updateAttachmentsOrder: function(new_order) {\n        this.save({\n            \"attachments_order\": new_order\n        }, {\n            patch: true\n        });\n    },\n    idAttribute: \"_id\"\n});\n\n\nfunction makeDroppable(el,model) {\n    // We need this to prevent the browser using its standard default when you drag over\n    el.addEventListener('dragover', function(e) {\n        e.preventDefault();\n    });\n\n    el.addEventListener('drop', function(e) {\n        e.preventDefault();\n\n       \n            var file =  e.dataTransfer.files[0];\n            var reader = new FileReader();\n            reader.onload = function() {\n                model.set(\"binary\", this.result);\n                model.save();\n               // $('img').remove()\n                //$('<img>').attr('title', file.name).attr('src', this.result).css('width', '50px').appendTo(el);\n            };\n            reader.readAsBinaryString(file);\n        \n    });\n\n}\n// VIEW \n// Attachments\n\nBackbone.View.Attachments = Backbone.View.extend({\n    initialize: function() {\n        this.model.get(\"_attachments\").on(\"add\", this.addAttachment, this)\n    },\n    // addAttachment is called whenever the addAttachment() method from the \n    // parent view class (below) is called. \n    addAttachment: function(model) {\n        var v = new this.options.view({\n            attributes: {\n                id: model.cid\n            },\n            model: model\n        });\n        v.listenTo(model, 'destroy', v.remove)\n        this.$el.append(v.render().el)\n    },\n    render: function() {\n        var that = this;\n        this.$el.empty();\n\n        this.model.get(\"attachments_order\").forEach(function(key) {\n            var subview = new that.options.view({\n                attributes: {\n                    id: key\n                },\n                model: that.model.get(\"_attachments\").get(key)\n            }).render()\n            makeDroppable(subview.el, that.model.get(\"_attachments\").get(key))\n            that.$el.append(subview.el);\n        })\n        return this;\n    }\n})\n\n// VIEW \n// CouchDB Model\n//\n\n\nBackbone.View.CouchDB = Backbone.View.extend({\n    // \n    addAttachment: function() {\n        this.model.get(\"_attachments\").add({})\n    },\n\n    // Extend this view and then call buildAttachments(view) from within the \n    // extended view's render() method, passing it an extended Backbone view\n    // to render each individual attachment. b\n    buildAttachments: function(view) {\n        var that = this;\n        var rendered_view = new Backbone.View.Attachments({\n            model: this.model,\n            view: view\n        })\n        var element = rendered_view.render().$el\n        element.sortable({\n            update: function(event, ui) {\n                that.model.updateAttachmentsOrder($(this).sortable(\"toArray\"));\n            }\n        })\n\n        return rendered_view.render().el\n    }\n})\n"]],"start1":0,"start2":0,"length1":0,"length2":3870}]],"length":3870}
{"contributors":[],"silentsave":false,"ts":1361361370851,"patch":[[{"diffs":[[0,"nd({"],[-1,"})\n\nBackbone.Collection.Attachments = Backbone.Collection.extend({\n    model: Backbone.Model.Attachment\n})\n\nBackbone.Model.CouchDB = Backbone.Model.extend({\n    defaults: {\n        \"_attachments\": new Backbone.Collection.Attachments,\n        \"attachments_order\": []\n    },\n    parse: function(resp) {\n        var parsed_attachments = _.map(resp._attachments, function(value, key, list) {\n            return {\n                id: key,\n                content_type: list[key].content_type,\n                length: list[key].length,\n            }\n        }, this)\n        if (this.get(\"_attachments\") instanceof Backbone.Collection.Attachments) {\n            resp._attachments = this.get(\"_attachments\").reset(parsed_attachments)\n        }\n        else {\n            resp._attachments = new Backbone.Collection.Attachments(parsed_attachments)\n        }\n        resp._attachments.url = this.url() + \"/attachments\"\n        return resp;\n    },\n    updateAttachmentsOrder: function(new_order) {\n        this.save({\n            \"attachments_order\": new_order\n        }, {\n            patch: true\n        });\n    },\n    idAttribute: \"_id\"\n});\n\n\nfunction makeDroppable(el,model) {\n    // We need this to prevent the browser using its standard default when you drag over\n    el.addEventListener('dragover', function(e) {\n        e.preventDefault();\n    });\n\n    el.addEventListener('drop', function(e) {\n        e.preventDefault();\n\n       \n            var file =  e.dataTransfer.files[0];\n            var reader = new FileReader();\n            reader.onload = function() {\n                model.set(\"binary\", this.result);\n                model.save();\n               // $('img').remove()\n                //$('<img>').attr('title', file.name).attr('src', this.result).css('width', '50px').appendTo(el);\n            };\n            reader.readAsBinaryString(file);\n        \n    });\n\n}\n// VIEW \n// Attachments\n\nBackbone.View.Attachments = Backbone.View.extend({\n    initialize: function() {\n        this.model.get(\"_attachments\").on(\"add\", this.addAttachment, this)\n    },\n    // addAttachment is called whenever the addAttachment() method from the \n    // parent view class (below) is called. \n    addAttachment: function(model) {\n        var v = new this.options.view({\n            attributes: {\n                id: model.cid\n            },\n            model: model\n        });\n        v.listenTo(model, 'destroy', v.remove)\n        this.$el.append(v.render().el)\n    },\n    render: function() {\n        var that = this;\n        this.$el.empty();\n\n        this.model.get(\"attachments_order\").forEach(function(key) {\n            var subview = new that.options.view({\n                attributes: {\n                    id: key\n                },\n                model: that.model.get(\"_attachments\").get(key)\n            }).render()\n            makeDroppable(subview.el, that.model.get(\"_attachments\").get(key))\n            that.$el.append(subview.el);\n        })\n        return this;\n    }\n})\n\n// VIEW \n// CouchDB Model\n//\n\n\nBackbone.View.CouchDB = Backbone.View.extend({\n    // \n    addAttachment: function() {\n        this.model.get(\"_attachments\").add({})\n    },\n\n    // Extend this view and then call buildAttachments(view) from within the \n    // extended view's render() method, passing it an extended Backbone view\n    // to render each individual attachment. b\n    buildAttachments: function(view) {\n        var that = this;\n        var rendered_view = new Backbone.View.Attachments({\n            model: this.model,\n            view: view\n        })\n        var element = rendered_view.render().$el\n        element.sortable({\n            update: function(event, ui) {\n                that.model.updateAttachmentsOrder($(this).sortable(\"toArray\"));\n            }\n        })\n\n        return rendered_view.render().el\n    }\n})"],[1,"\r\n    url: function() {\r\n        return this.collection.url + \"/\" + this.id + \"/\" + this.rev;\r\n    },\r\n    // Overwrite the Backbone.sync method for CREATE and UPDATE calls\r\n    // as we want to send just the binary data of the attachment\r\n    // We shouldn't concern ourselves with GETting the attachment as \r\n    // attachments should always be created via the parent collection\r\n    //\r\n    // options is created by the Backbone.Model.save() method and \r\n    // it contains the success callback for the low-level jQuery $.ajax\r\n    // method. We augment it with our own options.\r\n    /* sync: function(method, model, options) {\r\n        options.processData = false; \r\n        options.data = this.get(\"binary\");\r\n        options.url = this.url();\r\n        options.type = \"PUT\";\r\n        options.contentType = this.get(\"content_type\");\r\n        var success = options.success;\r\n        options.success = function(resp) {\r\n            if(success) success(model,resp,options);\r\n            model.trigger('sync',model.resp,options);\r\n        }\r\n        if (method === \"update\") {\r\n            $.ajax(options);\r\n        }\r\n    }*/\r\n})\r\n\r\nBackbone.Collection.Attachments = Backbone.Collection.extend({\r\n    model: Backbone.Model.Attachment\r\n})\r\n\r\nBackbone.Model.CouchDB = Backbone.Model.extend({\r\n    defaults: {\r\n        \"_attachments\": new Backbone.Collection.Attachments,\r\n        \"attachments_order\": []\r\n    },\r\n\r\n    // We overwrite the parse function as when attachments come down the \r\n    // wire we need to parse them out into a separate Backbone collection\r\n    // and make each attachment a Backbone model\r\n    parse: function(resp) {\r\n        var result = {};\r\n        _.each(resp._attachments, function(value, key, list) {\r\n            var type_number = key.split(\"-\");\r\n            var number = type_number[1];\r\n            var type = type_number[0];\r\n            result[number] = result[number] || {}\r\n            result[number][type] = {\r\n                content_type: list[key].content_type,\r\n                length: list[key].length\r\n            }\r\n        })\r\n        var parsed_attachments = _.map(resp._attachments, function(value, key, list) {\r\n            return {\r\n                id: key,\r\n                content_type: list[key].content_type,\r\n                length: list[key].length,\r\n            }\r\n        }, this)\r\n        if (this.get(\"_attachments\") instanceof Backbone.Collection.Attachments) {\r\n            resp._attachments = this.get(\"_attachments\").reset(parsed_attachments)\r\n        }\r\n        else {\r\n            resp._attachments = new Backbone.Collection.Attachments(parsed_attachments)\r\n        }\r\n        resp._attachments.url = this.url() + \"/\" + resp._id + \"/attachments\"\r\n        return resp;\r\n    },\r\n\r\n    // We call this to save the order of attachments to the server\r\n    updateAttachmentsOrder: function(new_order) {\r\n        this.save({\r\n            \"attachments_order\": new_order\r\n        }, {\r\n            patch: true\r\n        });\r\n    },\r\n    sync: function() {\r\n       var args = arguments;\r\n       var xhr;\r\n       \r\n       // Because the FileReader API is asynchronous we have to use a callback\r\n       // style to call Backbone.sync when the files have been read\r\n       this.toJSON(function(attrs) {\r\n           args[2].attrs = attrs; // args[2] is the options object from arguments\r\n           xhr = Backbone.sync.apply(this, args);\r\n       })\r\n      return xhr;\r\n    },\r\n    // We override the toJSON function as this is what Backbone.sync uses to \r\n    // save our model to the server.\r\n    toJSON: function(callback) {\r\n        var json = _.clone(this.attributes);\r\n        json._attachments = {};\r\n        var attachments = this.get(\"_attachments\").filter(function(attachment) {\r\n            return attachment.get(\"binary\");\r\n        });\r\n \r\n        // We need to use a counter as loading of the files is asynchronous\r\n        // and we do not want to return until they are all loaded\r\n        var counter = 0;\r\n        _.each(attachments, function(attachment) {\r\n\r\n            var fReader = new FileReader();\r\n            fReader.onload = function(event) {\r\n                counter++;\r\n                var data = event.target.result.split(\",\")[1];\r\n                json._attachments[attachment.id] = {\r\n                    content_type: attachment.get(\"content_type\"),\r\n                    data: data\r\n                }\r\n                if (counter == attachments.length) {\r\n                   console.log(json)\r\n                    callback(json);\r\n                }\r\n            }\r\n            fReader.readAsDataURL(attachment.get(\"binary\"))\r\n        })\r\n    },\r\n    idAttribute: \"_id\"\r\n});\r\n\r\n\r\nfunction makeDroppable(el, model) {\r\n    // We need this to prevent the browser using its standard default when you drag over\r\n    el.addEventListener('dragover', function(e) {\r\n        e.preventDefault();\r\n    });\r\n\r\n    // Listen for a file to be dropped on the element\r\n    // and then get the file, set the binary data of the attachment\r\n    // and save it\r\n    el.addEventListener('drop', function(e) {\r\n        e.preventDefault();\r\n        var file = e.dataTransfer.files[0];\r\n\r\n        model.set(\"binary\", file);\r\n        // model.save();\r\n        $('img').remove()\r\n        $('<img>').attr('title', file.name).attr('src', this.result).css('width', '50px').appendTo(el);\r\n    });\r\n}\r\n// VIEWS \r\n// Attachments\r\n\r\nBackbone.View.Attachments = Backbone.View.extend({\r\n    initialize: function() {\r\n        this.model.get(\"_attachments\").on(\"add\", this.addAttachment, this)\r\n    },\r\n    // addAttachment is called whenever the addAttachment() method from the \r\n    // parent view class (below) is called. \r\n    addAttachment: function(model) {\r\n        var v = new this.options.view({\r\n            attributes: {\r\n                id: model.cid\r\n            },\r\n            model: model\r\n        });\r\n        v.listenTo(model, 'destroy', v.remove)\r\n        this.$el.append(v.render().el)\r\n    },\r\n    render: function() {\r\n        var that = this;\r\n        this.$el.empty();\r\n\r\n        this.model.get(\"attachments_order\").forEach(function(key) {\r\n            var subview = new that.options.view({\r\n                attributes: {\r\n                    id: key\r\n                },\r\n                model: that.model.get(\"_attachments\").get(key)\r\n            }).render()\r\n            makeDroppable(subview.el, that.model.get(\"_attachments\").get(key))\r\n            that.$el.append(subview.el);\r\n        })\r\n        return this;\r\n    }\r\n})\r\n\r\n// VIEW \r\n// CouchDB Model\r\n//\r\n\r\nBackbone.View.CouchDB = Backbone.View.extend({\r\n    // \r\n    addAttachment: function() {\r\n        this.model.get(\"_attachments\").add({})\r\n    },\r\n\r\n    // Extend this view and then call buildAttachments(view) from within the \r\n    // extended view's render() method, passing it an extended Backbone view\r\n    // to render each individual attachment. \r\n    buildAttachments: function(view) {\r\n        var that = this;\r\n        var rendered_view = new Backbone.View.Attachments({\r\n            model: this.model,\r\n            view: view\r\n        })\r\n        var element = rendered_view.render().$el\r\n        element.sortable({\r\n            update: function(event, ui) {\r\n                that.model.updateAttachmentsOrder($(this).sortable(\"toArray\"));\r\n            }\r\n        })\r\n\r\n        return rendered_view.render().el\r\n    }\r\n})\r"],[0,"\n"]],"start1":47,"start2":47,"length1":3823,"length2":7367}]],"length":7414,"saved":false}
{"contributors":[],"silentsave":false,"ts":1361363963570,"patch":[[{"diffs":[[0,"({\r\n"],[-1,"    url: function() {\r\n        return this.collection.url + \"/\" + this.id + \"/\" + this.rev;\r\n    },"],[0,"\r\n  "]],"start1":49,"start2":49,"length1":107,"length2":8}]],"length":7315,"saved":false}
{"contributors":[],"silentsave":false,"ts":1361364665519,"patch":[[{"diffs":[[0,"     var"],[1," xhr,"],[0," args = "]],"start1":2969,"start2":2969,"length1":16,"length2":21},{"diffs":[[0,"s;\r\n"],[-1,"       var xhr;\r\n"],[0,"    "]],"start1":2998,"start2":2998,"length1":25,"length2":8},{"diffs":[[0,"    })\r\n"],[-1,"\r\n"],[0,"        "]],"start1":7240,"start2":7240,"length1":18,"length2":16},{"diffs":[[0,"().el\r\n    }\r\n})"],[-1,"\r\n"]],"start1":7283,"start2":7283,"length1":18,"length2":16}]],"length":7299,"saved":false}
{"ts":1361364681790,"patch":[[{"diffs":[[0,"  }, this)\r\n"],[1,"        console.log(parsed_attachments)\r\n"],[0,"        if ("]],"start1":2282,"start2":2282,"length1":24,"length2":65}]],"length":7340,"saved":false}
{"ts":1361364738461,"patch":[[{"diffs":[[0,"s)\r\n"],[-1,"        console.log(parsed_attachments)\r\n"],[0,"    "]],"start1":2290,"start2":2290,"length1":49,"length2":8},{"diffs":[[0,"d_attachments)\r\n"],[1,"            console.log(resp._attachments)\r\n"],[0,"        }\r\n     "]],"start1":2562,"start2":2562,"length1":32,"length2":76}]],"length":7343,"saved":false}
{"ts":1361364776778,"patch":[[{"diffs":[[0,"    "],[-1,"console.log(resp._attachments)"],[0,"\r\n  "]],"start1":2586,"start2":2586,"length1":38,"length2":8}]],"length":7313,"saved":false}
{"ts":1361365636682,"patch":[[{"diffs":[[0,"   \r\n        }\r\n"],[1,"        console.log(resp._attachments)\r\n"],[0,"        resp._at"]],"start1":2587,"start2":2587,"length1":32,"length2":72}]],"length":7353,"saved":false}
{"ts":1361365792940,"patch":[[{"diffs":[[0," }\r\n        })\r\n"],[1,"        console.log(resp._attachments)\r\n"],[0,"        var pars"]],"start1":2011,"start2":2011,"length1":32,"length2":72}]],"length":7393,"saved":false}
{"ts":1361365865248,"patch":[[{"diffs":[[0," }\r\n"],[-1,"        console.log(resp._attachments)\r\n"],[0,"    "]],"start1":2639,"start2":2639,"length1":48,"length2":8}]],"length":7353,"saved":false}
{"ts":1361365953544,"patch":[[{"diffs":[[0,"nction(resp) {\r\n"],[1,"        var resp = _.clone(resp)\r\n"],[0,"        var resu"]],"start1":1579,"start2":1579,"length1":32,"length2":66}]],"length":7387,"saved":false}
{"contributors":[],"silentsave":false,"ts":1361368994719,"patch":[[{"diffs":[[0,"nction() {\r\n"],[1,"        console.log(\"Sent\")\r\n"],[0,"       var x"]],"start1":3043,"start2":3043,"length1":24,"length2":53}]],"length":7416,"saved":false}
{"ts":1361369501561,"patch":[[{"diffs":[[0," {\r\n"],[-1,"        console.log(\"Sent\")\r\n"],[0,"    "]],"start1":3051,"start2":3051,"length1":37,"length2":8},{"diffs":[[0,"is, args);\r\n"],[1,"           \r\n        console.log(\"Sent\")\r\n"],[0,"       })\r\n "]],"start1":3408,"start2":3408,"length1":24,"length2":66}]],"length":7429,"saved":false}
{"ts":1361369582459,"patch":[[{"diffs":[[0,"    "],[-1," console.log(\"Sent\")"],[0,"\r\n  "]],"start1":3436,"start2":3436,"length1":28,"length2":8},{"diffs":[[0,"  });\r\n "],[1,"       console.log(attachments)"],[0,"\r\n      "]],"start1":3844,"start2":3844,"length1":16,"length2":47}]],"length":7440,"saved":false}
{"ts":1361369596785,"patch":[[{"diffs":[[0,".log(attachments"],[1,".length == 0"],[0,")\r\n        // We"]],"start1":3866,"start2":3866,"length1":32,"length2":44}]],"length":7452,"saved":false}
{"ts":1361369605129,"patch":[[{"diffs":[[0,"ength =="],[1,"="],[0," 0)\r\n   "]],"start1":3884,"start2":3884,"length1":16,"length2":17}]],"length":7453,"saved":false}
{"ts":1361369638717,"patch":[[{"diffs":[[0,"       c"],[-1,"onsole.log"],[1,"allback(json) if "],[0,"(attachm"]],"start1":3852,"start2":3852,"length1":26,"length2":33}]],"length":7460,"saved":false}
{"ts":1361369649536,"patch":[[{"diffs":[[0,"\n       "],[-1," callback(json)"],[0," if (att"]],"start1":3850,"start2":3850,"length1":31,"length2":16},{"diffs":[[0,"h === 0)"],[1," {\r\n            callback(json) \r\n            return;\r\n        }"],[0,"\r\n      "]],"start1":3880,"start2":3880,"length1":16,"length2":79}]],"length":7508,"saved":false}
{"contributors":[],"silentsave":false,"ts":1361398557350,"patch":[[{"diffs":[[0,"h === 0) {\r\n"],[1,"            delete json._attachments\r\n"],[0,"            "]],"start1":3880,"start2":3880,"length1":24,"length2":62}]],"length":7546,"saved":false}
{"ts":1361398559462,"patch":[[{"diffs":[[0,"_attachments"],[1,";"],[0,"\r\n          "]],"start1":3916,"start2":3916,"length1":24,"length2":25}]],"length":7547,"saved":false}
{"ts":1361398573214,"patch":[[{"diffs":[[0,"es);"],[-1,"\r\n"],[0,"        "],[-1,"json._attachments = {};"],[0,"\r\n  "]],"start1":3671,"start2":3671,"length1":41,"length2":16},{"diffs":[[0," {\r\n"],[-1,"            delete json._attachments;\r\n"],[0,"    "]],"start1":3863,"start2":3863,"length1":47,"length2":8},{"diffs":[[0,"rn;\r\n        }\r\n"],[1,"        json._attachments = {};\r\n"],[0,"        // We ne"]],"start1":3912,"start2":3912,"length1":32,"length2":65}]],"length":7516,"saved":false}
{"ts":1361398620597,"patch":[[{"diffs":[[0,"tes);   "],[1,"\r\n"],[0,"     "],[1,"   \r\n        json._attachments = {};"],[0,"\r\n      "]],"start1":3670,"start2":3670,"length1":21,"length2":59},{"diffs":[[0," }\r\n"],[-1,"        json._attachments = {};\r\n"],[0,"    "]],"start1":3962,"start2":3962,"length1":41,"length2":8}]],"length":7521,"saved":false}
{"ts":1361398626077,"patch":[[{"diffs":[[0,"s);   \r\n"],[-1,"        \r\n"],[0,"        "]],"start1":3672,"start2":3672,"length1":26,"length2":16}]],"length":7511,"saved":false}
{"ts":1361398711515,"patch":[[{"diffs":[[0,"   this."],[-1,"toJSON"],[1,"saveForCouchDB"],[0,"(functio"]],"start1":3252,"start2":3252,"length1":22,"length2":30},{"diffs":[[0,"r.\r\n    "],[-1,"toJSON"],[1,"saveForCouchDB"],[0,": functi"]],"start1":3601,"start2":3601,"length1":22,"length2":30}]],"length":7527,"saved":false}
{"ts":1361399178582,"patch":[[{"diffs":[[0,";\r\n        });\r\n"],[1,"        \r\n        // If no files have been added to the model then we return straight away\r\n"],[0,"        if (atta"]],"start1":3854,"start2":3854,"length1":32,"length2":124}]],"length":7619,"saved":false}
{"ts":1361399230983,"patch":[[{"diffs":[[0,");\r\n"],[-1,"           \r\n       \r\n"],[0,"    "]],"start1":3424,"start2":3424,"length1":30,"length2":8}]],"length":7597,"saved":false}
{"ts":1361400676445,"patch":[[{"diffs":[[0,"(attachment) {\r\n"],[1,"            console.log(attachment.get(\"binary\"))\r\n"],[0,"            retu"]],"start1":3773,"start2":3773,"length1":32,"length2":83}]],"length":7648,"saved":false}
{"ts":1361400743895,"patch":[[{"diffs":[[0,"    "],[-1,"console.log(attachment.get(\"binary\"))"],[0,"\r\n  "]],"start1":3797,"start2":3797,"length1":45,"length2":8},{"diffs":[[0,"   });\r\n        "],[1,"console.log(attachments)"],[0,"\r\n        // If "]],"start1":3854,"start2":3854,"length1":32,"length2":56}]],"length":7635,"saved":false}
{"ts":1361400982520,"patch":[[{"diffs":[[0,"   }*/\r\n})\r\n"],[1,"spyOn(FileReader)"],[0,"\r\nBackbone.C"]],"start1":1072,"start2":1072,"length1":24,"length2":41},{"diffs":[[0,");\r\n"],[-1,"        console.log(attachments)\r\n"],[0,"    "]],"start1":3875,"start2":3875,"length1":42,"length2":8}]],"length":7618,"saved":false}
{"ts":1361401007074,"patch":[[{"diffs":[[0,"eReader)"],[1,";\r\n"],[0,"\r\nBackbo"]],"start1":1093,"start2":1093,"length1":16,"length2":19}]],"length":7621,"saved":false}
{"ts":1361401036979,"patch":[[{"diffs":[[0,"\n})\r"],[-1,"\nspyOn(FileReader);\r"],[0,"\n\r\nB"]],"start1":1079,"start2":1079,"length1":28,"length2":8}]],"length":7601,"saved":false}
{"contributors":[],"silentsave":false,"ts":1361444165167,"patch":[[{"diffs":[[0,"tend({\r\n"],[1,"    updateBinary: function(file) {\r\n        \r\n    }"],[0,"\r\n    //"]],"start1":45,"start2":45,"length1":16,"length2":67}]],"length":7652,"saved":false}
{"ts":1361444186225,"patch":[[{"diffs":[[0," {\r\n        "],[1,"this.set(\"binary\", file)"],[0,"\r\n    }\r\n   "]],"start1":85,"start2":85,"length1":24,"length2":48}]],"length":7676,"saved":false}
{"ts":1361444372646,"patch":[[{"diffs":[[0,"ry\", file)\r\n"],[1,"        this.set(\"content_type\", file.type)\r\n"],[0,"    }\r\n    /"]],"start1":111,"start2":111,"length1":24,"length2":69}]],"length":7721,"saved":false}
{"ts":1361446350256,"patch":[[{"diffs":[[0,"ent) {\r\n"],[-1,"            \r\n"],[0,"        "]],"start1":3901,"start2":3901,"length1":30,"length2":16},{"diffs":[[0,";\r\n        });\r\n"],[1,"        console.log(attachments.length)\r\n"],[0,"        // If no"]],"start1":3952,"start2":3952,"length1":32,"length2":73}]],"length":7748,"saved":false}
{"ts":1361446362392,"patch":[[{"diffs":[[0,");\r\n"],[-1,"        console.log(attachments.length)\r\n"],[0,"    "]],"start1":3964,"start2":3964,"length1":49,"length2":8}]],"length":7707,"saved":false}
{"ts":1361447092841,"patch":[[{"diffs":[[0,"})\r\n"],[-1,"        console.log(resp._attachments)\r\n"],[0,"    "]],"start1":2177,"start2":2177,"length1":48,"length2":8},{"diffs":[[0,"ction(event) {\r\n"],[1,"                console.log(attachment)\r\n"],[0,"                "]],"start1":4413,"start2":4413,"length1":32,"length2":73},{"diffs":[[0,"    "],[-1,"  console.log(json)"],[0,"\r\n  "]],"start1":4800,"start2":4800,"length1":27,"length2":8}]],"length":7689,"saved":false}
{"ts":1361447840444,"patch":[[{"diffs":[[0,"r = 0;\r\n"],[1,"        console.log(attachments);\r\n"],[0,"        "]],"start1":4274,"start2":4274,"length1":16,"length2":51}]],"length":7724,"saved":false}
{"ts":1361447843756,"patch":[[{"diffs":[[0,"            "],[1,"//"],[0," console.log"]],"start1":4467,"start2":4467,"length1":24,"length2":26}]],"length":7726,"saved":false}
{"ts":1361447871486,"patch":[[{"diffs":[[0,"    "],[-1,"// console.log(attachment)"],[0,"\r\n  "]],"start1":4475,"start2":4475,"length1":34,"length2":8}]],"length":7700,"saved":false}
{"ts":1361448199099,"patch":[[{"diffs":[[0,"eReader();\r\n"],[1,"            console.log(fReader)\r\n"],[0,"            "]],"start1":4404,"start2":4404,"length1":24,"length2":58}]],"length":7734,"saved":false}
{"contributors":[],"silentsave":false,"ts":1361476240675,"patch":[[{"diffs":[[0,"del.extend({"],[-1,"\r"],[0,"\n    updateB"]],"start1":39,"start2":39,"length1":25,"length2":24},{"diffs":[[0,"tion(file) {"],[-1,"\r"],[0,"\n        thi"]],"start1":74,"start2":74,"length1":25,"length2":24},{"diffs":[[0,"\", file)"],[-1,"\r"],[0,"\n       "]],"start1":111,"start2":111,"length1":17,"length2":16},{"diffs":[[0,"le.type)"],[-1,"\r"],[0,"\n    }"],[-1,"\r"],[0,"\n    // "]],"start1":155,"start2":155,"length1":24,"length2":22},{"diffs":[[0,"TE calls"],[-1,"\r"],[0,"\n    // "]],"start1":231,"start2":231,"length1":17,"length2":16},{"diffs":[[0,"f the attachment"],[-1,"\r"],[0,"\n    // We shoul"]],"start1":288,"start2":288,"length1":33,"length2":32},{"diffs":[[0,"ment as "],[-1,"\r"],[0,"\n    // "]],"start1":366,"start2":366,"length1":17,"length2":16},{"diffs":[[0,"tion"],[-1,"\r"],[0,"\n    //"],[-1,"\r"],[0,"\n   "]],"start1":440,"start2":440,"length1":17,"length2":15},{"diffs":[[0,"hod and "],[-1,"\r"],[0,"\n    // "]],"start1":510,"start2":510,"length1":17,"length2":16},{"diffs":[[0,"y $.ajax"],[-1,"\r"],[0,"\n    // "]],"start1":582,"start2":582,"length1":17,"length2":16},{"diffs":[[0,"options."],[-1,"\r"],[0,"\n    /* "]],"start1":633,"start2":633,"length1":17,"length2":16},{"diffs":[[0,", options) {"],[-1,"\r"],[0,"\n        opt"]],"start1":677,"start2":677,"length1":25,"length2":24},{"diffs":[[0," false; "],[-1,"\r"],[0,"\n       "]],"start1":719,"start2":719,"length1":17,"length2":16},{"diffs":[[0,"s.get(\"binary\");"],[-1,"\r"],[0,"\n        options"]],"start1":754,"start2":754,"length1":33,"length2":32},{"diffs":[[0,"s.url();"],[-1,"\r"],[0,"\n       "]],"start1":796,"start2":796,"length1":17,"length2":16},{"diffs":[[0,"= \"PUT\";"],[-1,"\r"],[0,"\n       "]],"start1":826,"start2":826,"length1":17,"length2":16},{"diffs":[[0,"_type\");"],[-1,"\r"],[0,"\n       "]],"start1":882,"start2":882,"length1":17,"length2":16},{"diffs":[[0,"success;"],[-1,"\r"],[0,"\n       "]],"start1":921,"start2":921,"length1":17,"length2":16},{"diffs":[[0,"function(resp) {"],[-1,"\r"],[0,"\n            if("]],"start1":956,"start2":956,"length1":33,"length2":32},{"diffs":[[0,"l,resp,options);"],[-1,"\r"],[0,"\n            mod"]],"start1":1009,"start2":1009,"length1":33,"length2":32},{"diffs":[[0,"l.resp,options);"],[-1,"\r"],[0,"\n        }\r\n    "]],"start1":1063,"start2":1063,"length1":33,"length2":32},{"diffs":[[0,"ions);\n        }"],[-1,"\r"],[0,"\n        if (met"]],"start1":1073,"start2":1073,"length1":33,"length2":32},{"diffs":[[0,"date\") {"],[-1,"\r"],[0,"\n       "]],"start1":1116,"start2":1116,"length1":17,"length2":16},{"diffs":[[0,"ptions);"],[-1,"\r"],[0,"\n       "]],"start1":1145,"start2":1145,"length1":17,"length2":16},{"diffs":[[0,"   }"],[-1,"\r"],[0,"\n    }*/"],[-1,"\r"],[0,"\n})"],[-1,"\r\n\r"],[1,"\n"],[0,"\nBac"]],"start1":1159,"start2":1159,"length1":24,"length2":20},{"diffs":[[0,"ion.extend({"],[-1,"\r"],[0,"\n    model: "]],"start1":1226,"start2":1226,"length1":25,"length2":24},{"diffs":[[0,"tachment"],[-1,"\r"],[0,"\n})"],[-1,"\r\n\r"],[1,"\n"],[0,"\nBackbon"]],"start1":1267,"start2":1267,"length1":23,"length2":20},{"diffs":[[0,"del.extend({"],[-1,"\r"],[0,"\n    default"]],"start1":1316,"start2":1316,"length1":25,"length2":24},{"diffs":[[0," defaults: {"],[-1,"\r"],[0,"\n        \"_a"]],"start1":1332,"start2":1332,"length1":25,"length2":24},{"diffs":[[0,"chments,"],[-1,"\r"],[0,"\n       "]],"start1":1397,"start2":1397,"length1":17,"length2":16},{"diffs":[[0,"der\": []"],[-1,"\r"],[0,"\n    },"],[-1,"\r\n\r"],[0,"\n    // "]],"start1":1429,"start2":1429,"length1":27,"length2":23},{"diffs":[[0,"me down the "],[-1,"\r"],[0,"\n    // wire"]],"start1":1506,"start2":1506,"length1":25,"length2":24},{"diffs":[[0,"llection"],[-1,"\r"],[0,"\n    // "]],"start1":1584,"start2":1584,"length1":17,"length2":16},{"diffs":[[0,"ckbone model"],[-1,"\r"],[0,"\n    parse: "]],"start1":1629,"start2":1629,"length1":25,"length2":24},{"diffs":[[0,"(resp) {"],[-1,"\r"],[0,"\n       "]],"start1":1661,"start2":1661,"length1":17,"length2":16},{"diffs":[[0,"ne(resp)"],[-1,"\r"],[0,"\n       "]],"start1":1694,"start2":1694,"length1":17,"length2":16},{"diffs":[[0,"result = {};"],[-1,"\r"],[0,"\n        _.e"]],"start1":1715,"start2":1715,"length1":25,"length2":24},{"diffs":[[0,"ue, key, list) {"],[-1,"\r"],[0,"\n            var"]],"start1":1774,"start2":1774,"length1":33,"length2":32},{"diffs":[[0,"it(\"-\");"],[-1,"\r"],[0,"\n       "]],"start1":1828,"start2":1828,"length1":17,"length2":16},{"diffs":[[0,"e_number[1];"],[-1,"\r"],[0,"\n           "]],"start1":1865,"start2":1865,"length1":25,"length2":24},{"diffs":[[0,"mber[0];"],[-1,"\r"],[0,"\n       "]],"start1":1908,"start2":1908,"length1":17,"length2":16},{"diffs":[[0,"r] || {}"],[-1,"\r"],[0,"\n       "]],"start1":1958,"start2":1958,"length1":17,"length2":16},{"diffs":[[0,"r][type] = {"],[-1,"\r"],[0,"\n           "]],"start1":1991,"start2":1991,"length1":25,"length2":24},{"diffs":[[0,"y].content_type,"],[-1,"\r"],[0,"\n               "]],"start1":2041,"start2":2041,"length1":33,"length2":32},{"diffs":[[0,"].length"],[-1,"\r"],[0,"\n       "]],"start1":2090,"start2":2090,"length1":17,"length2":16},{"diffs":[[0,"th\n            }"],[-1,"\r"],[0,"\n        })\r\n   "]],"start1":2096,"start2":2096,"length1":33,"length2":32},{"diffs":[[0,"    }\n        })"],[-1,"\r"],[0,"\n        var par"]],"start1":2107,"start2":2107,"length1":33,"length2":32},{"diffs":[[0,"key, list) {"],[-1,"\r"],[0,"\n           "]],"start1":2198,"start2":2198,"length1":25,"length2":24},{"diffs":[[0,"return {"],[-1,"\r"],[0,"\n       "]],"start1":2223,"start2":2223,"length1":17,"length2":16},{"diffs":[[0,"id: key,"],[-1,"\r"],[0,"\n       "]],"start1":2248,"start2":2248,"length1":17,"length2":16},{"diffs":[[0,"nt_type,"],[-1,"\r"],[0,"\n       "]],"start1":2302,"start2":2302,"length1":17,"length2":16},{"diffs":[[0,".length,"],[-1,"\r"],[0,"\n       "]],"start1":2344,"start2":2344,"length1":17,"length2":16},{"diffs":[[0,"h,\n            }"],[-1,"\r"],[0,"\n        }, this"]],"start1":2350,"start2":2350,"length1":33,"length2":32},{"diffs":[[0,"    }, this)"],[-1,"\r"],[0,"\n        if "]],"start1":2371,"start2":2371,"length1":25,"length2":24},{"diffs":[[0,"tachments) {"],[-1,"\r"],[0,"\n           "]],"start1":2454,"start2":2454,"length1":25,"length2":24},{"diffs":[[0,"sed_attachments)"],[-1,"\r"],[0,"\n        }\r\n    "]],"start1":2533,"start2":2533,"length1":33,"length2":32},{"diffs":[[0,"ments)\n        }"],[-1,"\r"],[0,"\n        else {\r"]],"start1":2543,"start2":2543,"length1":33,"length2":32},{"diffs":[[0,"  else {"],[-1,"\r"],[0,"\n       "]],"start1":2566,"start2":2566,"length1":17,"length2":16},{"diffs":[[0,"nts)"],[-1,"\r\n            \r"],[1,"\n"],[0,"\n   "]],"start1":2658,"start2":2658,"length1":23,"length2":9},{"diffs":[[0,"ents)\n\n        }"],[-1,"\r"],[0,"\n        resp._a"]],"start1":2657,"start2":2657,"length1":33,"length2":32},{"diffs":[[0,"chments\""],[-1,"\r"],[0,"\n       "]],"start1":2742,"start2":2742,"length1":17,"length2":16},{"diffs":[[0,"rn resp;"],[-1,"\r"],[0,"\n    },"],[-1,"\r\n\r"],[1,"\n"],[0,"\n    // "]],"start1":2763,"start2":2763,"length1":27,"length2":24},{"diffs":[[0,"e server"],[-1,"\r"],[0,"\n    upd"]],"start1":2838,"start2":2838,"length1":17,"length2":16},{"diffs":[[0,"order) {"],[-1,"\r"],[0,"\n       "]],"start1":2888,"start2":2888,"length1":17,"length2":16},{"diffs":[[0,"s.save({"],[-1,"\r"],[0,"\n       "]],"start1":2908,"start2":2908,"length1":17,"length2":16},{"diffs":[[0,"ew_order"],[-1,"\r"],[0,"\n       "]],"start1":2951,"start2":2951,"length1":17,"length2":16},{"diffs":[[0,"    }, {"],[-1,"\r"],[0,"\n       "]],"start1":2964,"start2":2964,"length1":17,"length2":16},{"diffs":[[0,"ch: true"],[-1,"\r"],[0,"\n       "]],"start1":2988,"start2":2988,"length1":17,"length2":16},{"diffs":[[0,"     });"],[-1,"\r"],[0,"\n    },"],[-1,"\r"],[0,"\n    syn"]],"start1":3000,"start2":3000,"length1":25,"length2":23},{"diffs":[[0,"function() {"],[-1,"\r"],[0,"\n"],[1," "],[0,"       var x"]],"start1":3026,"start2":3026,"length1":26,"length2":26},{"diffs":[[0,"nts;"],[-1,"\r\n       \r\n"],[1,"\n\n "],[0,"    "]],"start1":3069,"start2":3069,"length1":19,"length2":11},{"diffs":[[0,"callback"],[-1,"\r"],[0,"\n"],[1," "],[0,"       /"]],"start1":3146,"start2":3146,"length1":18,"length2":18},{"diffs":[[0,"een read"],[-1,"\r"],[0,"\n"],[1," "],[0,"       t"]],"start1":3215,"start2":3215,"length1":18,"length2":18},{"diffs":[[0,"attrs) {"],[-1,"\r"],[0,"\n       "]],"start1":3261,"start2":3261,"length1":17,"length2":16},{"diffs":[[0,"        "],[1," "],[0,"args[2]."]],"start1":3273,"start2":3273,"length1":16,"length2":17},{"diffs":[[0,"rguments"],[-1,"\r"],[0,"\n"],[1," "],[0,"        "]],"start1":3344,"start2":3344,"length1":18,"length2":18},{"diffs":[[0,", args);"],[-1,"\r"],[0,"\n"],[1," "],[0,"       }"]],"start1":3395,"start2":3395,"length1":18,"length2":18},{"diffs":[[0,"      })"],[-1,"\r"],[0,"\n"],[1," "],[0,"      "],[1," "],[0,"return x"]],"start1":3406,"start2":3406,"length1":24,"length2":25},{"diffs":[[0,"urn xhr;"],[-1,"\r"],[0,"\n    },"],[-1,"\r"],[0,"\n    // "]],"start1":3426,"start2":3426,"length1":25,"length2":23},{"diffs":[[0,"uses to "],[-1,"\r"],[0,"\n    // "]],"start1":3511,"start2":3511,"length1":17,"length2":16},{"diffs":[[0," server."],[-1,"\r"],[0,"\n    sav"]],"start1":3548,"start2":3548,"length1":17,"length2":16},{"diffs":[[0,"lback) {"],[-1,"\r"],[0,"\n       "]],"start1":3589,"start2":3589,"length1":17,"length2":16},{"diffs":[[0,"ibutes);"],[-1,"   \r"],[0,"\n       "]],"start1":3634,"start2":3634,"length1":20,"length2":16},{"diffs":[[0,"ts = {};"],[-1,"\r"],[0,"\n       "]],"start1":3666,"start2":3666,"length1":17,"length2":16},{"diffs":[[0,"ttachment) {"],[-1,"\r"],[0,"\n           "]],"start1":3743,"start2":3743,"length1":25,"length2":24},{"diffs":[[0,"inary\");"],[-1,"\r"],[0,"\n       "]],"start1":3792,"start2":3792,"length1":17,"length2":16},{"diffs":[[0,"y\");\n        });"],[-1,"\r"],[0,"\n        // If n"]],"start1":3796,"start2":3796,"length1":33,"length2":32},{"diffs":[[0,"ght away"],[-1,"\r"],[0,"\n       "]],"start1":3885,"start2":3885,"length1":17,"length2":16},{"diffs":[[0,"=== 0) {"],[-1,"\r"],[0,"\n       "]],"start1":3925,"start2":3925,"length1":17,"length2":16},{"diffs":[[0,"ck(json)"],[-1," \r"],[0,"\n       "]],"start1":3952,"start2":3952,"length1":18,"length2":16},{"diffs":[[0," return;"],[-1,"\r"],[0,"\n       "]],"start1":3972,"start2":3972,"length1":17,"length2":16},{"diffs":[[0,"eturn;\n        }"],[-1,"\r"],[0,"\n        // We n"]],"start1":3974,"start2":3974,"length1":33,"length2":32},{"diffs":[[0,"chronous"],[-1,"\r"],[0,"\n       "]],"start1":4058,"start2":4058,"length1":17,"length2":16},{"diffs":[[0,"l loaded"],[-1,"\r"],[0,"\n       "]],"start1":4124,"start2":4124,"length1":17,"length2":16},{"diffs":[[0,"= 0;"],[-1,"\r\n        console.log(attachments);\r"],[0,"\n   "]],"start1":4153,"start2":4153,"length1":44,"length2":8},{"diffs":[[0,"hment) {"],[-1,"\r\n\r"],[1,"\n"],[0,"\n       "]],"start1":4200,"start2":4200,"length1":19,"length2":17},{"diffs":[[0,"r();"],[-1,"\r\n            console.log(fReader)\r"],[0,"\n   "]],"start1":4249,"start2":4249,"length1":43,"length2":8},{"diffs":[[0,"t) {"],[-1,"\r\n               \r"],[1,"\n"],[0,"\n   "]],"start1":4296,"start2":4296,"length1":26,"length2":9},{"diffs":[[0,"unter++;"],[-1,"\r"],[0,"\n       "]],"start1":4320,"start2":4320,"length1":17,"length2":16},{"diffs":[[0,"\",\")[1];"],[-1,"\r"],[0,"\n       "]],"start1":4382,"start2":4382,"length1":17,"length2":16},{"diffs":[[0,".id] = {"],[-1,"\r"],[0,"\n       "]],"start1":4435,"start2":4435,"length1":17,"length2":16},{"diffs":[[0,"_type\"),"],[-1,"\r"],[0,"\n       "]],"start1":4501,"start2":4501,"length1":17,"length2":16},{"diffs":[[0,"ta: data"],[-1,"\r"],[0,"\n       "]],"start1":4532,"start2":4532,"length1":17,"length2":16},{"diffs":[[0,"               }"],[-1,"\r"],[0,"\n               "]],"start1":4542,"start2":4542,"length1":33,"length2":32},{"diffs":[[0,"ength) {"],[-1,"\r"],[0,"\n       "]],"start1":4603,"start2":4603,"length1":17,"length2":16},{"diffs":[[0,"        "],[-1,"\r\n            "],[-1,"     "],[0,"   callb"]],"start1":4621,"start2":4621,"length1":35,"length2":16},{"diffs":[[0,"k(json);"],[-1,"\r"],[0,"\n       "]],"start1":4639,"start2":4639,"length1":17,"length2":16},{"diffs":[[0,"               }"],[-1,"\r"],[0,"\n            }\r\n"]],"start1":4649,"start2":4649,"length1":33,"length2":32},{"diffs":[[0," }\n            }"],[-1,"\r"],[0,"\n            fRe"]],"start1":4663,"start2":4663,"length1":33,"length2":32},{"diffs":[[0,"inary\"))"],[-1,"\r"],[0,"\n       "]],"start1":4731,"start2":4731,"length1":17,"length2":16},{"diffs":[[0,"      })"],[-1,"\r"],[0,"\n    },"],[-1,"\r"],[0,"\n    idA"]],"start1":4742,"start2":4742,"length1":25,"length2":23},{"diffs":[[0,"_id\""],[-1,"\r"],[0,"\n});"],[-1,"\r\n\r\n\r"],[1,"\n\n"],[0,"\nfun"]],"start1":4776,"start2":4776,"length1":18,"length2":14},{"diffs":[[0,"el, model) {"],[-1,"\r"],[0,"\n    // We n"]],"start1":4810,"start2":4810,"length1":25,"length2":24},{"diffs":[[0,"rag over"],[-1,"\r"],[0,"\n    el."]],"start1":4903,"start2":4903,"length1":17,"length2":16},{"diffs":[[0,"', function(e) {"],[-1,"\r"],[0,"\n        e.preve"]],"start1":4945,"start2":4945,"length1":33,"length2":32},{"diffs":[[0,"t();"],[-1,"\r"],[0,"\n    });"],[-1,"\r\n\r"],[1,"\n"],[0,"\n   "]],"start1":4985,"start2":4985,"length1":20,"length2":17},{"diffs":[[0," the element"],[-1,"\r"],[0,"\n    // and "]],"start1":5040,"start2":5040,"length1":25,"length2":24},{"diffs":[[0,"tachment"],[-1,"\r"],[0,"\n    // "]],"start1":5112,"start2":5112,"length1":17,"length2":16},{"diffs":[[0," save it"],[-1,"\r"],[0,"\n    el."]],"start1":5131,"start2":5131,"length1":17,"length2":16},{"diffs":[[0,"ion(e) {"],[-1,"\r"],[1,"\n        console.log(\"DROPPED\")"],[0,"\n       "]],"start1":5177,"start2":5177,"length1":17,"length2":47},{"diffs":[[0,"fault();"],[-1,"\r"],[0,"\n       "]],"start1":5236,"start2":5236,"length1":17,"length2":16},{"diffs":[[0,"iles[0];"],[-1,"\r\n\r"],[1,"\n"],[0,"\n       "]],"start1":5280,"start2":5280,"length1":19,"length2":17},{"diffs":[[0,", file);"],[-1,"\r"],[0,"\n       "]],"start1":5316,"start2":5316,"length1":17,"length2":16},{"diffs":[[0,".save();"],[-1,"\r"],[0,"\n       "]],"start1":5341,"start2":5341,"length1":17,"length2":16},{"diffs":[[0,"remove()"],[-1,"\r"],[0,"\n       "]],"start1":5367,"start2":5367,"length1":17,"length2":16},{"diffs":[[0,"el);"],[-1,"\r"],[0,"\n    });"],[-1,"\r"],[0,"\n}"],[-1,"\r"],[0,"\n// "]],"start1":5475,"start2":5475,"length1":21,"length2":18},{"diffs":[[0,"/ VIEWS "],[-1,"\r"],[0,"\n// Atta"]],"start1":5491,"start2":5491,"length1":17,"length2":16},{"diffs":[[0,"achments"],[-1,"\r\n\r"],[1,"\n"],[0,"\nBackbon"]],"start1":5506,"start2":5506,"length1":19,"length2":17},{"diffs":[[0,"iew.extend({"],[-1,"\r"],[0,"\n    initial"]],"start1":5554,"start2":5554,"length1":25,"length2":24},{"diffs":[[0,"ze: function() {"],[-1,"\r"],[0,"\n        this.mo"]],"start1":5579,"start2":5579,"length1":33,"length2":32},{"diffs":[[0,"t, this)"],[-1,"\r"],[0,"\n    },"],[-1,"\r"],[0,"\n    // "]],"start1":5662,"start2":5662,"length1":25,"length2":23},{"diffs":[[0,"od from the "],[-1,"\r"],[0,"\n    // pare"]],"start1":5742,"start2":5742,"length1":25,"length2":24},{"diffs":[[0,"called. "],[-1,"\r"],[0,"\n    add"]],"start1":5791,"start2":5791,"length1":17,"length2":16},{"diffs":[[0,"model) {"],[-1,"\r"],[0,"\n       "]],"start1":5828,"start2":5828,"length1":17,"length2":16},{"diffs":[[0,"s.options.view({"],[-1,"\r"],[0,"\n            att"]],"start1":5860,"start2":5860,"length1":33,"length2":32},{"diffs":[[0,"   attributes: {"],[-1,"\r"],[0,"\n               "]],"start1":5886,"start2":5886,"length1":33,"length2":32},{"diffs":[[0,"odel.cid"],[-1,"\r"],[0,"\n       "]],"start1":5924,"start2":5924,"length1":17,"length2":16},{"diffs":[[0,"d\n            },"],[-1,"\r"],[0,"\n            mod"]],"start1":5931,"start2":5931,"length1":33,"length2":32},{"diffs":[[0,"l: model"],[-1,"\r"],[0,"\n       "]],"start1":5964,"start2":5964,"length1":17,"length2":16},{"diffs":[[0,"     });"],[-1,"\r"],[1,"\n        makeDroppable(v.el, model)"],[0,"\n       "]],"start1":5976,"start2":5976,"length1":17,"length2":51},{"diffs":[[0,".remove)"],[-1,"\r"],[0,"\n       "]],"start1":6058,"start2":6058,"length1":17,"length2":16},{"diffs":[[0,"er().el)"],[-1,"\r"],[0,"\n    },"],[-1,"\r"],[0,"\n    ren"]],"start1":6097,"start2":6097,"length1":25,"length2":23},{"diffs":[[0,"er: function() {"],[-1,"\r"],[0,"\n        var tha"]],"start1":6121,"start2":6121,"length1":33,"length2":32},{"diffs":[[0,"var that = this;"],[-1,"\r"],[0,"\n        this.$e"]],"start1":6146,"start2":6146,"length1":33,"length2":32},{"diffs":[[0,"empty();"],[-1,"\r\n\r"],[1,"\n"],[0,"\n       "]],"start1":6180,"start2":6180,"length1":19,"length2":17},{"diffs":[[0,"n(key) {"],[-1,"\r"],[0,"\n       "]],"start1":6249,"start2":6249,"length1":17,"length2":16},{"diffs":[[0,"s.view({"],[-1,"\r"],[0,"\n       "]],"start1":6299,"start2":6299,"length1":17,"length2":16},{"diffs":[[0,"butes: {"],[-1,"\r"],[0,"\n       "]],"start1":6329,"start2":6329,"length1":17,"length2":16},{"diffs":[[0," id: key"],[-1,"\r"],[0,"\n       "]],"start1":6357,"start2":6357,"length1":17,"length2":16},{"diffs":[[0,"      },"],[-1,"\r"],[0,"\n       "]],"start1":6376,"start2":6376,"length1":17,"length2":16},{"diffs":[[0,"get(key)"],[-1,"\r"],[0,"\n       "]],"start1":6439,"start2":6439,"length1":17,"length2":16},{"diffs":[[0,"render()"],[-1,"\r"],[0,"\n       "]],"start1":6463,"start2":6463,"length1":17,"length2":16},{"diffs":[[0,"et(key))"],[-1,"\r"],[0,"\n       "]],"start1":6542,"start2":6542,"length1":17,"length2":16},{"diffs":[[0,"iew.el);"],[-1,"\r"],[0,"\n       "]],"start1":6583,"start2":6583,"length1":17,"length2":16},{"diffs":[[0,".el);\n        })"],[-1,"\r"],[0,"\n        return "]],"start1":6586,"start2":6586,"length1":33,"length2":32},{"diffs":[[0,"his;"],[-1,"\r"],[0,"\n    }"],[-1,"\r"],[0,"\n})"],[-1,"\r\n\r"],[1,"\n"],[0,"\n// "]],"start1":6619,"start2":6619,"length1":22,"length2":18},{"diffs":[[0,"// VIEW "],[-1,"\r"],[0,"\n// Couc"]],"start1":6634,"start2":6634,"length1":17,"length2":16},{"diffs":[[0,"odel"],[-1,"\r\n//\r\n\r"],[1,"\n"],[0,"\nBac"]],"start1":6655,"start2":6655,"length1":15,"length2":9},{"diffs":[[0,"nd({"],[-1,"\r"],[0,"\n    // "],[-1,"\r"],[0,"\n   "]],"start1":6703,"start2":6703,"length1":18,"length2":16},{"diffs":[[0,"tion() {"],[-1,"\r"],[0,"\n       "]],"start1":6739,"start2":6739,"length1":17,"length2":16},{"diffs":[[0,"({})"],[-1,"\r"],[0,"\n    },"],[-1,"\r\n\r"],[1,"\n"],[0,"\n   "]],"start1":6790,"start2":6790,"length1":19,"length2":16},{"diffs":[[0,"hin the "],[-1,"\r"],[0,"\n    // "]],"start1":6872,"start2":6872,"length1":17,"length2":16},{"diffs":[[0,"ackbone view"],[-1,"\r"],[0,"\n    // to r"]],"start1":6945,"start2":6945,"length1":25,"length2":24},{"diffs":[[0,"chment. "],[-1,"\r"],[0,"\n    bui"]],"start1":6995,"start2":6995,"length1":17,"length2":16},{"diffs":[[0,"ion("],[-1,"view"],[0,") {"],[-1,"\r"],[0,"\n   "]],"start1":7031,"start2":7031,"length1":16,"length2":11},{"diffs":[[0," = this;"],[-1,"\r"],[0,"\n       "]],"start1":7055,"start2":7055,"length1":17,"length2":16},{"diffs":[[0,"hments({"],[-1,"\r"],[0,"\n       "]],"start1":7115,"start2":7115,"length1":17,"length2":16},{"diffs":[[0,"s.model,"],[-1,"\r"],[0,"\n       "]],"start1":7146,"start2":7146,"length1":17,"length2":16},{"diffs":[[0,"ew: "],[-1,"v"],[1,"that.options.attachmentV"],[0,"iew"],[-1,"\r"],[0,"\n   "]],"start1":7169,"start2":7169,"length1":13,"length2":35},{"diffs":[[0,"tView\n        })"],[-1,"\r"],[0,"\n        var ele"]],"start1":7195,"start2":7195,"length1":33,"length2":32},{"diffs":[[0,"er().$el"],[-1,"\r"],[0,"\n       "]],"start1":7252,"start2":7252,"length1":17,"length2":16},{"diffs":[[0,"rtable({"],[-1,"\r"],[0,"\n       "]],"start1":7279,"start2":7279,"length1":17,"length2":16},{"diffs":[[0,"t, ui) {"],[-1,"\r"],[0,"\n       "]],"start1":7321,"start2":7321,"length1":17,"length2":16},{"diffs":[[0,"rray\"));"],[-1,"\r"],[0,"\n       "]],"start1":7401,"start2":7401,"length1":17,"length2":16},{"diffs":[[0,"       }"],[-1,"\r"],[0,"\n       "]],"start1":7415,"start2":7415,"length1":17,"length2":16},{"diffs":[[0,"      })"],[-1,"\r"],[0,"\n       "]],"start1":7426,"start2":7426,"length1":17,"length2":16},{"diffs":[[0,").el"],[-1,"\r"],[0,"\n    }"],[-1,"\r"],[0,"\n})"]],"start1":7471,"start2":7471,"length1":15,"length2":13}]],"length":7484,"saved":false}
{"contributors":[],"silentsave":false,"ts":1361482542149,"patch":[[{"diffs":[[0,"d\"\n});\n\n"],[1,"// Takes the Attachment View and makes it into a droppable element\n// and provides a callback to be executed when a file is dropped\n// on that element"],[0,"\nfunctio"]],"start1":4778,"start2":4778,"length1":16,"length2":166},{"diffs":[[0,"DROPPED\""],[1,", e"],[0,")\n      "]],"start1":5357,"start2":5357,"length1":16,"length2":19},{"diffs":[[0,"del.set("],[-1,"\""],[1,"{"],[0,"binary"],[-1,"\", file"],[1,": file, content_type: file.type, id: file.name}"],[0,");\n     "]],"start1":5453,"start2":5453,"length1":30,"length2":70}]],"length":7677,"saved":false}
{"ts":1361483454365,"patch":[[{"diffs":[[0,"ile.name});\n"],[1,"        console.log(model.collection)\n"],[0,"        // m"]],"start1":5506,"start2":5506,"length1":24,"length2":62}]],"length":7715,"saved":false}
{"ts":1361484377925,"patch":[[{"diffs":[[0,"hments)\n"],[1,"            resp._attachments.belongs_to = this;"],[0,"\n       "]],"start1":2655,"start2":2655,"length1":16,"length2":64}]],"length":7763,"saved":false}
{"ts":1361484426923,"patch":[[{"diffs":[[0,"ts)\n"],[-1,"            resp._attachments.belongs_to = this;\n"],[0,"    "]],"start1":2659,"start2":2659,"length1":57,"length2":8}]],"length":7714,"saved":false}
{"ts":1361485011769,"patch":[[{"diffs":[[0,"pable(v.el, "],[1,"model, this."],[0,"model)\n     "]],"start1":6231,"start2":6231,"length1":24,"length2":36},{"diffs":[[0,"get(key)"],[1,", that.model"],[0,")\n      "]],"start1":6783,"start2":6783,"length1":16,"length2":28}]],"length":7738,"saved":false}
{"contributors":[],"silentsave":false,"ts":1361527032575,"patch":[[{"diffs":[[0,".type)\n    }"],[-1,""],[0,""],[1,",\n    parent: function() { console.log(this.options); return this.belongs_to }"],[0,"\n    // Over"]],"start1":157,"start2":157,"length1":24,"length2":102},{"diffs":[[0,"achments"],[-1,""],[0,""],[1,"(null)"],[0,",\n      "]],"start1":1474,"start2":1474,"length1":16,"length2":22},{"diffs":[[0,"sed_attachments)"],[1,"           "],[0,"\n        }\n     "]],"start1":2617,"start2":2617,"length1":32,"length2":43},{"diffs":[[0,"achments"],[-1,")"],[1,", {belongs_to: this})           "],[0,"\n       "]],"start1":2748,"start2":2748,"length1":17,"length2":48},{"diffs":[[0,"ble(el, "],[-1,"model"],[1,"attachment, parent"],[0,") {\n    "]],"start1":5081,"start2":5081,"length1":21,"length2":34},{"diffs":[[0,"        "],[-1,"model"],[1,"attachment"],[0,".set({bi"]],"start1":5581,"start2":5581,"length1":21,"length2":26},{"diffs":[[0,"    "],[-1," console.log(model.collection"],[1,"// parent.set(\"attachments_order\", parent.get(\"attachments_order\".push()))\n        console.log(\"here\", attachment.parent()"],[0,")\n  "]],"start1":5664,"start2":5664,"length1":37,"length2":130}]],"length":7975,"saved":false}
{"ts":1361527198558,"patch":[[{"diffs":[[0,"d({\n"],[-1,"    defaults: {\n        \"_attachments\": new Backbone.Collection.Attachments(null),\n        \"attachments_order\": []\n    },"],[0,"\n   "]],"start1":1403,"start2":1403,"length1":129,"length2":8},{"diffs":[[0,"hments\"\n"],[1,"        resp.attachments_order = resp.attachments_order || []\n"],[0,"        "]],"start1":2747,"start2":2747,"length1":16,"length2":78}]],"length":7916,"saved":false}
{"contributors":[],"silentsave":false,"ts":1361645435340,"patch":[[{"diffs":[[0,"xtend({\n"],[1,"    constructor: function(attributes, options) {\n        this.set(\"_attachments\", new Backbone.Collection.Attachments)\n        Backbone.Model.apply(this,arguments)\n    },\n    addNewAttachment: function() {\n      this.get(\"_attachments\").add({})\n    },"],[0,"\n"],[-1,""],[0,"    // W"]],"start1":1399,"start2":1399,"length1":17,"length2":268},{"diffs":[[0,"is)\n"],[-1,"        if (this.get(\"_attachments\") instanceof Backbone.Collection.Attachments) {\n"],[0,"    "]],"start1":2594,"start2":2594,"length1":91,"length2":8},{"diffs":[[0,"    "],[-1,"}\n        else {\n            resp._attachments = new Backbone.Collection.Attachments(parsed_attachments, {belongs_to: this})           \n        }"],[0,"\n   "]],"start1":2696,"start2":2696,"length1":153,"length2":8},{"diffs":[[0,"ttributes);\n"],[1,"        if(this.get(\"_attachments\")) {\n"],[0,"        json"]],"start1":3720,"start2":3720,"length1":24,"length2":63},{"diffs":[[0,"\n        })\n"],[1,"        }\n        else { callback(json) }\n"],[0,"    },\n    i"]],"start1":4867,"start2":4867,"length1":24,"length2":66},{"diffs":[[0,"e: function() {\n"],[1,"\n"],[0,"        this.mod"]],"start1":6092,"start2":6092,"length1":32,"length2":33},{"diffs":[[0,"     this.model."],[-1,"get(\"_a"],[1,"addNewA"],[0,"ttachments\").add"]],"start1":7288,"start2":7288,"length1":39,"length2":39},{"diffs":[[0,"ewAttachment"],[-1,"s\").add({}"],[1,"("],[0,")\n    },\n\n  "]],"start1":7308,"start2":7308,"length1":34,"length2":25}]],"length":8012,"saved":false}
{"ts":1361648549206,"patch":[[{"diffs":[[0,") {\n"],[-1,"        this.set(\"_attachments\", new Backbone.Collection.Attachments)\n"],[0,"    "]],"start1":1452,"start2":1452,"length1":78,"length2":8}]],"length":7942,"saved":false}
{"ts":1361648551329,"patch":[[{"diffs":[[0,"tes, options) {\n"],[1,"        //this.set(\"_attachments\", new Backbone.Collection.Attachments)\n"],[0,"        Backbone"]],"start1":1440,"start2":1440,"length1":32,"length2":104}]],"length":8014,"saved":false}
{"ts":1361648565118,"patch":[[{"diffs":[[0,"        "],[-1,"//"],[0,"this.set"]],"start1":1456,"start2":1456,"length1":18,"length2":16}]],"length":8012,"saved":false}
{"ts":1361648775947,"patch":[[{"diffs":[[0,"is.set(\""],[-1,"_attachments"],[1,"boo"],[0,"\", new B"]],"start1":1466,"start2":1466,"length1":28,"length2":19}]],"length":8003,"saved":false}
{"ts":1361648849485,"patch":[[{"diffs":[[0,"his."],[-1,"set(\"boo\","],[1,"_attachments ="],[0," new"]],"start1":1465,"start2":1465,"length1":18,"length2":22}]],"length":8007,"saved":false}
{"ts":1361648853723,"patch":[[{"diffs":[[0,".Attachments"],[-1,")"],[1,";"],[0,"\n        Bac"]],"start1":1507,"start2":1507,"length1":25,"length2":25}]],"length":8007,"saved":false}
{"ts":1361648918259,"patch":[[{"diffs":[[0,"\n      this."],[-1,"get(\""],[0,"_attachments"]],"start1":1607,"start2":1607,"length1":29,"length2":24},{"diffs":[[0,"achments"],[-1,"\")"],[0,".add({})"]],"start1":1623,"start2":1623,"length1":18,"length2":16},{"diffs":[[0,"    "],[-1,"resp._attachments = this.get(\""],[1,"this."],[0,"_att"]],"start1":2594,"start2":2594,"length1":38,"length2":13},{"diffs":[[0,"achments"],[-1,"\")"],[0,".reset(p"]],"start1":2607,"start2":2607,"length1":18,"length2":16},{"diffs":[[0,"        "],[-1,"resp"],[1,"this"],[0,"._attach"]],"start1":2662,"start2":2662,"length1":20,"length2":20}]],"length":7973,"saved":false}
{"ts":1361648944652,"patch":[[{"diffs":[[0,"    if(this."],[-1,"get(\""],[0,"_attachments"]],"start1":3697,"start2":3697,"length1":29,"length2":24},{"diffs":[[0,"achments"],[-1,"\")"],[1,".length > 0"],[0,") {\n    "]],"start1":3713,"start2":3713,"length1":18,"length2":27}]],"length":7977,"saved":false}
{"ts":1361649115633,"patch":[[{"diffs":[[0," = this."],[-1,"get(\""],[0,"_attachm"]],"start1":3791,"start2":3791,"length1":21,"length2":16},{"diffs":[[0,"achments"],[-1,"\")"],[0,".filter("]],"start1":3803,"start2":3803,"length1":18,"length2":16},{"diffs":[[0,"unction() {\n"],[-1,"\n"],[0,"        this"]],"start1":6054,"start2":6054,"length1":25,"length2":24},{"diffs":[[0," this.model."],[-1,"get(\""],[0,"_attachments"]],"start1":6073,"start2":6073,"length1":29,"length2":24},{"diffs":[[0,"achments"],[-1,"\")"],[0,".on(\"add"]],"start1":6089,"start2":6089,"length1":18,"length2":16}]],"length":7962,"saved":false}
{"ts":1361649322410,"patch":[[{"diffs":[[0,"s.model."],[-1,"get(\""],[0,"attachme"]],"start1":6676,"start2":6676,"length1":21,"length2":16},{"diffs":[[0,"ts_order"],[-1,"\")"],[0,".forEach"]],"start1":6693,"start2":6693,"length1":18,"length2":16}]],"length":7955,"saved":false}
{"ts":1361649329927,"patch":[[{"diffs":[[0,".el, that.model."],[-1,"get(\""],[0,"_attachments\").g"]],"start1":6973,"start2":6973,"length1":37,"length2":32},{"diffs":[[0,"del._attachments"],[-1,"\")"],[0,".get(key), that."]],"start1":6985,"start2":6985,"length1":34,"length2":32}]],"length":7948,"saved":false}
{"ts":1361649363062,"patch":[[{"diffs":[[0,"s.model."],[1,"get(\""],[0,"attachme"]],"start1":6676,"start2":6676,"length1":16,"length2":21},{"diffs":[[0,"ts_order"],[1,"\")"],[0,".forEach"]],"start1":6698,"start2":6698,"length1":16,"length2":18},{"diffs":[[0,"t.model."],[-1,"get(\""],[0,"_attachm"]],"start1":6886,"start2":6886,"length1":21,"length2":16},{"diffs":[[0,"achments"],[-1,"\")"],[0,".get(key"]],"start1":6898,"start2":6898,"length1":18,"length2":16}]],"length":7948,"saved":false}
{"ts":1361653964596,"patch":[[{"diffs":[[0,"hments;\n"],[1,"        this.attachments_order = [];\n"],[0,"        "]],"start1":1513,"start2":1513,"length1":16,"length2":53},{"diffs":[[0,"        "],[-1,"resp"],[1,"this"],[0,".attachm"]],"start1":2776,"start2":2776,"length1":20,"length2":20},{"diffs":[[0,"rder"],[-1," || []"],[0,"\n   "]],"start1":2827,"start2":2827,"length1":14,"length2":8},{"diffs":[[0,"s.model."],[-1,"get(\""],[0,"attachme"]],"start1":6707,"start2":6707,"length1":21,"length2":16},{"diffs":[[0,"ts_order"],[-1,"\")"],[0,".forEach"]],"start1":6724,"start2":6724,"length1":18,"length2":16}]],"length":7972,"saved":false}
{"ts":1361656519237,"patch":[[{"diffs":[[0," },\n"],[-1,"    addNewAttachment: function() {\n      this._attachments.add({})\n    },\n"],[0,"    "]],"start1":1606,"start2":1606,"length1":82,"length2":8},{"diffs":[[0,"ction() {\n      "],[-1,"  "],[0,"this.model.addNe"]],"start1":7161,"start2":7161,"length1":34,"length2":32},{"diffs":[[0,"del."],[1,"_"],[0,"a"],[-1,"ddNewA"],[0,"ttac"]],"start1":7184,"start2":7184,"length1":15,"length2":10},{"diffs":[[0,"tachment"],[-1,"("],[1,"s.add({}"],[0,")\n    },"]],"start1":7191,"start2":7191,"length1":17,"length2":24},{"diffs":[[0,"({})\n    },\n"],[-1,"\n"],[0,"    // Exten"]],"start1":7204,"start2":7204,"length1":25,"length2":24}]],"length":7897,"saved":false}
{"ts":1361656636562,"patch":[[{"diffs":[[0,"    "],[-1,"  // parent.set(\"attachments_order\", parent.get(\"attachments_order\".push()))\n        console.log(\"here\", attachment.parent())\n        // model.save();"],[0,"\n   "]],"start1":5622,"start2":5622,"length1":158,"length2":8}]],"length":7747,"saved":false}
{"contributors":[],"silentsave":false,"ts":1361963622253,"patch":[[{"diffs":[[0,"    "],[-1,"console.log(\"DROPPED\", e)\n        "],[0,""],[1,""],[0,"e.pr"]],"start1":5438,"start2":5438,"length1":42,"length2":8},{"diffs":[[0,");\n     "],[-1,"\n   "],[0,"   "],[-1,"  "],[1,"//"],[0,"$('img')"]],"start1":5584,"start2":5584,"length1":25,"length2":21},{"diffs":[[0,"        "],[1,"//"],[0,"$('<img>"]],"start1":5615,"start2":5615,"length1":16,"length2":18},{"diffs":[[0,"hments\n\n"],[1,"Backbone.View.Attachments = Backbone.View.extend({\n    constructor: function() {\n        Backbone.View.apply(this, arguments)\n        this.listenTo(this.model, \"change\", function(model, another) {\n            this.$el.attr('id', model.id)\n        });\n        this.listenTo(this.model, \"destroy\", this.remove);\n\n        }\n    \n})\n\n"],[0,"Backbone"]],"start1":5749,"start2":5749,"length1":16,"length2":346},{"diffs":[[0,"    "],[-1,"  v.listenTo(model, 'destroy', v.remove)"],[0,""],[1,""],[0,"\n   "]],"start1":6598,"start2":6598,"length1":48,"length2":8}]],"length":8001,"saved":false}
{"ts":1361963760552,"patch":[[{"diffs":[[0,".View.Attachment"],[-1,"s"],[0," = Backbone.View"]],"start1":5765,"start2":5765,"length1":33,"length2":32}]],"length":8000,"saved":false}
{"ts":1361963845134,"patch":[[{"diffs":[[0,".attr('i"],[1,"f"],[0,"d', mode"]],"start1":5973,"start2":5973,"length1":16,"length2":17},{"diffs":[[0,"emove);\n"],[-1,"\n"],[0,"        "]],"start1":6059,"start2":6059,"length1":17,"length2":16},{"diffs":[[0,"      }\n"],[-1,"    \n"],[0,"})\n\nBack"]],"start1":6069,"start2":6069,"length1":21,"length2":16}]],"length":7995,"saved":false}
{"ts":1361963855768,"patch":[[{"diffs":[[0,".attr('i"],[-1,"f"],[0,"d', mode"]],"start1":5973,"start2":5973,"length1":17,"length2":16}]],"length":7994,"saved":false}
{"ts":1361964005137,"patch":[[{"diffs":[[0,"ment"],[-1,", parent"],[0,") {\n"]],"start1":5055,"start2":5055,"length1":16,"length2":8},{"diffs":[[0,"id)\n        });\n"],[1,"        \n        makeDroppable(v.el, this.model)\n"],[0,"        this.lis"]],"start1":5983,"start2":5983,"length1":32,"length2":81},{"diffs":[[0,"unction("],[-1,"model"],[1,"attachment"],[0,") {\n    "]],"start1":6418,"start2":6418,"length1":21,"length2":26},{"diffs":[[0,"    id: "],[-1,"model"],[1,"attachment"],[0,".cid\n   "]],"start1":6518,"start2":6518,"length1":21,"length2":26},{"diffs":[[0," model: "],[-1,"model"],[1,"attachment"],[0,"\n       "]],"start1":6567,"start2":6567,"length1":21,"length2":26},{"diffs":[[0,"});\n"],[-1,"        makeDroppable(v.el, model, this.model)\n"],[0,"    "]],"start1":6594,"start2":6594,"length1":55,"length2":8}]],"length":8003,"saved":false}
{"ts":1361964017087,"patch":[[{"diffs":[[0,"oppable("],[-1,"v"],[1,"this"],[0,".el, thi"]],"start1":6022,"start2":6022,"length1":17,"length2":20}]],"length":8006,"saved":false}
{"ts":1361965999750,"patch":[[{"diffs":[[0," arguments)\n"],[1,"        // Update the element when the id of the attachment changes\n"],[0,"        this"]],"start1":5862,"start2":5862,"length1":24,"length2":92},{"diffs":[[0,"s called"],[1," with an instance of the new attachment model\n    //"],[0," wheneve"]],"start1":6369,"start2":6369,"length1":16,"length2":68},{"diffs":[[0,"\n        });"],[-1,"\n"],[0,"      \n     "]],"start1":6708,"start2":6708,"length1":25,"length2":24}]],"length":8125,"saved":false}
{"ts":1361966005289,"patch":[[{"diffs":[[0," element"],[1,"'s id"],[0," when th"]],"start1":5895,"start2":5895,"length1":16,"length2":21}]],"length":8130,"saved":false}
{"ts":1361966038739,"patch":[[{"diffs":[[0,"del.id)\n"],[1,"            console.log(model.sortable.toArray())\n"],[0,"        "]],"start1":6052,"start2":6052,"length1":16,"length2":66}]],"length":8180,"saved":false}
{"ts":1361966049715,"patch":[[{"diffs":[[0,"able"],[-1,"."],[1,"(\""],[0,"toArray"],[-1,"()"],[1,"\""],[0,")\n  "]],"start1":6094,"start2":6094,"length1":18,"length2":18}]],"length":8180,"saved":false}
{"ts":1361966052610,"patch":[[{"diffs":[[0,"oArray\")"],[1,")"],[0,"\n       "]],"start1":6101,"start2":6101,"length1":16,"length2":17}]],"length":8181,"saved":false}
{"ts":1361966340138,"patch":[[{"diffs":[[0,"    "],[-1,"console.log(model.sortable(\"toArray\"))"],[1,"this.model._attachments.trigger('update-id');"],[0,"\n   "]],"start1":6068,"start2":6068,"length1":46,"length2":53}]],"length":8188,"saved":false}
{"ts":1361966365019,"patch":[[{"diffs":[[0," arguments)\n"],[1,"        var that = this;\n"],[0,"        // U"]],"start1":5862,"start2":5862,"length1":24,"length2":49},{"diffs":[[0,")\n            th"],[-1,"is"],[1,"at"],[0,".model._attachme"]],"start1":6083,"start2":6083,"length1":34,"length2":34}]],"length":8213,"saved":false}
{"ts":1361966370121,"patch":[[{"diffs":[[0,"s)\n     "],[-1,"   var that = this;"],[0,"\n       "]],"start1":5871,"start2":5871,"length1":35,"length2":16},{"diffs":[[0,"            "],[-1,"that."],[0,"model._attac"]],"start1":6066,"start2":6066,"length1":29,"length2":24}]],"length":8189,"saved":false}
{"ts":1361966394662,"patch":[[{"diffs":[[0,"  model."],[-1,"_attachments"],[1,"collection"],[0,".trigger"]],"start1":6076,"start2":6076,"length1":28,"length2":26}]],"length":8187,"saved":false}
{"ts":1361966443593,"patch":[[{"diffs":[[0,"ment, this)\n"],[1,"        this.mode._attachments.on(\"update-id\", function() { console.log(\"Updated\"), this})\n"],[0,"    },\n    /"]],"start1":6390,"start2":6390,"length1":24,"length2":115}]],"length":8278,"saved":false}
{"ts":1361966447926,"patch":[[{"diffs":[[0,"ed\")"],[1," }"],[0,", this"],[-1,"}"],[0,")\n  "]],"start1":6480,"start2":6480,"length1":15,"length2":16}]],"length":8279,"saved":false}
{"ts":1361966457011,"patch":[[{"diffs":[[0,"his.mode"],[1,"l"],[0,"._attach"]],"start1":6411,"start2":6411,"length1":16,"length2":17}]],"length":8280,"saved":false}
{"ts":1361966558654,"patch":[[{"diffs":[[0,"d\", "],[-1,"function() { console.log(\"Updated\") }, this"],[1,"this.getAttachmentsOrder, this)\n    },\n    getAttachmentsOrder: function(a,b) {\n        console.log(this.el.sortable(\"toArray\")"],[0,")\n    }"],[-1,","],[0,"\n   "]],"start1":6446,"start2":6446,"length1":59,"length2":142}]],"length":8363,"saved":false}
{"ts":1361966561452,"patch":[[{"diffs":[[0,"ray\"))\n    }"],[1,","],[0,"\n    // addA"]],"start1":6572,"start2":6572,"length1":24,"length2":25}]],"length":8364,"saved":false}
{"ts":1361966571767,"patch":[[{"diffs":[[0,"og(this."],[1,"$"],[0,"el.sorta"]],"start1":6547,"start2":6547,"length1":16,"length2":17}]],"length":8365,"saved":false}
{"ts":1361966685186,"patch":[[{"diffs":[[0,"te: "],[-1,"function(event, ui) {\n                that.model.updateAttachmentsOrder($(this).sortable(\"toArray\"));\n            }"],[1,"rendered_view.getAttachmentsOrder"],[0,"\n   "]],"start1":8185,"start2":8185,"length1":123,"length2":41}]],"length":8283,"saved":false}
{"ts":1361966697959,"patch":[[{"diffs":[[0,"chmentsOrder"],[1,"s"],[0,"\n        })\n"]],"start1":8210,"start2":8210,"length1":24,"length2":25}]],"length":8284,"saved":false}
{"ts":1361966712514,"patch":[[{"diffs":[[0,"og(this."],[-1,"$"],[0,"el.sorta"]],"start1":6547,"start2":6547,"length1":17,"length2":16},{"diffs":[[0,"te: "],[-1,"rendered_view.getAttachmentsOrders"],[1,"function(event, ui) {\n                that.model.updateAttachmentsOrder($(this).sortable(\"toArray\"));\n            }"],[0,"\n   "]],"start1":8184,"start2":8184,"length1":42,"length2":123}]],"length":8364,"saved":false}
{"ts":1361966963981,"patch":[[{"diffs":[[0,"    var "],[-1,"rendered"],[1,"attachments_collection"],[0,"_view = "]],"start1":7948,"start2":7948,"length1":24,"length2":38},{"diffs":[[0,"var "],[-1,"element = rendered"],[1,"attachments_view_element = attachments_collection"],[0,"_vie"]],"start1":8114,"start2":8114,"length1":26,"length2":57},{"diffs":[[0,"        "],[1,"attachments_view_"],[0,"element."]],"start1":8186,"start2":8186,"length1":16,"length2":33},{"diffs":[[0,"urn "],[-1,"rendered_view.render().el"],[1,"attachments_view_element"],[0,"\n   "]],"start1":8388,"start2":8388,"length1":33,"length2":32}]],"length":8425,"saved":false}
{"ts":1361967544517,"patch":[[{"diffs":[[0," },\n    "],[-1,"g"],[1,"s"],[0,"etAttach"]],"start1":6485,"start2":6485,"length1":17,"length2":17},{"diffs":[[0,"        "],[-1,"console.log("],[1,"this.model.set(\"attachments_order\","],[0,"this.el."]],"start1":6530,"start2":6530,"length1":28,"length2":51}]],"length":8448,"saved":false}
{"ts":1361967657133,"patch":[[{"diffs":[[0,"tion(a,b) {\n"],[1,"        console.log(this.el.sortable(\"toArray\"))\n"],[0,"        this"]],"start1":6518,"start2":6518,"length1":24,"length2":73}]],"length":8497,"saved":false}
{"ts":1361967670769,"patch":[[{"diffs":[[0,"console.log("],[1,"\"toArrt2\"< "],[0,"this.el.sort"]],"start1":6538,"start2":6538,"length1":24,"length2":35}]],"length":8508,"saved":false}
{"ts":1361967672358,"patch":[[{"diffs":[[0,"rt2\""],[-1,"< t"],[1,", "],[0,"his."]],"start1":6555,"start2":6555,"length1":11,"length2":10}]],"length":8507,"saved":false}
{"ts":1361967674227,"patch":[[{"diffs":[[0,"Arrt2\", "],[1,"t"],[0,"his.el.s"]],"start1":6553,"start2":6553,"length1":16,"length2":17}]],"length":8508,"saved":false}
{"ts":1361967678563,"patch":[[{"diffs":[[0,"\", this."],[-1,"g"],[1,"s"],[0,"etAttach"]],"start1":6447,"start2":6447,"length1":17,"length2":17}]],"length":8508,"saved":false}
{"ts":1361967688775,"patch":[[{"diffs":[[0,"rrt2\", this."],[1,"$"],[0,"el.sortable("]],"start1":6554,"start2":6554,"length1":24,"length2":25}]],"length":8509,"saved":false}
{"ts":1361967691954,"patch":[[{"diffs":[[0,"r\",this."],[1,"$"],[0,"el.sorta"]],"start1":6631,"start2":6631,"length1":16,"length2":17}]],"length":8510,"saved":false}
{"ts":1361967702379,"patch":[[{"diffs":[[0,") {\n"],[-1,"        console.log(\"toArrt2\", this.$el.sortable(\"toArray\"))\n"],[0,"    "]],"start1":6526,"start2":6526,"length1":69,"length2":8}]],"length":8449,"saved":false}
{"ts":1361968017027,"patch":[[{"diffs":[[0,"   }"],[-1,",\n    parent: function() { console.log(this.options); return this.belongs_to }\n    // Overwrite the Backbone.sync method for CREATE and UPDATE calls\n    // as we want to send just the binary data of the attachment\n    // We shouldn't concern ourselves with GETting the attachment as \n    // attachments should always be created via the parent collection\n    //\n    // options is created by the Backbone.Model.save() method and \n    // it contains the success callback for the low-level jQuery $.ajax\n    // method. We augment it with our own options.\n    /* sync: function(method, model, options) {\n        options.processData = false; \n        options.data = this.get(\"binary\");\n        options.url = this.url();\n        options.type = \"PUT\";\n        options.contentType = this.get(\"content_type\");\n        var success = options.success;\n        options.success = function(resp) {\n            if(success) success(model,resp,options);\n            model.trigger('sync',model.resp,options);\n        }\n        if (method === \"update\") {\n            $.ajax(options);\n        }\n    }*/"],[0,"\n})\n"]],"start1":165,"start2":165,"length1":1088,"length2":8},{"diffs":[[0,"nts.add("],[-1,"{}"],[0,")\n    },"]],"start1":6608,"start2":6608,"length1":18,"length2":16}]],"length":7367,"saved":false}
{"ts":1361968263687,"patch":[[{"diffs":[[0,"nd({"],[-1,"\n    updateBinary: function(file) {\n        this.set(\"binary\", file)\n        this.set(\"content_type\", file.type)\n    }\n"],[0,"})\n\n"]],"start1":47,"start2":47,"length1":127,"length2":8}]],"length":7248,"saved":false}
{"ts":1361968304052,"patch":[[{"diffs":[[0,"rom the "],[-1,"\n    // "],[0,"parent v"]],"start1":5531,"start2":5531,"length1":24,"length2":16},{"diffs":[[0,"lass"],[-1," (below)"],[0," is "]],"start1":5552,"start2":5552,"length1":16,"length2":8}]],"length":7232,"saved":false}
{"ts":1361968335258,"patch":[[{"diffs":[[0,"    var "],[-1,"v"],[1,"attachment_view"],[0," = new t"]],"start1":5615,"start2":5615,"length1":17,"length2":31},{"diffs":[[0,".append("],[-1,"v"],[1,"attachment_view"],[0,".render("]],"start1":5805,"start2":5805,"length1":17,"length2":31}]],"length":7260,"saved":false}
{"ts":1361968364399,"patch":[[{"diffs":[[0,"d({\n"],[-1,"    // \n"],[0,"    "]],"start1":6431,"start2":6431,"length1":16,"length2":8}]],"length":7252,"saved":false}
{"ts":1361969142223,"patch":[[{"diffs":[[0,"extend({"],[1,"\n    updateBinary: function(file) {\n        this.set({binary: file, content_type: file.type, id: file.name});      \n    }\n"],[0,"})\n\nBack"]],"start1":43,"start2":43,"length1":16,"length2":138},{"diffs":[[0,"ent."],[-1,"set({binary: file, content_type: file.type, id: file.name});"],[1,"updateBinary(file)"],[0,"\n   "]],"start1":4437,"start2":4437,"length1":68,"length2":26}]],"length":7332,"saved":false}
{"ts":1361969149896,"patch":[[{"diffs":[[0,"    "],[-1,"var file = e.dataTransfer.files[0];\n\n        attachment.updateBinary(file"],[1,"attachment.updateBinary(e.dataTransfer.files[0];"],[0,")\n  "]],"start1":4381,"start2":4381,"length1":81,"length2":56}]],"length":7307,"saved":false}
{"ts":1361969152725,"patch":[[{"diffs":[[0,"s[0]"],[-1,";"],[0,")"],[1,";"],[0,"\n   "]],"start1":4428,"start2":4428,"length1":10,"length2":10}]],"length":7307,"saved":false}
{"ts":1361972986477,"patch":[[{"diffs":[[0,"tion(key) {\n"],[1,"            console.log(key)\n"],[0,"            "]],"start1":6030,"start2":6030,"length1":24,"length2":53}]],"length":7336,"saved":false}
{"ts":1361972993109,"patch":[[{"diffs":[[0,"ole.log("],[1,"typeof "],[0,"key)\n   "]],"start1":6058,"start2":6058,"length1":16,"length2":23}]],"length":7343,"saved":false}
{"ts":1361973128686,"patch":[[{"diffs":[[0,"    "],[-1,"console.log(typeof key)"],[1,"if(typeof key == \"number\") {\n                \n            } else {"],[0,"\n   "]],"start1":6050,"start2":6050,"length1":31,"length2":74},{"diffs":[[0,"ubview.el);\n"],[1,"            }\n"],[0,"        })\n "]],"start1":6441,"start2":6441,"length1":24,"length2":38}]],"length":7400,"saved":false}
{"ts":1361973166605,"patch":[[{"diffs":[[0,"                "],[1,"console.log(that.model.attachment_types)"],[0,"\n            } e"]],"start1":6083,"start2":6083,"length1":32,"length2":72}]],"length":7440,"saved":false}
{"ts":1361973258828,"patch":[[{"diffs":[[0,"    "],[-1,"console.log("],[1,"var subview = new that.options.view({\n                    attributes: {\n                        id: key + \"-\" + type\n                    },\n                    model: "],[0,"that"]],"start1":6095,"start2":6095,"length1":20,"length2":175},{"diffs":[[0," that.model."],[1,"_"],[0,"attachment_t"]],"start1":6265,"start2":6265,"length1":24,"length2":25},{"diffs":[[0,"ment"],[-1,"_types"],[1,"s.get(key + \"-\" + type)\n                }).render("],[0,")\n  "]],"start1":6284,"start2":6284,"length1":14,"length2":58}]],"length":7640,"saved":false}
{"ts":1361975002003,"patch":[[{"diffs":[[0,"    }).render()\n"],[1,"                 makeDroppable(subview.el, that.model._attachments.get(key), that.model)\n            that.$el.append(subview.el);\n"],[0,"            } el"]],"start1":6324,"start2":6324,"length1":32,"length2":162}]],"length":7770,"saved":false}
{"ts":1361975098165,"patch":[[{"diffs":[[0,"\"number\") {\n"],[1,"                that.model.attachment_types.forEach(function(type){\n"],[0,"            "]],"start1":6071,"start2":6071,"length1":24,"length2":92},{"diffs":[[0,"achments.get(key"],[1," + \"-\" + type"],[0,"), that.model)\n "]],"start1":6466,"start2":6466,"length1":32,"length2":45},{"diffs":[[0,"nd(subview.el);\n"],[1,"                })\n"],[0,"            } el"]],"start1":6535,"start2":6535,"length1":32,"length2":51}]],"length":7870,"saved":false}
{"ts":1361975149005,"patch":[[{"diffs":[[0,"(type){\n"],[1,"                    console.log(type, key)\n"],[0,"        "]],"start1":6143,"start2":6143,"length1":16,"length2":59}]],"length":7913,"saved":false}
{"ts":1361975223497,"patch":[[{"diffs":[[0,"ber[0];\n"],[1,"            console.log(type, number);\n"],[0,"        "]],"start1":997,"start2":997,"length1":16,"length2":55}]],"length":7952,"saved":false}
{"ts":1361975263212,"patch":[[{"diffs":[[0,"0];\n"],[-1,"            console.log(type, number);\n"],[0,"    "]],"start1":1001,"start2":1001,"length1":47,"length2":8},{"diffs":[[0,"   }\n        })\n"],[1,"        console.log(result)\n"],[0,"        var pars"]],"start1":1196,"start2":1196,"length1":32,"length2":60}]],"length":7941,"saved":false}
{"ts":1361975332972,"patch":[[{"diffs":[[0,"    "],[-1,"    var result = {};\n        _.each(resp._attachments, function(value, key, list) {\n            var type_number = key.split(\"-\");\n            var number = type_number[1];\n            var type = type_number[0];\n            result[number] = result[number] || {}\n            result[number][type] = {\n                content_type: list[key].content_type,\n                length: list[key].length\n            }\n        })\n        console.log(result)"],[0,"\n   "]],"start1":791,"start2":791,"length1":452,"length2":8}]],"length":7497,"saved":false}
{"ts":1361975348054,"patch":[[{"diffs":[[0,"e(resp)\n"],[-1,"    \n"],[0,"        "]],"start1":783,"start2":783,"length1":21,"length2":16}]],"length":7492,"saved":false}
{"ts":1361975366333,"patch":[[{"diffs":[[0,"ey, list) {\n"],[1,"            console.lo(key)\n"],[0,"            "]],"start1":866,"start2":866,"length1":24,"length2":52}]],"length":7520,"saved":false}
{"ts":1361975368961,"patch":[[{"diffs":[[0,"nsole.lo"],[1,"g"],[0,"(key)\n  "]],"start1":892,"start2":892,"length1":16,"length2":17}]],"length":7521,"saved":false}
{"ts":1361975401140,"patch":[[{"diffs":[[0,") {\n"],[-1,"            console.log(key)\n"],[0,"    "]],"start1":874,"start2":874,"length1":37,"length2":8},{"diffs":[[0,"tion(key) {\n"],[1,"            // Handle groups of attachments\n"],[0,"            "]],"start1":5609,"start2":5609,"length1":24,"length2":68}]],"length":7536,"saved":false}
{"ts":1361975422242,"patch":[[{"diffs":[[0,"og(t"],[-1,"ype, key"],[1,"hat.model._attachments.get(key + \"-\" + type)"],[0,")\n  "]],"start1":5803,"start2":5803,"length1":16,"length2":52}]],"length":7572,"saved":false}
{"ts":1361975541535,"patch":[[{"diffs":[[0,"is.set({"],[1,"\n            "],[0,"binary: "]],"start1":97,"start2":97,"length1":16,"length2":29},{"diffs":[[0,"y: file,"],[1,"\n           "],[0," content"]],"start1":123,"start2":123,"length1":16,"length2":28},{"diffs":[[0,"le.type,"],[1,"\n           "],[0," id: fil"]],"start1":160,"start2":160,"length1":16,"length2":28},{"diffs":[[0,"ile.name"],[-1,"});"],[1,"\n  "],[0,"      "],[1,"});"],[0,"\n    }\n}"]],"start1":186,"start2":186,"length1":25,"length2":28},{"diffs":[[0,"ly(this,"],[-1,""],[0,""],[1," "],[0,"argument"]],"start1":547,"start2":547,"length1":16,"length2":17},{"diffs":[[0,"is)\n        "],[-1,"    "],[0,"this._attach"]],"start1":1088,"start2":1088,"length1":28,"length2":24},{"diffs":[[0,"nts)"],[-1,"           \n        "],[1,"\n"],[0,"\n   "]],"start1":1139,"start2":1139,"length1":28,"length2":9},{"diffs":[[0,"      if"],[1," "],[0,"(this._a"]],"start1":2172,"start2":2172,"length1":16,"length2":17},{"diffs":[[0," > 0) {\n        "],[1,"    "],[0,"json._attachment"]],"start1":2206,"start2":2206,"length1":32,"length2":36},{"diffs":[[0,"s = {};\n"],[1,"    "],[0,"        "]],"start1":2242,"start2":2242,"length1":16,"length2":20},{"diffs":[[0,") {\n            "],[1,"    "],[0,"return attachmen"]],"start1":2324,"start2":2324,"length1":32,"length2":36},{"diffs":[[0,"nary\");\n"],[1,"    "],[0,"        "]],"start1":2369,"start2":2369,"length1":16,"length2":20},{"diffs":[[0,"        "],[1,"    "],[0,"// If no"]],"start1":2393,"start2":2393,"length1":16,"length2":20},{"diffs":[[0,"way\n        "],[1,"    "],[0,"if (attachme"]],"start1":2474,"start2":2474,"length1":24,"length2":28},{"diffs":[[0,") {\n            "],[1,"    "],[0,"callback(json)\n "]],"start1":2518,"start2":2518,"length1":32,"length2":36},{"diffs":[[0,"k(json)\n"],[1,"    "],[0,"        "]],"start1":2545,"start2":2545,"length1":16,"length2":20},{"diffs":[[0,"return;\n        "],[-1,"}\n"],[1,"    }\n    "],[0,"        // We ne"]],"start1":2569,"start2":2569,"length1":34,"length2":42},{"diffs":[[0,"ous\n        "],[1,"    "],[0,"// and we do"]],"start1":2667,"start2":2667,"length1":24,"length2":28},{"diffs":[[0," loaded\n"],[1,"    "],[0,"        "]],"start1":2733,"start2":2733,"length1":16,"length2":20},{"diffs":[[0,"        "],[1,"    "],[0,"_.each(a"]],"start1":2770,"start2":2770,"length1":16,"length2":20},{"diffs":[[0,"(attachment) {\n\n"],[1,"    "],[0,"            var "]],"start1":2810,"start2":2810,"length1":32,"length2":36},{"diffs":[[0,"();\n            "],[1,"    "],[0,"fReader.onload ="]],"start1":2870,"start2":2870,"length1":32,"length2":36},{"diffs":[[0,"ction(event) {\n\n"],[1,"    "],[0,"                "]],"start1":2910,"start2":2910,"length1":32,"length2":36},{"diffs":[[0,"            "],[1,"    "],[0,"var data = e"]],"start1":2961,"start2":2961,"length1":24,"length2":28},{"diffs":[[0,",\")[1];\n"],[1,"    "],[0,"        "]],"start1":3015,"start2":3015,"length1":16,"length2":20},{"diffs":[[0,"                "],[1,"    "],[0,"content_type: at"]],"start1":3084,"start2":3084,"length1":32,"length2":36},{"diffs":[[0,"type\"),\n"],[1,"    "],[0,"        "]],"start1":3142,"start2":3142,"length1":16,"length2":20},{"diffs":[[0,"                "],[-1,"}\n"],[1,"    }\n    "],[0,"                "]],"start1":3185,"start2":3185,"length1":34,"length2":42},{"diffs":[[0,"                "],[1,"    "],[0,"callback(json);\n"]],"start1":3268,"start2":3268,"length1":32,"length2":36},{"diffs":[[0,"(json);\n"],[1,"    "],[0,"        "]],"start1":3296,"start2":3296,"length1":16,"length2":20},{"diffs":[[0,"  }\n            "],[-1,"}\n"],[1,"    }\n    "],[0,"            fRea"]],"start1":3322,"start2":3322,"length1":34,"length2":42},{"diffs":[[0,"nary\"))\n        "],[1,"    "],[0,"})\n        }\n   "]],"start1":3400,"start2":3400,"length1":32,"length2":36},{"diffs":[[0,"  else {"],[1,"\n           "],[0," callbac"]],"start1":3439,"start2":3439,"length1":16,"length2":28},{"diffs":[[0,"ck(json)"],[1,"\n       "],[0," }\n    }"]],"start1":3466,"start2":3466,"length1":16,"length2":24},{"diffs":[[0,"uments)\n"],[-1,"     "],[0,""],[1,""],[0,"\n       "]],"start1":4448,"start2":4448,"length1":21,"length2":16},{"diffs":[[0,"    });\n"],[-1,"        "],[0,""],[1,""],[0,"\n       "]],"start1":4698,"start2":4698,"length1":24,"length2":16},{"diffs":[[0,"e);\n    "],[-1,"    "],[0,""],[1,""],[0,"}\n})\n\nBa"]],"start1":4805,"start2":4805,"length1":20,"length2":16},{"diffs":[[0,"ction(a,"],[1," "],[0,"b) {\n   "]],"start1":5082,"start2":5082,"length1":16,"length2":17},{"diffs":[[0,"_order\","],[1," "],[0,"this.$el"]],"start1":5131,"start2":5131,"length1":16,"length2":17},{"diffs":[[0,"     });"],[-1,"      "],[0,""],[1,""],[0,"\n       "]],"start1":5540,"start2":5540,"length1":22,"length2":16},{"diffs":[[0,"      if"],[1," "],[0,"(typeof "]],"start1":5797,"start2":5797,"length1":16,"length2":17},{"diffs":[[0,"on(type)"],[1," "],[0,"{\n      "]],"start1":5891,"start2":5891,"length1":16,"length2":17},{"diffs":[[0,"    "],[-1,"console.log("],[1,"var attachment_id = key + \"-\" + type;\n                    var attachment = "],[0,"that"]],"start1":5918,"start2":5918,"length1":20,"length2":83},{"diffs":[[0," + type)"],[-1,")\n"],[1,";\n                  \n    "],[0,"        "]],"start1":6034,"start2":6034,"length1":18,"length2":41},{"diffs":[[0,"                "],[1,"   "],[1," "],[0,"attributes: {\n  "]],"start1":6125,"start2":6125,"length1":32,"length2":36},{"diffs":[[0,"  attributes: {\n"],[1,"    "],[0,"                "]],"start1":6143,"start2":6143,"length1":32,"length2":36},{"diffs":[[0,"                "],[-1,"},\n"],[1,"    },\n    "],[0,"                "]],"start1":6212,"start2":6212,"length1":35,"length2":43},{"diffs":[[0,"el: "],[-1,"that.model._attachments.get(key + \"-\" + type)\n"],[1,"attachment\n    "],[0,"    "]],"start1":6262,"start2":6262,"length1":54,"length2":23},{"diffs":[[0,"                "],[1," "],[1,"  "],[0,"makeDroppable(su"]],"start1":6310,"start2":6310,"length1":32,"length2":35},{"diffs":[[0,"el, "],[-1,"that.model._attachments.get(key + \"-\" + type), that.model)\n"],[1,"attachment\n        "],[0,"    "]],"start1":6351,"start2":6351,"length1":67,"length2":27},{"diffs":[[0,"       }"],[1,"\n           "],[0," else {\n"]],"start1":6439,"start2":6439,"length1":16,"length2":28},{"diffs":[[0,"e {\n            "],[1," "],[1,"   "],[0,"var subview = ne"]],"start1":6463,"start2":6463,"length1":32,"length2":36},{"diffs":[[0,"                "],[1,"    "],[0,"attributes: {\n  "]],"start1":6521,"start2":6521,"length1":32,"length2":36},{"diffs":[[0,"            "],[1," "],[1,"   "],[0,"id: key\n    "]],"start1":6563,"start2":6563,"length1":24,"length2":28},{"diffs":[[0,"                "],[1,"    "],[0,"},\n             "]],"start1":6587,"start2":6587,"length1":32,"length2":36},{"diffs":[[0,"                "],[1," "],[1,"   "],[0,"model: that.mode"]],"start1":6610,"start2":6610,"length1":32,"length2":36},{"diffs":[[0,"ey)\n            "],[1,"    "],[0,"}).render()\n    "]],"start1":6666,"start2":6666,"length1":32,"length2":36},{"diffs":[[0,"    }).render()\n"],[1,"    "],[0,"            make"]],"start1":6682,"start2":6682,"length1":32,"length2":36},{"diffs":[[0,"y), that.model)\n"],[1,"    "],[0,"            that"]],"start1":6770,"start2":6770,"length1":32,"length2":36},{"diffs":[[0,"unction() {\n"],[1,"  "],[0,"      this.m"]],"start1":6981,"start2":6981,"length1":24,"length2":26}]],"length":7780,"saved":false}
{"ts":1361975543886,"patch":[[{"diffs":[[0,"w.el, attachment"],[1,")"],[0,"\n               "]],"start1":6349,"start2":6349,"length1":32,"length2":33}]],"length":7781,"saved":false}
{"ts":1361977426047,"patch":[[{"diffs":[[0,"anges\n      "],[1,"//"],[0,"  this.liste"]],"start1":4524,"start2":4524,"length1":24,"length2":26},{"diffs":[[0,"r) {\n       "],[1,"//"],[0,"     this.$e"]],"start1":4598,"start2":4598,"length1":24,"length2":26},{"diffs":[[0,"del.id)\n        "],[1,"//"],[0,"    model.collec"]],"start1":4639,"start2":4639,"length1":32,"length2":34},{"diffs":[[0,"d');\n       "],[1,"//"],[0," });\n\n      "]],"start1":4695,"start2":4695,"length1":24,"length2":26}]],"length":7789,"saved":false}
{"ts":1361977483439,"patch":[[{"diffs":[[0,"nts.get("],[-1,"key + \"-\" + type"],[1,"attachment_id"],[0,");\n     "]],"start1":6025,"start2":6025,"length1":32,"length2":29},{"diffs":[[0,"    id: "],[-1,"key + \"-\" + type"],[1,"attachment_id"],[0,"\n       "]],"start1":6188,"start2":6188,"length1":32,"length2":29}]],"length":7783,"saved":false}
{"ts":1361977513878,"patch":[[{"diffs":[[0,"+ type;\n"],[1,"                    console.log(attachment)id)\n"],[0,"        "]],"start1":5960,"start2":5960,"length1":16,"length2":63}]],"length":7830,"saved":false}
{"ts":1361977516604,"patch":[[{"diffs":[[0,"tachment"],[-1,")"],[1,"_"],[0,"id)\n    "]],"start1":6002,"start2":6002,"length1":17,"length2":17}]],"length":7830,"saved":false}
{"ts":1361977535036,"patch":[[{"diffs":[[0,"tion(key) {\n"],[1,"            console.log(key)\n"],[0,"            "]],"start1":5743,"start2":5743,"length1":24,"length2":53}]],"length":7859,"saved":false}
{"ts":1361977573632,"patch":[[{"diffs":[[0,"mpty();\n"],[1,"console.log(this.model.attachments_order)"],[0,"\n       "]],"start1":5685,"start2":5685,"length1":16,"length2":57}]],"length":7900,"saved":false}
{"ts":1361977600971,"patch":[[{"diffs":[[0,"\"number\") {\n"],[1,"                console.log(true)\n"],[0,"            "]],"start1":5899,"start2":5899,"length1":24,"length2":58}]],"length":7934,"saved":false}
{"ts":1361977642701,"patch":[[{"diffs":[[0,"    "],[-1,"if (typeof key == \"number\") {\n                console.log(true)\n                that.model.attachment_types.forEach(function(type) {\n                    var attachment_id = key + \"-\" + type;\n                    console.log(attachment_id)\n                    var attachment = that.model._attachments.get(attachment_id);\n                  \n                    var subview = new that.options.view({\n                        attributes: {\n                            id: attachment_id\n                        },\n                        model: attachment\n                    }).render()\n                    makeDroppable(subview.el, attachment)\n                    that.$el.append(subview.el);\n                })\n            }\n            else {\n                var subview = new that.options.view({\n                    attributes: {\n                        id: key\n                    },\n                    model: that.model._attachments.get(key)\n                }).render()\n                makeDroppable(subview.el, that.model._attachments.get(key), that.model)\n                that.$el.append(subview.el);\n            }"],[0,"\n   "]],"start1":5877,"start2":5877,"length1":1125,"length2":8}]],"length":6817,"saved":false}
{"ts":1361977654381,"patch":[[{"diffs":[[0,"        "],[1,"if (typeof key == \"number\") {\n                console.log(true)\n                that.model.attachment_types.forEach(function(type) {\n                    var attachment_id = key + \"-\" + type;\n                    console.log(attachment_id)\n                    var attachment = that.model._attachments.get(attachment_id);\n                  \n                    var subview = new that.options.view({\n                        attributes: {\n                            id: attachment_id\n                        },\n                        model: attachment\n                    }).render()\n                    makeDroppable(subview.el, attachment)\n                    that.$el.append(subview.el);\n                })\n            }"],[0,"\n       "]],"start1":5873,"start2":5873,"length1":16,"length2":736}]],"length":7537,"saved":false}
{"ts":1361977673156,"patch":[[{"diffs":[[0,"    "],[-1,"that.model.attachment_types.forEach(function(type) {\n                    var attachment_id = key + \"-\" + type;\n                    console.log(attachment_id)\n                    var attachment = that.model._attachments.get(attachment_id);\n                  \n    "],[1,"\n            }\n            else {\n"],[0,"    "]],"start1":5957,"start2":5957,"length1":270,"length2":42},{"diffs":[[0,"                "],[-1,"    "],[0,"attributes: {\n  "]],"start1":6053,"start2":6053,"length1":36,"length2":32},{"diffs":[[0,"    "],[-1,"    id: attachment_id\n    "],[1,"id: key\n"],[0,"    "]],"start1":6103,"start2":6103,"length1":34,"length2":16},{"diffs":[[0,"             },\n"],[-1,"    "],[0,"                "]],"start1":6122,"start2":6122,"length1":36,"length2":32},{"diffs":[[0,"     model: "],[-1,"attachment"],[1,"that.model._attachments.get(key)"],[0,"\n           "]],"start1":6153,"start2":6153,"length1":34,"length2":56},{"diffs":[[0,"        "],[-1,"    "],[0,"}).rende"]],"start1":6206,"start2":6206,"length1":20,"length2":16},{"diffs":[[0,"ender()\n"],[-1,"    "],[0,"        "]],"start1":6218,"start2":6218,"length1":20,"length2":16},{"diffs":[[0,"el, "],[-1,"attachment)\n    "],[1,"that.model._attachments.get(key), that.model)\n"],[0,"    "]],"start1":6264,"start2":6264,"length1":24,"length2":54},{"diffs":[[0,"l);\n"],[-1,"                })\n"],[0,"    "]],"start1":6355,"start2":6355,"length1":27,"length2":8}]],"length":7308,"saved":false}
{"ts":1361977718258,"patch":[[{"diffs":[[0,"        "],[1,"that.model.attachment_types.forEach(function(type) {\n                    var attachment_id = key + \"-\" + type;\n                    console.log(attachment_id)\n                    var attachment = that.model._attachments.get(attachment_id);\n                  \n                    var subview = new that.options.view({\n                        attributes: {\n                            id: attachment_id\n                        },\n                        model: attachment\n                    }).render()\n                    that.$el.append(subview.el);\n                })"],[0,"\n       "]],"start1":5953,"start2":5953,"length1":16,"length2":584}]],"length":7876,"saved":false}
{"ts":1361977735763,"patch":[[{"diffs":[[0,"    "],[-1,"var subview = new that.options.view({\n                        attributes: {\n                            id: attachment_id\n                        },\n                        model: attachment\n                    }).render("],[1,"makeDroppable(subview.el, attachment"],[0,")\n  "]],"start1":6235,"start2":6235,"length1":229,"length2":44}]],"length":7691,"saved":false}
{"ts":1361977745407,"patch":[[{"diffs":[[0,"    "],[-1,"   makeDroppable(subview.el, attachment)\n                    that.$el.append(subview.el);"],[0,"\n   "]],"start1":6232,"start2":6232,"length1":97,"length2":8}]],"length":7602,"saved":false}
{"ts":1361977759318,"patch":[[{"diffs":[[0,"                "],[1,"console.log(attachment)"],[0,"\n               "]],"start1":6202,"start2":6202,"length1":32,"length2":55}]],"length":7625,"saved":false}
{"ts":1361977782522,"patch":[[{"diffs":[[0,"    "],[-1,"console.log(attachment)\n                 "],[1,"\n                    var subview = new that.options.view({\n                        attributes: {\n                            id: attachment_id\n                        },\n                        model: attachment\n                    }).render()\n                    makeDroppable(subview.el, attachment)\n                    that.$el.append(subview.el);"],[0,"\n   "]],"start1":6214,"start2":6214,"length1":49,"length2":358}]],"length":7934,"saved":false}
{"contributors":[],"silentsave":false,"ts":1362001739853,"patch":[[{"diffs":[[0,"();\n"],[-1,"console.log(this.model.attachments_order)\n"],[0,"    "]],"start1":5689,"start2":5689,"length1":50,"length2":8},{"diffs":[[0,") {\n"],[-1,"            console.log(key)\n"],[0,"    "]],"start1":5750,"start2":5750,"length1":37,"length2":8},{"diffs":[[0,"\"number\") {\n"],[-1,""],[0,"            "]],"start1":5828,"start2":5828,"length1":24,"length2":24},{"diffs":[[0,"g(true)\n"],[1,"                var these_attachments_el = $('<div></div>');\n"],[0,"        "]],"start1":5866,"start2":5866,"length1":16,"length2":77},{"diffs":[[0,"              th"],[-1,"at.$"],[1,"ese_attachments_"],[0,"el.append(subvie"]],"start1":6516,"start2":6516,"length1":36,"length2":48},{"diffs":[[0,"             })\n"],[1,"                that.$el.append(these_attachments_el);\n"],[0,"            }\n  "]],"start1":6574,"start2":6574,"length1":32,"length2":87}]],"length":7991,"saved":false}
{"ts":1362001817330,"patch":[[{"diffs":[[0,"></div>'"],[1,", { id: key}"],[0,");\n     "]],"start1":5924,"start2":5924,"length1":16,"length2":28}]],"length":8003,"saved":false}
{"ts":1362001851237,"patch":[[{"diffs":[[0,";\n            }\n"],[1,"            // Handle single attachments\n"],[0,"            else"]],"start1":6655,"start2":6655,"length1":32,"length2":73}]],"length":8044,"saved":false}
{"ts":1362001933150,"patch":[[{"diffs":[[0,"pe;\n"],[-1,"                    console.log(attachment_id)\n"],[0,"    "]],"start1":6070,"start2":6070,"length1":55,"length2":8}]],"length":7997,"saved":false}
{"ts":1362001971477,"patch":[[{"diffs":[[0,") {\n"],[-1,"                console.log(true)\n"],[0,"    "]],"start1":5836,"start2":5836,"length1":42,"length2":8}]],"length":7963,"saved":false}
{"ts":1362002679801,"patch":[[{"diffs":[[0,"vent, ui) {\n"],[1,"                console.log(\"DROPPED\")\n"],[0,"            "]],"start1":7798,"start2":7798,"length1":24,"length2":63}]],"length":8002,"saved":false}
{"ts":1362002712650,"patch":[[{"diffs":[[0,") {\n"],[-1,"                console.log(\"DROPPED\")\n"],[0,"    "]],"start1":7806,"start2":7806,"length1":47,"length2":8}]],"length":7963,"saved":false}
{"ts":1362002722741,"patch":[[{"diffs":[[0,", function(e) {\n"],[1,"        \n                console.log(\"DROPPED\")\n"],[0,"        e.preven"]],"start1":4059,"start2":4059,"length1":32,"length2":80}]],"length":8011,"saved":false}
{"contributors":[],"silentsave":false,"ts":1362051801857,"patch":[[{"diffs":[[0,"\n// "],[-1,"Takes the Attachment View and makes it into a droppable element\n// and provides a callback to be executed when a file is dropped\n// on that element\nfunction makeDroppable(el, attachment) {\n    // We need this to prevent the browser using its standard default when you drag over\n    el.addEventListener('dragover', function(e) {\n        e.preventDefault();\n    });\n\n    // Listen for a file to be dropped on the element\n    // and then get the file, set the binary data of the attachment\n    // and save it\n    el.addEventListener('drop', function(e) {\n        \n                console.log(\"DROPPED\")\n        e.preventDefault();\n        attachment.updateBinary(e.dataTransfer.files[0]);\n        //$('img').remove()\n        //$('<img>').attr('title', file.name).attr('src', this.result).css('width', '50px').appendTo(el);\n    });\n}\n// "],[0,""],[1,""],[0,"VIEW"]],"start1":3519,"start2":3519,"length1":841,"length2":8},{"diffs":[[0,"chments\n"],[-1,"\n"],[0,"Backbone"]],"start1":3537,"start2":3537,"length1":17,"length2":16},{"diffs":[[0,"anges\n      "],[1,"  "],[0,"//  this.lis"]],"start1":3738,"start2":3738,"length1":24,"length2":26},{"diffs":[[0," another) {\n"],[1," "],[0,"       //   "]],"start1":3807,"start2":3807,"length1":24,"length2":25},{"diffs":[[0,"    "],[1," "],[0,"// });\n"],[-1,"\n"],[0,"        "],[-1,"makeDroppable(this.el, this.model"],[1,"this.el.addEventListener('dragover', function(e) {\n            e.preventDefault();\n        });\n\n        // Listen for a file to be dropped on the element\n        // and then get the file, set the binary data of the attachment\n        // and save it\n        this.el.addEventListener('drop', function(e) {\n\n            console.log(\"DROPPED\")\n            e.preventDefault();\n            this.model.updateBinary(e.dataTransfer.files[0]);\n        }"],[0,")\n  "]],"start1":3920,"start2":3920,"length1":57,"length2":467}]],"length":7590,"saved":false}
{"ts":1362051859805,"patch":[[{"diffs":[[0," arguments)\n"],[1,"        var that = this;"],[0,"\n        // "]],"start1":3658,"start2":3658,"length1":24,"length2":48},{"diffs":[[0," the element"],[-1,"\n        //"],[0," and then ge"]],"start1":4105,"start2":4105,"length1":35,"length2":24},{"diffs":[[0,"e file, "],[1,"\n        // "],[0,"set the "]],"start1":4133,"start2":4133,"length1":16,"length2":28},{"diffs":[[0,"tachment"],[-1,"\n        //"],[0," and sav"]],"start1":4182,"start2":4182,"length1":27,"length2":16},{"diffs":[[0,"e) {"],[-1,"\n\n            console.log(\"DROPPED\")"],[0,"\n   "]],"start1":4253,"start2":4253,"length1":44,"length2":8},{"diffs":[[0,"          th"],[-1,"is"],[1,"at"],[0,".model.updat"]],"start1":4292,"start2":4292,"length1":26,"length2":26}]],"length":7568,"saved":false}
{"ts":1362051928465,"patch":[[{"diffs":[[0,"id\"\n});\n\n// "],[-1,""],[0,""],[1,"Takes the Attachment View and makes it into a droppable element and provides a callback \n// to be executed when a file is dropped on that element\nfunction makeDroppable(el, attachment) {\n    // We need this to prevent the browser using its standard default when you drag over\n    el.addEventListener('dragover', function(e) {\n        e.preventDefault();\n    });\n\n    // Listen for a file to be dropped on the element and then get the file, set the \n    // binary data of the attachment and save it\n    el.addEventListener('drop', function(e) {\n        e.preventDefault();\n        attachment.updateBinary(e.dataTransfer.files[0]);\n    });\n}\n// "],[0,"VIEWS \n// At"]],"start1":3511,"start2":3511,"length1":24,"length2":667},{"diffs":[[0,"chments\n"],[1,"\n"],[0,"Backbone"]],"start1":4180,"start2":4180,"length1":16,"length2":17},{"diffs":[[0,"ts)\n"],[-1,"        var that = this;"],[0,""],[1,""],[0,"\n   "]],"start1":4310,"start2":4310,"length1":32,"length2":8},{"diffs":[[0,"anges\n      "],[-1,"  "],[0,"//  this.lis"]],"start1":4382,"start2":4382,"length1":26,"length2":24},{"diffs":[[0," another) {\n"],[-1," "],[0,"       //   "]],"start1":4449,"start2":4449,"length1":25,"length2":24},{"diffs":[[0,"    "],[-1," "],[0,"// });\n"],[-1,"        "],[0,"this"]],"start1":4561,"start2":4561,"length1":24,"length2":15},{"diffs":[[0,"on(e) {\n        "],[-1,"    "],[0,"e.preventDefault"]],"start1":4615,"start2":4615,"length1":36,"length2":32},{"diffs":[[0,"();\n    "],[-1,"   "],[-1," "],[0,"});\n\n"],[-1,"    "],[0,"    // L"]],"start1":4647,"start2":4647,"length1":29,"length2":21},{"diffs":[[0,"d on the element"],[1,"\n    //"],[0," and then get th"]],"start1":4697,"start2":4697,"length1":32,"length2":39},{"diffs":[[0,"e file, "],[-1,"\n        // "],[0,"set the "]],"start1":4736,"start2":4736,"length1":28,"length2":16},{"diffs":[[0,"f the attachment"],[1,"\n    //"],[0," and save it\n   "]],"start1":4765,"start2":4765,"length1":32,"length2":39},{"diffs":[[0,"save it\n"],[-1,"    "],[0,"    this"]],"start1":4793,"start2":4793,"length1":20,"length2":16},{"diffs":[[0,") {\n        "],[1,"\n                console.log(\"DROPPED\")\n    "],[0,"    e.preven"]],"start1":4848,"start2":4848,"length1":24,"length2":68},{"diffs":[[0,"();\n        "],[-1,"    that"],[1,"this"],[0,".model.updat"]],"start1":4924,"start2":4924,"length1":32,"length2":28},{"diffs":[[0,"es[0]);\n        "],[-1,"}"],[1,"\n        //makeDroppable(this.el, this.model"],[0,")\n        this.l"]],"start1":4978,"start2":4978,"length1":33,"length2":76}]],"length":8245,"saved":false}
{"ts":1362051994276,"patch":[[{"diffs":[[0,";\n}\n"],[1,"//\n"],[0,"// VIEWS"],[-1," "],[0,"\n//"],[-1," Attachments"],[0,"\n\nBa"]],"start1":4159,"start2":4159,"length1":32,"length2":22},{"diffs":[[0,"    "],[-1,"// Update the element's id when the id of the attachment changes\n      //  this.listenTo(this.model, \"change\", function(model, another) {\n       //     this.$el.attr('id', model.id)\n        //    model.collection.trigger('update-id');\n       // });\n"],[0,"this"]],"start1":4309,"start2":4309,"length1":257,"length2":8},{"diffs":[[0,"on(e) {\n        "],[1,"    "],[0,"e.preventDefault"]],"start1":4356,"start2":4356,"length1":32,"length2":36},{"diffs":[[0,"eventDefault();\n"],[1,"    "],[0,"    });\n\n    // "]],"start1":4380,"start2":4380,"length1":32,"length2":36},{"diffs":[[0,");\n        });\n\n"],[1,"    "],[0,"    // Listen fo"]],"start1":4393,"start2":4393,"length1":32,"length2":36},{"diffs":[[0,"the element\n"],[1,"    "],[0,"    // and t"]],"start1":4455,"start2":4455,"length1":24,"length2":28},{"diffs":[[0,"    "],[-1,"// and save it\n    this.el.addEventListener('drop', function(e) {\n        \n                console.log(\"DROPPED\")\n        e.preventDefault();\n        this.model.updateBinary(e.dataTransfer.files[0]);\n        \n        //"],[1,"    // and save it\n        "],[0,"make"]],"start1":4539,"start2":4539,"length1":227,"length2":35}]],"length":7810,"saved":false}
{"ts":1362052005619,"patch":[[{"diffs":[[0,"}\n//"],[-1,"\n// VIEWS\n"],[1,"///////////////\n// VIEWS\n///////////////"],[0,"//\n\n"]],"start1":4161,"start2":4161,"length1":18,"length2":48}]],"length":7840,"saved":false}
{"ts":1362052017691,"patch":[[{"diffs":[[0," the element"],[-1,"\n        //"],[0," and then ge"]],"start1":4484,"start2":4484,"length1":35,"length2":24},{"diffs":[[0,"n get the file, "],[1,"\n        // "],[0,"set the binary d"]],"start1":4504,"start2":4504,"length1":32,"length2":44},{"diffs":[[0,"tachment"],[-1,"\n        //"],[0," and sav"]],"start1":4561,"start2":4561,"length1":27,"length2":16}]],"length":7830,"saved":false}
{"ts":1362052072721,"patch":[[{"diffs":[[0,");\n\n"],[-1,"// Takes the Attachment View and makes it into a droppable element and provides a callback \n// to be executed when a file is dropped on that element\nfunction makeDroppable(el, attachment) {\n    // We need this to prevent the browser using its standard default when you drag over\n    el.addEventListener('dragover', function(e) {\n        e.preventDefault();\n    });\n\n    // Listen for a file to be dropped on the element and then get the file, set the \n    // binary data of the attachment and save it\n    el.addEventListener('drop', function(e) {\n        e.preventDefault();\n        attachment.updateBinary(e.dataTransfer.files[0]);\n    });\n}"],[0,"\n///"]],"start1":3516,"start2":3516,"length1":650,"length2":8},{"diffs":[[0,"element\n    }\n})"],[1,"\n\n////////////////\n// HELPERS \n////////////////\n\n\n// Takes the Attachment View and makes it into a droppable element and provides a callback \n// to be executed when a file is dropped on that element\nfunction makeDroppable(el, attachment) {\n    // We need this to prevent the browser using its standard default when you drag over\n    el.addEventListener('dragover', function(e) {\n        e.preventDefault();\n    });\n\n    // Listen for a file to be dropped on the element and then get the file, set the \n    // binary data of the attachment and save it\n    el.addEventListener('drop', function(e) {\n        e.preventDefault();\n        attachment.updateBinary(e.dataTransfer.files[0]);\n    });\n}"]],"start1":7172,"start2":7172,"length1":16,"length2":708}]],"length":7880,"saved":false}
{"ts":1362052077918,"patch":[[{"diffs":[[0,"})\n\n"],[-1,"// VIEW \n// CouchDB Model\n\n"],[0,"Back"]],"start1":6291,"start2":6291,"length1":35,"length2":8}]],"length":7853,"saved":false}
{"ts":1362052155069,"patch":[[{"diffs":[[0,"d\"\n});\n\n"],[-1,"\n"],[0,"////////"]],"start1":3512,"start2":3512,"length1":17,"length2":16},{"diffs":[[0,"//////\n\n"],[-1,"\n"],[0,"// Takes"]],"start1":7201,"start2":7201,"length1":17,"length2":16}]],"length":7851,"saved":false}
{"ts":1362052831175,"patch":[[{"diffs":[[0,"    "],[-1,"    this.model._attachments.on(\"update-id\", this.setAttachmentsOrder, this)\n    },\n    setAttachmentsOrder: function(a, b) {\n        this.model.set(\"attachments_order\", this.$el.sortable(\"toArray\"))"],[1,"},\n    setAttachmentsOrder: function(a, b) {"],[0,"\n   "]],"start1":4199,"start2":4199,"length1":206,"length2":52},{"diffs":[[0,"ender().el)\n"],[1,"        \n        this.model.set(\"attachments_order\", this.$el.sortable(\"toArray\"))\n"],[0,"    },\n    r"]],"start1":4668,"start2":4668,"length1":24,"length2":107}]],"length":7780,"saved":false}
{"ts":1362052861789,"patch":[[{"diffs":[[0," },\n"],[-1,"    setAttachmentsOrder: function(a, b) {\n    },\n"],[0,"    "]],"start1":4202,"start2":4202,"length1":57,"length2":8},{"diffs":[[0,"r().el)\n"],[-1,"        \n"],[0,"        "]],"start1":4623,"start2":4623,"length1":25,"length2":16}]],"length":7722,"saved":false}
{"ts":1362056074460,"patch":[[{"diffs":[[0,"el, this.model)\n"],[1,"        this.listenTo(this.model, \"change:id\", function(model) {\n            console.log(\"CHanged id\", model)\n        })\n"],[0,"        this.lis"]],"start1":3966,"start2":3966,"length1":32,"length2":153},{"diffs":[[0,"r().el)\n        "],[1,"//"],[0,"this.model.set(\""]],"start1":4744,"start2":4744,"length1":32,"length2":34},{"diffs":[[0,", function(e) {\n"],[1,"        \n"],[0,"        e.preven"]],"start1":7734,"start2":7734,"length1":32,"length2":41}]],"length":7854,"saved":false}
{"ts":1362056964206,"patch":[[{"diffs":[[0," arguments)\n"],[1,"        var that = this;"],[0,"\n"],[-1,""],[0,"        this"]],"start1":3679,"start2":3679,"length1":25,"length2":49},{"diffs":[[0,");\n\n"],[-1,"        // Listen for a file to be dropped on the element and then get the file, \n        // set the binary data of the attachment and save it\n"],[0,"    "]],"start1":3816,"start2":3816,"length1":151,"length2":8},{"diffs":[[0,"    "],[-1,"console.log(\"CHanged id\""],[1,"that.$el.attr('id'"],[0,", model"],[1,".id"],[0,")\n  "]],"start1":3936,"start2":3936,"length1":39,"length2":36}]],"length":7732,"saved":false}
{"contributors":[],"silentsave":false,"ts":1362068267775,"patch":[[{"diffs":[[0,"d({\n"],[-1,"    updateBinary: function(file) {\n        this.set({\n            binary: file,\n            content_type: file.type,\n            id: file.name\n        });\n    }\n"],[0,"})\n\n"]],"start1":48,"start2":48,"length1":169,"length2":8},{"diffs":[[0,"\n    },\n"],[1,"    addAttachmentGroup: function() {\n        var max = this.model._attachments.max(function(attachment) {\n            var split = attachment.id.split(\"-\");\n            return split[0];\n        })\n        var new_id = parseInt(max.id.split(\"-\")[0]) + 1;\n\n        this.model.attachment_types.forEach(function(type) {\n            this.model._attachments.add({\n                id: new_id + \"-\" + type\n            })\n        }, this)\n        this.model._attachments.trigger(\"added-group\", new_id)\n    },"],[0,"\n    //"],[-1," "],[0,"We call "]],"start1":1137,"start2":1137,"length1":24,"length2":521},{"diffs":[[0,"////"],[-1,"\n// VIEWS\n"],[1,"////////////////////////////////////////////////////////////////\n// VIEWS\n////////////////////////////////////////////////////////////////"],[0,"////"]],"start1":3869,"start2":3869,"length1":18,"length2":146},{"diffs":[[0,"    "],[-1,"makeDroppable(this.el, this.model)\n        this.listenTo(this.model, \"change:id\", function(model) {\n            that.$el.attr('id', model.id)"],[1,"// Listen for a file to be dropped on the element and then get the file, set the \n        // binary data of the attachment and save it\n        this.el.addEventListener('drop', function(e) {\n            e.preventDefault();\n            var file = e.dataTransfer.files[0];\n            that.model.set({\n                binary: file,\n                content_type: file.type,\n                id: e.srcElement.id\n            });"],[0,"\n   "]],"start1":4288,"start2":4288,"length1":149,"length2":429},{"diffs":[[0,"  });\n        })"],[1,";"],[0,"\n        this.li"]],"start1":4708,"start2":4708,"length1":32,"length2":33},{"diffs":[[0,"his)\n    },\n"],[1,"    updateAttachments: function() {\n        this.model.set(\"attachments_order\", this.$el.sortable(\"toArray\"))\n    },\n"],[0,"    // addAt"]],"start1":4938,"start2":4938,"length1":24,"length2":141},{"diffs":[[0,"el)\n"],[-1,"        //this.model.set(\"attachments_order\", this.$el.sortable(\"toArray\"))\n"],[0,"    "]],"start1":5488,"start2":5488,"length1":84,"length2":8},{"diffs":[[0,") {\n"],[-1,"            // Handle groups of attachments\n            if (typeof key == \"number\") {\n    "],[0,"    "]],"start1":5632,"start2":5632,"length1":98,"length2":8},{"diffs":[[0,"', {"],[1,"\n               "],[0," id: key"],[-1,"});"],[0,"\n     "],[1,"       });\n"],[0,"    "]],"start1":5689,"start2":5689,"length1":25,"length2":49},{"diffs":[[0," });\n           "],[1," "],[0,"that.model.attac"]],"start1":5729,"start2":5729,"length1":32,"length2":33},{"diffs":[[0,"                "],[-1,"    "],[0,"var attachment_i"]],"start1":5799,"start2":5799,"length1":36,"length2":32},{"diffs":[[0,"                "],[-1," "],[-1,"   "],[0,"var attachment ="]],"start1":5853,"start2":5853,"length1":36,"length2":32},{"diffs":[[0,"d);\n"],[-1,"                  \n    "],[1,"\n"],[0,"    "]],"start1":5926,"start2":5926,"length1":31,"length2":9},{"diffs":[[0,"                "],[-1,"  "],[-1,"  "],[0,"attributes: {\n  "]],"start1":5989,"start2":5989,"length1":36,"length2":32},{"diffs":[[0,"  attributes: {\n"],[-1,"    "],[0,"                "]],"start1":6003,"start2":6003,"length1":36,"length2":32},{"diffs":[[0,"                "],[-1,"    "],[0,"},\n             "]],"start1":6065,"start2":6065,"length1":36,"length2":32},{"diffs":[[0,"                "],[-1," "],[-1,"   "],[0,"model: attachmen"]],"start1":6088,"start2":6088,"length1":36,"length2":32},{"diffs":[[0,"                "],[-1,"    "],[0,"}).render()\n    "]],"start1":6122,"start2":6122,"length1":36,"length2":32},{"diffs":[[0,"r()\n"],[-1,"                    makeDroppable(subview.el, attachment)\n    "],[0,"    "]],"start1":6146,"start2":6146,"length1":70,"length2":8},{"diffs":[[0,"            "],[-1,"    })\n   "],[1,"})\n"],[0,"            "]],"start1":6207,"start2":6207,"length1":34,"length2":27},{"diffs":[[0," })\n            "],[-1," "],[0,"that.$el.append("]],"start1":6218,"start2":6218,"length1":33,"length2":32},{"diffs":[[0,"l);\n"],[-1,"            }\n            // Handle single attachments\n            else {\n                var subview = new that.options.view({\n                    attributes: {\n                        id: key\n                    },\n                    model: that.model._attachments.get(key)\n                }).render()\n                makeDroppable(subview.el, that.model._attachments.get(key), that.model)\n                that.$el.append(subview.el);\n            }\n"],[0,"    "]],"start1":6269,"start2":6269,"length1":460,"length2":8},{"diffs":[[0,"    "],[-1," this.model._attachments.add()"],[0,""],[1,""],[0,"\n   "]],"start1":6397,"start2":6397,"length1":38,"length2":8},{"diffs":[[0,"\n})\n"],[-1,"\n////////////////\n// HELPERS \n////////////////\n\n// Takes the Attachment View and makes it into a droppable element and provides a callback \n// to be executed when a file is dropped on that element\nfunction makeDroppable(el, attachment) {\n    // We need this to prevent the browser using its standard default when you drag over\n    el.addEventListener('dragover', function(e) {\n        e.preventDefault();\n    });\n\n    // Listen for a file to be dropped on the element and then get the file, set the \n    // binary data of the attachment and save it\n    el.addEventListener('drop', function(e) {\n        \n        e.preventDefault();\n        attachment.updateBinary(e.dataTransfer.files[0]);\n    });\n}"]],"start1":7148,"start2":7148,"length1":703,"length2":4}]],"length":7152,"saved":false}
{"ts":1362068283407,"patch":[[{"diffs":[[0,"\n       "],[1,"this.model.addAttachmentGroup();"],[0,"\n    },\n"]],"start1":6393,"start2":6393,"length1":16,"length2":48}]],"length":7184,"saved":false}
{"ts":1362068299014,"patch":[[{"diffs":[[0,".on(\"add"],[1,"AttachmentGroup"],[0,"\", this."]],"start1":4906,"start2":4906,"length1":16,"length2":31}]],"length":7199,"saved":false}
{"ts":1362068301356,"patch":[[{"diffs":[[0,".on(\"add"],[-1,"AttachmentG"],[1,"-g"],[0,"roup\", t"]],"start1":4906,"start2":4906,"length1":27,"length2":18}]],"length":7190,"saved":false}
{"ts":1362068323161,"patch":[[{"diffs":[[0,"ger(\"add"],[-1,"ed"],[0,"-group\","]],"start1":1610,"start2":1610,"length1":18,"length2":16}]],"length":7188,"saved":false}
{"ts":1362068351964,"patch":[[{"diffs":[[0,"tachment"],[1,"Group"],[0,", this)\n"]],"start1":4931,"start2":4931,"length1":16,"length2":21},{"diffs":[[0,"   addAttachment"],[1,"Group"],[0,": function(attac"]],"start1":5235,"start2":5235,"length1":32,"length2":37},{"diffs":[[0,"p: function("],[-1,"attachment"],[1,"id"],[0,") {\n        "]],"start1":5255,"start2":5255,"length1":34,"length2":26}]],"length":7190,"saved":false}
{"ts":1362068369998,"patch":[[{"diffs":[[0,"ction(id) {\n"],[1,"        var these_attachments_el = $('<div></div>', {\n                id: id\n            });\n"],[0,"        var "]],"start1":5261,"start2":5261,"length1":24,"length2":117}]],"length":7283,"saved":false}
{"ts":1362068473552,"patch":[[{"diffs":[[0,"ction(id) {\n"],[1,"        var that = this;\n"],[0,"        var "]],"start1":5261,"start2":5261,"length1":24,"length2":49},{"diffs":[[0,"            "],[-1,"    "],[0,"id: id\n     "]],"start1":5352,"start2":5352,"length1":28,"length2":24},{"diffs":[[0,"    "],[-1,"    });\n        var attachment_"],[1,"});\n        this.model.attachment_types.forEach(function(type) {\n            var attachment_id = id + \"-\" + type;\n            var attachment = that.model._attachments.get(attachment_id);\n\n            var sub"],[0,"view"]],"start1":5375,"start2":5375,"length1":39,"length2":215},{"diffs":[[0,"= new th"],[-1,"is"],[1,"at"],[0,".options"]],"start1":5591,"start2":5591,"length1":18,"length2":18},{"diffs":[[0,"w({\n            "],[1,"    "],[0,"attributes: {\n  "]],"start1":5613,"start2":5613,"length1":32,"length2":36},{"diffs":[[0,"                "],[1," "],[1,"   "],[0,"id: attachment.c"]],"start1":5647,"start2":5647,"length1":32,"length2":36},{"diffs":[[0,"ment"],[-1,".c"],[1,"_"],[0,"id\n"],[1,"    "],[0,"    "]],"start1":5677,"start2":5677,"length1":13,"length2":16},{"diffs":[[0," },\n            "],[1,"    "],[0,"model: attachmen"]],"start1":5700,"start2":5700,"length1":32,"length2":36},{"diffs":[[0,"achment\n        "],[1,"    }).render()\n            these_attachments_el.append(subview.el);\n        "],[0,"})"],[-1,";"],[0,"\n        this.$e"]],"start1":5730,"start2":5730,"length1":35,"length2":111},{"diffs":[[0,".append("],[1,"these_"],[0,"attachme"]],"start1":5842,"start2":5842,"length1":16,"length2":22},{"diffs":[[0,"tachment"],[1,"s"],[0,"_"],[-1,"view.render()."],[0,"el)\n    "]],"start1":5858,"start2":5858,"length1":31,"length2":18}]],"length":7564,"saved":false}
{"ts":1362068499182,"patch":[[{"diffs":[[0," max = this."],[-1,"model."],[0,"_attachments"]],"start1":1193,"start2":1193,"length1":30,"length2":24}]],"length":7558,"saved":false}
{"ts":1362068502169,"patch":[[{"diffs":[[0,"           this."],[-1,"model."],[0,"_attachments.add"]],"start1":1455,"start2":1455,"length1":38,"length2":32}]],"length":7552,"saved":false}
{"ts":1362068510978,"patch":[[{"diffs":[[0,";\n\n        this."],[-1,"model."],[0,"attachment_types"]],"start1":1390,"start2":1390,"length1":38,"length2":32},{"diffs":[[0,"s)\n        this."],[-1,"model."],[0,"_attachments.tri"]],"start1":1553,"start2":1553,"length1":38,"length2":32}]],"length":7540,"saved":false}
{"ts":1362068578226,"patch":[[{"diffs":[[0," options) {\n"],[1,"        Backbone.Model.apply(this, arguments)\n        \n"],[0,"        this"]],"start1":246,"start2":246,"length1":24,"length2":79},{"diffs":[[0,"[];\n"],[-1,"        Backbone.Model.apply(this, arguments)\n"],[0,"    "]],"start1":411,"start2":411,"length1":54,"length2":8},{"diffs":[[0,"esp;\n    },\n"],[1,"    \n"],[0,"    addAttac"]],"start1":1142,"start2":1142,"length1":24,"length2":29},{"diffs":[[0,"_id)\n    },\n"],[1,"    \n"],[0,"    //We cal"]],"start1":1620,"start2":1620,"length1":24,"length2":29},{"diffs":[[0,"  });\n    },"],[-1,""],[0,""],[1,"\n    "],[0,"\n    sync: f"]],"start1":1859,"start2":1859,"length1":24,"length2":29}]],"length":7564,"saved":false}
{"ts":1362069242774,"patch":[[{"diffs":[[0,"ts)\n"],[-1,"        \n"],[0,"    "]],"start1":300,"start2":300,"length1":17,"length2":8},{"diffs":[[0," },\n    "],[1,"_"],[0,"render"],[1,"Group"],[0,": functi"]],"start1":5866,"start2":5866,"length1":22,"length2":28},{"diffs":[[0,"Group: function("],[1,"id"],[0,") {\n        var "]],"start1":5881,"start2":5881,"length1":32,"length2":34},{"diffs":[[0,"r th"],[-1,"at = this;\n        this.$el.empty()"],[1,"ese_attachments_el = $('<div></div>', {\n            id: id\n        });\n        this.model.attachment_types.forEach(function(type) {\n            var attachment_id = id + \"-\" + type;\n            var attachment = this.model._attachments.get(attachment_id);\n\n            var subview = new this.options.view({\n                attributes: {\n                    id: attachment_id\n                },\n                model: attachment\n            }).render()\n            these_attachments_el.append(subview.el);\n        }, this)\n        return these_attachments_el\n    },\n    render: function() {\n        \n        this.$el.empty();\n        var that = this"],[0,";\n  "]],"start1":5913,"start2":5913,"length1":43,"length2":654}]],"length":8174,"saved":false}
{"ts":1362069281911,"patch":[[{"diffs":[[0,") {\n"],[-1,"        \n"],[0,"    "]],"start1":6501,"start2":6501,"length1":17,"length2":8},{"diffs":[[0,"();\n"],[-1,"        var that = this;\n"],[0,"    "]],"start1":6527,"start2":6527,"length1":33,"length2":8},{"diffs":[[0,"    "],[-1,"var these_attachments_el = $('<div></div>', {\n                id: key\n            });\n            that.model.attachment_types.forEach(function(type) {\n                var attachment_id = key + \"-\" + type;\n                var attachment = that.model._attachments.get(attachment_id);\n\n                var subview = new that.options.view({\n                    attributes: {\n                        id: attachment_id\n                    },\n                    model: attachment\n                }).render()\n                these_attachments_el.append(subview.el);\n            })\n            that.$el.append(these_attachments_el);\n        }"],[1,"this.$el.append(this._renderGroup(key));\n        }, this"],[0,")\n  "]],"start1":6600,"start2":6600,"length1":642,"length2":64}]],"length":7562,"saved":false}
{"ts":1362069314490,"patch":[[{"diffs":[[0,"    "],[-1,"var that = this;\n        var these_attachments_el = $('<div></div>', {\n            id: id\n        });\n        this.model.attachment_types.forEach(function(type) {\n            var attachment_id = id + \"-\" + type;\n            var attachment = that.model._attachments.get(attachment_id);\n\n            var subview = new that.options.view({\n                attributes: {\n                    id: attachment_id\n                },\n                model: attachment\n            }).render()\n            these_attachments_el.append(subview.el);\n        })\n        this.$el.append(these_attachments_el"],[1,"this.$el.append(this._renderGroup(id)"],[0,")\n  "]],"start1":5268,"start2":5268,"length1":597,"length2":45}]],"length":7010,"saved":false}
{"contributors":[],"silentsave":false,"ts":1362073301479,"patch":[[{"diffs":[[0,") {\n"],[-1,"        Backbone.Model.apply(this, arguments)\n"],[0,"    "]],"start1":254,"start2":254,"length1":54,"length2":8},{"diffs":[[0,"r = [];\n"],[1,"        \n        Backbone.Model.apply(this, arguments)\n"],[0,"    },\n "]],"start1":352,"start2":352,"length1":16,"length2":71},{"diffs":[[0,"id))\n    },\n"],[1,"    render: function() {\n        this.$el.empty();\n        this.model.attachments_order.forEach(function(key) {\n            this.$el.append(this._renderGroup(key));\n        }, this)\n        return this;\n    },    \n"],[0,"    _renderG"]],"start1":5315,"start2":5315,"length1":24,"length2":238},{"diffs":[[0," function(id) {\n"],[-1,""],[0,"        var thes"]],"start1":5558,"start2":5558,"length1":32,"length2":32},{"diffs":[[0,"_el\n"],[-1,"    },\n    render: function() {\n        this.$el.empty();\n        this.model.attachments_order.forEach(function(key) {\n            this.$el.append(this._renderGroup(key));\n        }, this)\n        return this;\n"],[0,"    "]],"start1":6140,"start2":6140,"length1":218,"length2":8},{"diffs":[[0,"ortable("],[-1,"{"],[1,")"],[0,"\n       "]],"start1":6817,"start2":6817,"length1":17,"length2":17},{"diffs":[[0,"    "],[-1,"    "],[1,"attachments_view_element.bind(\""],[0,"update"],[-1,":"],[1,"\","],[0," fun"]],"start1":6831,"start2":6831,"length1":19,"length2":47},{"diffs":[[0,"ray\"));\n"],[-1,"            }\n"],[0,"        "]],"start1":6969,"start2":6969,"length1":30,"length2":16}]],"length":7037,"saved":false}
{"ts":1362073305733,"patch":[[{"diffs":[[0,") {\n            "],[-1,"    "],[0,"that.model.updat"]],"start1":6893,"start2":6893,"length1":36,"length2":32}]],"length":7033,"saved":false}
{"ts":1362073425831,"patch":[[{"diffs":[[0,"$el\n"],[-1,"        attachments_view_element.sortable()\n        attachments_view_element.bind(\"update\", function(event, ui) {\n            that.model.updateAttachmentsOrder($(this).sortable(\"toArray\"));\n        })"],[0,"\n   "]],"start1":6779,"start2":6779,"length1":208,"length2":8}]],"length":6833,"saved":false}
{"ts":1362073428599,"patch":[[{"diffs":[[0,"ender()."],[-1,"$"],[0,"el\n\n    "]],"start1":6771,"start2":6771,"length1":17,"length2":16}]],"length":6832,"saved":false}
{"ts":1362073454029,"patch":[[{"diffs":[[0,"       }, this)\n"],[1,"                this.$el.sortable()\n        this.$el.bind(\"update\", function(event, ui) {\n            that.model.updateAttachmentsOrder($(this).sortable(\"toArray\"));\n        })\n"],[0,"        return t"]],"start1":5493,"start2":5493,"length1":32,"length2":209}]],"length":7009,"saved":false}
{"ts":1362073484538,"patch":[[{"diffs":[[0,"r: function() {\n"],[1,"        var that = this;\n"],[0,"        this.$el"]],"start1":5336,"start2":5336,"length1":32,"length2":57}]],"length":7034,"saved":false}
{"ts":1362073495389,"patch":[[{"diffs":[[0,"er().el\n"],[-1,"\n"],[0,"        "]],"start1":6976,"start2":6976,"length1":17,"length2":16}]],"length":7033,"saved":false}
{"ts":1362073500974,"patch":[[{"diffs":[[0,") {\n"],[-1,"        var that = this;\n"],[0,"    "]],"start1":6714,"start2":6714,"length1":33,"length2":8},{"diffs":[[0,"view: th"],[-1,"at"],[1,"is"],[0,".options"]],"start1":6835,"start2":6835,"length1":18,"length2":18}]],"length":7008,"saved":false}
{"ts":1362073525212,"patch":[[{"diffs":[[0,"view: th"],[-1,"is"],[1,"at"],[0,".options"]],"start1":6835,"start2":6835,"length1":18,"length2":18}]],"length":7008,"saved":false}
{"ts":1362073531667,"patch":[[{"diffs":[[0,"view: th"],[-1,"at"],[1,"is"],[0,".options"]],"start1":6835,"start2":6835,"length1":18,"length2":18}]],"length":7008,"saved":false}
{"ts":1362073549743,"patch":[[{"diffs":[[0,"ts)\n"],[-1,"        var that = this;\n"],[0,"    "]],"start1":4149,"start2":4149,"length1":33,"length2":8}]],"length":6983,"saved":false}
{"ts":1362073595550,"patch":[[{"diffs":[[0,"  },"],[-1,"\n    \n    //We call this to save the order of attachments to the server\n    updateAttachmentsOrder: function(new_order) {\n        this.save({\n            \"attachments_order\": new_order\n        }, {\n            patch: true\n        });\n    },\n"],[0,"    "]],"start1":1627,"start2":1627,"length1":249,"length2":8}]],"length":6742,"saved":false}
{"ts":1362074802658,"patch":[[{"diffs":[[0,"r: function() {\n"],[1,"        var that = this;\n"],[0,"        Backbone"]],"start1":3851,"start2":3851,"length1":32,"length2":57}]],"length":6767,"saved":false}
